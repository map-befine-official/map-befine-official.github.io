<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[RSS Feed of 괜찮을지도]]></title><description><![CDATA[안녕하세요! 괜찮을지도 기술블로그입니다.]]></description><link>https://map-befine-official.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Fri, 06 Oct 2023 07:48:47 GMT</lastBuildDate><item><title><![CDATA[FetchType.EAGER, FetchType.LAZY 에 대해서 알아보자!]]></title><description><![CDATA[이 글은 우테코 괜찮을지도의 가 작성하였습니다. 배경 쿼리 개선... 필요할지도?…]]></description><link>https://map-befine-official.github.io/trouble-shooting-fetch-type/</link><guid isPermaLink="false">https://map-befine-official.github.io/trouble-shooting-fetch-type/</guid><pubDate>Wed, 04 Oct 2023 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 우테코 괜찮을지도의 &lt;code class=&quot;language-text&quot;&gt;매튜&lt;/code&gt;가 작성하였습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;배경&lt;/h2&gt;
&lt;h3&gt;쿼리 개선... 필요할지도?&lt;/h3&gt;
&lt;p&gt;9월 말, 추석을 앞두고 사용자 유치 계획 실행을 앞두고 있었다.&lt;/p&gt;
&lt;p&gt;우리는 행복회로를 돌리며, 많은 사용자들이 서비스에 들어올 것이라고 생각했고, 사용자들에게 좋은 경험을 선사하고 싶었다.&lt;/p&gt;
&lt;p&gt;하지만, 문제가 있었다.&lt;/p&gt;
&lt;p&gt;많은 사용자가 들어옴에 따라 평소보다 많은 트래픽이 발생할 것이고, 조금 더 좋은 경험을 제공하기 위해 추가한 지도와 핀으로 인해 데이터는 방대해졌다. &lt;/p&gt;
&lt;p&gt;자칫하면 사용자에게 좋지 않은 경험을 선사할 수 있다는 생각에 성능 개선을 목표로 삼았다.&lt;/p&gt;
&lt;p&gt;때문에 우리는 현재 발생하고 있는 &lt;code class=&quot;language-text&quot;&gt;N + 1&lt;/code&gt; 문제를 해결하고, &lt;code class=&quot;language-text&quot;&gt;인덱스&lt;/code&gt;를 활용하여 빠른 성능 개선을 계획했다.&lt;/p&gt;
&lt;p&gt;그 중에서 &lt;code class=&quot;language-text&quot;&gt;N + 1&lt;/code&gt; 문제를 해결하는 과정 중에 해당 글을 작성하게 된 문제가 발생하였다.&lt;/p&gt;
&lt;h3&gt;문제 상황&lt;/h3&gt;
&lt;p&gt;유저가 &lt;code class=&quot;language-text&quot;&gt;지도&lt;/code&gt; 목록을 조회하려는 경우 비정상적으로 쿼리가 많이나갔다.&lt;/p&gt;
&lt;p&gt;쉽게 예상할 수 있듯 당연히 &lt;code class=&quot;language-text&quot;&gt;N + 1&lt;/code&gt; 문제였다.&lt;/p&gt;
&lt;p&gt;우리는 해당 &lt;code class=&quot;language-text&quot;&gt;N + 1&lt;/code&gt; 문제를 해결하기 위해서 &lt;code class=&quot;language-text&quot;&gt;fetch join&lt;/code&gt; 을 사용했다.&lt;/p&gt;
&lt;h3&gt;N + 1 을 해결해보자!&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Topic Entity 구조 (&lt;code class=&quot;language-text&quot;&gt;지도 == Topic&lt;/code&gt;)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Entity&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@NoArgsConstructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;access &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PROTECTED&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Getter&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Topic&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BaseTimeEntity&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  

&lt;span class=&quot;token annotation punctuation&quot;&gt;@Id&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@GeneratedValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strategy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GenerationType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;IDENTITY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 생략

&lt;span class=&quot;token annotation punctuation&quot;&gt;@ManyToOne&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@JoinColumn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;member_id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Member&lt;/span&gt; creator&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token annotation punctuation&quot;&gt;@OneToMany&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedBy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;topic&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Permission&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; permissions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token annotation punctuation&quot;&gt;@OneToMany&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedBy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;topic&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cascade &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CascadeType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;PERSIST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Pin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; pins &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token annotation punctuation&quot;&gt;@OneToMany&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedBy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;topic&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cascade &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CascadeType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;PERSIST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; orphanRemoval &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Bookmark&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; bookmarks &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token annotation punctuation&quot;&gt;@Column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nullable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@ColumnDefault&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; pinCount &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token annotation punctuation&quot;&gt;@Column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nullable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@ColumnDefault&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; bookmarkCount &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 생략&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- Topic Repository 
```java
@Repository  
public interface TopicRepository extends JpaRepository&amp;lt;Topic, Long&gt; {  
  
    @EntityGraph(attributePaths = {&quot;permissions&quot;})  
    List&amp;lt;Topic&gt; findAll();

	... 생략
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;앞선 &lt;code class=&quot;language-text&quot;&gt;Entity&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Repository&lt;/code&gt; 는 &lt;code class=&quot;language-text&quot;&gt;지도&lt;/code&gt; 목록을 조회할 때 사용된 &lt;code class=&quot;language-text&quot;&gt;Entity&lt;/code&gt; 및 &lt;code class=&quot;language-text&quot;&gt;Repository&lt;/code&gt; 이다.&lt;/p&gt;
&lt;p&gt;마지막으로 &lt;code class=&quot;language-text&quot;&gt;Topic&lt;/code&gt; 에 필요한 정보는 아래와 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Topic Response&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
&lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
&lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;토픽 이름&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
&lt;span class=&quot;token property&quot;&gt;&quot;image&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;토픽 이미지 링크&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
&lt;span class=&quot;token property&quot;&gt;&quot;creator&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;토픽을 만든자&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
&lt;span class=&quot;token property&quot;&gt;&quot;pinCount&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
&lt;span class=&quot;token property&quot;&gt;&quot;bookmarkCount&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
&lt;span class=&quot;token property&quot;&gt;&quot;updatedAt&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2023-10-02T18:00:55.95188832&quot;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;여기서 사용자에게 &lt;code class=&quot;language-text&quot;&gt;Topic&lt;/code&gt; 목록을 제공하기 위해 부수적으로 필요한 &lt;code class=&quot;language-text&quot;&gt;Entity&lt;/code&gt; 는 &lt;code class=&quot;language-text&quot;&gt;Member&lt;/code&gt; , &lt;code class=&quot;language-text&quot;&gt;Permission&lt;/code&gt; 이었다.&lt;/p&gt;
&lt;p&gt;위에서 볼 수 있듯, &lt;code class=&quot;language-text&quot;&gt;Member&lt;/code&gt; 는 &lt;code class=&quot;language-text&quot;&gt;@ManyToOne 기본 fetch 설정&lt;/code&gt;으로 인해 &lt;code class=&quot;language-text&quot;&gt;FetchType.EAGER&lt;/code&gt; 로 설정되고, &lt;code class=&quot;language-text&quot;&gt;Permission&lt;/code&gt; 은 &lt;code class=&quot;language-text&quot;&gt;@OneToMany 기본 fetch 설정&lt;/code&gt; 인 &lt;code class=&quot;language-text&quot;&gt;FetchType.LAZY&lt;/code&gt; 이지만, &lt;code class=&quot;language-text&quot;&gt;@EntityGraph&lt;/code&gt; 를 통해서 &lt;code class=&quot;language-text&quot;&gt;fetch join&lt;/code&gt; 을 해주었기 때문에 당연히 쿼리는 한번만 나갈 줄 알았다.&lt;/p&gt;
&lt;p&gt;하지만, 결과는....&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// 데이터 10만개를 기준으로 진행되었음
[http-nio-8080-exec-2] 16496 INFO  com.mapbefine.mapbefine.common.filter.LatencyLoggingFilter - Latency : 4.649s, Query count : 8, Request URI : /topics&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위와 같았고, 우리는 멘붕이 올 수 밖에 없었다.&lt;/p&gt;
&lt;p&gt;우리 예상대로라면 분명히 &lt;code class=&quot;language-text&quot;&gt;Query Count&lt;/code&gt; 가 &lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt;이어야 하는데??&lt;/p&gt;
&lt;p&gt;도대체 왜 ?? ㅠㅠㅠ&lt;/p&gt;
&lt;h3&gt;해결했는데 이유를 모르겠어&lt;/h3&gt;
&lt;p&gt;다른 문제들도 많은데, 해당 문제까지 발생하여 몇 시간 동안 골머리를 앓았다.&lt;/p&gt;
&lt;p&gt;그러다 조금의 시간이 흘렀고, 마음을 가다듬고 천천히 쿼리를 뜯어보기 시작했고, 원인을 찾을 수 있었다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
        topic t1_0 
    &lt;span class=&quot;token keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;join&lt;/span&gt;
        permission p1_0 
            &lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; t1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;p1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;topic_id
Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
        member m1_0 
    &lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
        m1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?

	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt; 번을 member 를 찾아옴&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;우리는 &lt;code class=&quot;language-text&quot;&gt;@ManyToOne&lt;/code&gt; 의 &lt;code class=&quot;language-text&quot;&gt;기본 fetch 설정&lt;/code&gt;인 &lt;code class=&quot;language-text&quot;&gt;FetchType.EAGER&lt;/code&gt; 로 인해 &lt;code class=&quot;language-text&quot;&gt;Member&lt;/code&gt; 를 &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt; 을 통해 가져올 것이라고 생각했지만, 실상은 &lt;code class=&quot;language-text&quot;&gt;Topic&lt;/code&gt; 을 가져올 때 &lt;code class=&quot;language-text&quot;&gt;permission&lt;/code&gt; 은 &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt;을 잘해서 가져오지만, &lt;code class=&quot;language-text&quot;&gt;member&lt;/code&gt; 는 &lt;code class=&quot;language-text&quot;&gt;select 쿼리&lt;/code&gt;를 통해 따로 가져오고 있었다.&lt;/p&gt;
&lt;p&gt;이로 인해서 &lt;code class=&quot;language-text&quot;&gt;Query Count&lt;/code&gt; 가 &lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt;이 아니었던 것이었다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@EntityGraph&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;attributePaths &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;creator&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;permissions&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Topic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;findAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;해당 문제를 해결하기 위해, 위와 같이 &lt;code class=&quot;language-text&quot;&gt;attributePaths&lt;/code&gt; 에 &lt;code class=&quot;language-text&quot;&gt;creator&lt;/code&gt; 를 추가해주었더니&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[http-nio-8080-exec-5] 16826 INFO  com.mapbefine.mapbefine.common.filter.LatencyLoggingFilter - Latency : 5.941s, Query count : 1, Request URI : /topics&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;드디어 &lt;code class=&quot;language-text&quot;&gt;Query Count&lt;/code&gt; 를 &lt;code class=&quot;language-text&quot;&gt;1&lt;/code&gt;로 만들 수 있었다.&lt;/p&gt;
&lt;p&gt;도대체 왜 그런걸까???&lt;/p&gt;
&lt;p&gt;차근차근 알아가보자!&lt;/p&gt;
&lt;h2&gt;ManyToOne 테스트&lt;/h2&gt;
&lt;h3&gt;테스트를 통해서 생각을 굳혀보자!&lt;/h3&gt;
&lt;p&gt;일단 이전 상황들로 미루어 보았을 때, &lt;code class=&quot;language-text&quot;&gt;Eager&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;Lazy&lt;/code&gt; 는 단순 &lt;code class=&quot;language-text&quot;&gt;select 시기&lt;/code&gt;를 &lt;code class=&quot;language-text&quot;&gt;결정&lt;/code&gt;하는 것 같다.&lt;/p&gt;
&lt;p&gt;그렇기 때문에, &lt;code class=&quot;language-text&quot;&gt;Eager&lt;/code&gt; 로 설정하든 &lt;code class=&quot;language-text&quot;&gt;Lazy&lt;/code&gt; 로 설정하든, 따로 &lt;code class=&quot;language-text&quot;&gt;select&lt;/code&gt; 쿼리를 통해서 가져오는 것이다.&lt;/p&gt;
&lt;p&gt;이를 증명하기 위해 몇 가지 테스트를 진행해보자.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;@ManyToOne&lt;/code&gt; 을 진행하기 위해 &lt;code class=&quot;language-text&quot;&gt;대상 Entity&lt;/code&gt; 를 정하고 &lt;code class=&quot;language-text&quot;&gt;Test&lt;/code&gt; 하기 위한 &lt;code class=&quot;language-text&quot;&gt;테스트 코드&lt;/code&gt;를 짜보자!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Permission (@ManyToOne 컬럼밖에 없어서 딱 테스트하기 좋은 Entity Class 라고 판단)&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Entity&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@NoArgsConstructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;access &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PROTECTED&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Getter&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Permission&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BaseTimeEntity&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Id&lt;/span&gt;  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@GeneratedValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strategy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GenerationType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;IDENTITY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@ManyToOne&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 여기서 Eager or Lazy 로 진행할 것 &lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@JoinColumn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;topic_id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nullable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Topic&lt;/span&gt; topic&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@ManyToOne&lt;/span&gt;  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@JoinColumn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;member_id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; nullable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Member&lt;/span&gt; member&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;ManyToOne 을 테스트 하기 위한 테스트 코드&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@ServiceTest&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TestClass&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Autowired&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TopicRepository&lt;/span&gt; topicRepository&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Autowired&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MemberRepository&lt;/span&gt; memberRepository&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Autowired&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PermissionRepository&lt;/span&gt; permissionRepository&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Autowired&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TestEntityManager&lt;/span&gt; testEntityManager&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Member&lt;/span&gt; member&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Topic&lt;/span&gt; topic&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Permission&lt;/span&gt; permission&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@BeforeEach&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;beforeEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// 멤버를 저장한다.  &lt;/span&gt;
        member &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; memberRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MemberFixture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;member&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;member@naver.com&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Role&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;USER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// 토픽을 저장한다.  &lt;/span&gt;
        topic &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; topicRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;TopicFixture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createPublicAndAllMembersTopic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;member&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// 권한을 저장한다.  &lt;/span&gt;
        permission &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; permissionRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Permission&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createPermissionAssociatedWithTopicAndMember&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; member&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token comment&quot;&gt;// 영속성 컨텍스트 초기화 (초기화 안하면 findById 때 쿼리가 안 날라감)&lt;/span&gt;
        testEntityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Test&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;permissionManyToOneFindById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;Permission&lt;/span&gt; permissionByFindById &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; permissionRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;permission&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          
        &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;permissionByFindById&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getTopic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;permissionByFindById&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMember&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;member&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위와 같이 테스트 코드를 짜고, &lt;code class=&quot;language-text&quot;&gt;@ManyToOne fetchType&lt;/code&gt; 은 &lt;code class=&quot;language-text&quot;&gt;Eager&lt;/code&gt; (기본 설정) 로 설정하고 테스트를 진행했다.&lt;/p&gt;
&lt;p&gt;당연히 추가적인 &lt;code class=&quot;language-text&quot;&gt;select&lt;/code&gt; 쿼리가 날아가겠지? ㅎㅎ&lt;/p&gt;
&lt;h3&gt;예상과 다른 결과&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들
    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
        permission p1_0 
    &lt;span class=&quot;token keyword&quot;&gt;join&lt;/span&gt;
        member m1_0 
            &lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; m1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;p1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;member_id 
    &lt;span class=&quot;token keyword&quot;&gt;join&lt;/span&gt;
        topic t1_0 
            &lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; t1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;p1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;topic_id 
    &lt;span class=&quot;token keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;join&lt;/span&gt;
        member c1_0 
            &lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; c1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;t1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;member_id 
    &lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
        p1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;아니 도대체 왜 ???&lt;/p&gt;
&lt;p&gt;예상대로라면 &lt;code class=&quot;language-text&quot;&gt;select&lt;/code&gt; 쿼리가 나가야 하는데...&lt;/p&gt;
&lt;p&gt;이해가 되지 않는다.&lt;/p&gt;
&lt;p&gt;왜 &lt;code class=&quot;language-text&quot;&gt;select&lt;/code&gt; 했다가 지 마음대로 &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt; 해서 오는지 갈대같은 &lt;code class=&quot;language-text&quot;&gt;JPA&lt;/code&gt; 의 마음을 알 수가 없다.&lt;/p&gt;
&lt;p&gt;이 결과를 보고 이전과 다른게 뭐지... 하면서 곰곰히 생각해보았다.&lt;/p&gt;
&lt;p&gt;이 때 내가 발견한 차이점은 단 하나였다.&lt;/p&gt;
&lt;h1&gt;이전에는 목록 조회(findAll()), 이번에는 단건 조회(findById())이다.&lt;/h1&gt;
&lt;h3&gt;호다닥 findAll 로 테스트&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Test&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;permissionManyToOneFindAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Permission&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; permission &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; permissionRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위와 같이 테스트를 실행해보았다.&lt;/p&gt;
&lt;p&gt;결과는??&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;insert&lt;/span&gt; 
    &lt;span class=&quot;token keyword&quot;&gt;into&lt;/span&gt;
        permission
        &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;created_at&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;member_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;topic_id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;updated_at&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;token keyword&quot;&gt;values&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;?&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;?&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;?&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;?&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
	    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
        permission p1_0
Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
	    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
        member m1_0 
    &lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
        m1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?
Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
	    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
        topic t1_0 
    &lt;span class=&quot;token keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;join&lt;/span&gt;
        member c1_0 
            &lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; c1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;t1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;member_id 
    &lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
        t1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;역시나 예상대로 &lt;code class=&quot;language-text&quot;&gt;findAll&lt;/code&gt; 인 경우는 똑같이 &lt;code class=&quot;language-text&quot;&gt;Eager&lt;/code&gt; 이더라도 &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt; 을 해서 가져오지 않는다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Eager&lt;/code&gt; 로 &lt;code class=&quot;language-text&quot;&gt;findById&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;findAll&lt;/code&gt; 을 테스트 해봤으니&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Lazy&lt;/code&gt; 로 더 테스트를 진행해서 가설을 사실로 굳혀보자!&lt;/p&gt;
&lt;h3&gt;Lazy 테스트&lt;/h3&gt;
&lt;p&gt;먼저 &lt;code class=&quot;language-text&quot;&gt;findById&lt;/code&gt;로 테스트를 진행해보자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Test&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;permissionManyToOneFindById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;Permission&lt;/span&gt; permissionByFindById &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; permissionRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;permission&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;permissionByFindById&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getTopic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;permissionByFindById&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMember&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;member&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
        permission p1_0 
    &lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
        p1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?
Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
        topic t1_0 
    &lt;span class=&quot;token keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;join&lt;/span&gt;
        member c1_0 
            &lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; c1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;t1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;member_id 
    &lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
        t1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;결과는 당연하다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Lazy&lt;/code&gt; 하게 가져오니 &lt;code class=&quot;language-text&quot;&gt;findById&lt;/code&gt; 로 가져오더라도 &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt; 을 하지 않은 것이고, &lt;code class=&quot;language-text&quot;&gt;getTopic()&lt;/code&gt; 을 할 때 &lt;code class=&quot;language-text&quot;&gt;Topic&lt;/code&gt; 을 가져왔기 때문에 &lt;code class=&quot;language-text&quot;&gt;select&lt;/code&gt; 쿼리가 나갔다.&lt;/p&gt;
&lt;p&gt;근데 &lt;code class=&quot;language-text&quot;&gt;member&lt;/code&gt; 를 조회하는 &lt;code class=&quot;language-text&quot;&gt;select&lt;/code&gt; 쿼리가 없다. &lt;/p&gt;
&lt;p&gt;왜 그럴까?&lt;/p&gt;
&lt;p&gt;이유는, 이번에 처음 알았는데 &lt;code class=&quot;language-text&quot;&gt;assertJ&lt;/code&gt; 로 테스트를 진행할 때 단 하나라도 예상한 결과가 나오지 않아 테스트가 실패하게 되면 그 즉시 테스트가 종료되는 것 같다.&lt;/p&gt;
&lt;p&gt;그래서 뒤에 있는 &lt;code class=&quot;language-text&quot;&gt;getMember()&lt;/code&gt; 구문은 실행되지 않은 것이다.&lt;/p&gt;
&lt;p&gt;어쨌든, 본론으로 돌아와 &lt;code class=&quot;language-text&quot;&gt;findAll&lt;/code&gt; 도 테스트를 진행해보자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Test&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;permissionManyToOneFindAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Permission&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; permission &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; permissionRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;permission&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getTopic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;permission&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMember&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;member&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위와 같이 테스트를 진행했고, 나간 쿼리는 당연히 위와 동일할 것이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
        permission p1_0
Hibernate: 
    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
        topic t1_0 
    &lt;span class=&quot;token keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;join&lt;/span&gt;
        member c1_0 
            &lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; c1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;t1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;member_id 
    &lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
        t1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;역시 동일하다.&lt;/p&gt;
&lt;h3&gt;ManyToOne 테스트를 통해 확실하게 유추할 수 있는 것&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;findAll&lt;/code&gt; 과 같은 목록 조회는 &lt;code class=&quot;language-text&quot;&gt;Eager&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Lazy&lt;/code&gt; 가 정말 &lt;code class=&quot;language-text&quot;&gt;select 시기&lt;/code&gt;만을 결정하지만, &lt;code class=&quot;language-text&quot;&gt;findById&lt;/code&gt; 과 같은 단건 조회는 &lt;code class=&quot;language-text&quot;&gt;Eager&lt;/code&gt; 로 설정하게 되면, &lt;code class=&quot;language-text&quot;&gt;fetchType&lt;/code&gt; 이 &lt;code class=&quot;language-text&quot;&gt;select 시기 결정&lt;/code&gt;을 넘어 &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt; 여부까지 결정할 수 있는 것이다. (최적화)&lt;/p&gt;
&lt;p&gt;결과야 뻔하긴 하지만, 남은 &lt;code class=&quot;language-text&quot;&gt;OneToMany&lt;/code&gt; 테스트들도 진행해서 위 사실을 더욱 더 굳혀보자.&lt;/p&gt;
&lt;h2&gt;OneToMany&lt;/h2&gt;
&lt;h3&gt;테스트 준비&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ManyToOne&lt;/code&gt; 테스트와 마찬가지로 &lt;code class=&quot;language-text&quot;&gt;OneToMany&lt;/code&gt; 테스트를 진행할 &lt;code class=&quot;language-text&quot;&gt;대상 Entity&lt;/code&gt; 와 &lt;code class=&quot;language-text&quot;&gt;Test 코드&lt;/code&gt;를 짜보자!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Member Entity (OneTOMany 컬럼만 있어서 딱 적합)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Entity&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@NoArgsConstructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;access &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PROTECTED&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Getter&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Member&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BaseTimeEntity&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  

&lt;span class=&quot;token annotation punctuation&quot;&gt;@Id&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@GeneratedValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strategy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GenerationType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;IDENTITY&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 생략 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token annotation punctuation&quot;&gt;@OneToMany&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mappedBy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;creator&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Topic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; createdTopics &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 생략 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;}&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- Test 코드
```java
@Test  
void memberOneToManyFindById() {  
    Member memberByFindById = memberRepository.findById(member.getId()).get();  
    assertThat(memberByFindById.getCreatedTopics().get(0)).isEqualTo(topic);  
}  
  
@Test  
void memberOneToManyFindAll() {  
    List&amp;lt;Member&gt; members = memberRepository.findAll();  
    assertThat(members.get(0).getCreatedTopics().get(0)).isEqualTo(topic);  
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Eager 에 대해서 먼저 테스트 해보자!&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;findById 로 테스트&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;Hibernate: 
&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
    member m1_0 
&lt;span class=&quot;token keyword&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;join&lt;/span&gt;
    topic c1_0 
        &lt;span class=&quot;token keyword&quot;&gt;on&lt;/span&gt; m1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;c1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;member_id 
&lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
    m1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이쯤되면 당연히 예상할 수 있듯이 &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt; 을 해서 가져온다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;findAll 로 테스트&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;Hibernate: 
&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
    member m1_0
Hibernate: 
&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
    topic c1_0 
&lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
    c1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;member_id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이것도 당연히 예상할 수 있듯, &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt; 이 아닌 &lt;code class=&quot;language-text&quot;&gt;select&lt;/code&gt; 을 해서 가져오고, 실제로 &lt;code class=&quot;language-text&quot;&gt;Topic&lt;/code&gt; 에 &lt;code class=&quot;language-text&quot;&gt;createdTopics&lt;/code&gt; 에 접근하지 않더라도 &lt;code class=&quot;language-text&quot;&gt;select&lt;/code&gt; 구문이 발생하게 된다.&lt;/p&gt;
&lt;p&gt;왜 ? 지금까지 계속보았듯 &lt;code class=&quot;language-text&quot;&gt;findAll&lt;/code&gt; 과 같은 &lt;code class=&quot;language-text&quot;&gt;목록 조회&lt;/code&gt;에서는 &lt;code class=&quot;language-text&quot;&gt;Eager&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Lazy&lt;/code&gt; 가 &lt;code class=&quot;language-text&quot;&gt;select 시기&lt;/code&gt;만을 결정하니까&lt;/p&gt;
&lt;h3&gt;Lazy 도 테스트 해보자.&lt;/h3&gt;
&lt;p&gt;정말 뻔하니 그냥 별다른 코멘트 없이 테스트 결과만을 나열하겠다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;findById&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;Hibernate: 
&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
    member m1_0 
&lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
    m1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?
Hibernate: 
&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
    topic c1_0 
&lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
    c1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;member_id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;당연히 &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt; 하지 않고&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;findAll&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;Hibernate: 
&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; 수많은 컬럼들 &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt;
    member m1_0 
&lt;span class=&quot;token keyword&quot;&gt;where&lt;/span&gt;
    m1_0&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;당연히 조회하지 않는다면 더 이상 &lt;code class=&quot;language-text&quot;&gt;select&lt;/code&gt; 쿼리를 발생시키지 않는다.&lt;/p&gt;
&lt;h2&gt;최종적인 결론&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;findById&lt;/code&gt; 는 &lt;code class=&quot;language-text&quot;&gt;FetchType&lt;/code&gt; 이 &lt;code class=&quot;language-text&quot;&gt;Eager&lt;/code&gt; 라면 &lt;code class=&quot;language-text&quot;&gt;join&lt;/code&gt; 을 해서 가져와준다 (최적화를 알아서 해주는 것)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;findAll&lt;/code&gt; 은 &lt;code class=&quot;language-text&quot;&gt;findById&lt;/code&gt; 와 다르게 &lt;code class=&quot;language-text&quot;&gt;fetch type&lt;/code&gt; 이 &lt;code class=&quot;language-text&quot;&gt;Eager&lt;/code&gt; 인지 &lt;code class=&quot;language-text&quot;&gt;Lazy&lt;/code&gt; 인지에 따라 해당 데이터를 가져오기 위한 &lt;code class=&quot;language-text&quot;&gt;select 쿼리 발생 시기&lt;/code&gt;만을 결정한다. (즉, &lt;code class=&quot;language-text&quot;&gt;fetch type&lt;/code&gt; 으로 인해 &lt;code class=&quot;language-text&quot;&gt;join 여부&lt;/code&gt;가 결정되지 않음)&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[@Modifying 어노테이션의 옵션이 정상 동작하지 않는 문제]]></title><description><![CDATA[이 글은 우테코 괜찮을지도의 가 작성하였습니다. 배경 괜찮을지도 서비스에서는 테스트를  방식으로 수행하고 있습니다.
란 우리가 알고 있는  테스트에서 따온 네이밍입니다. (서비스 -> 레포지토리까지의 테스트만으로도 E2E…]]></description><link>https://map-befine-official.github.io/trouble-shooting-modifying-annotation/</link><guid isPermaLink="false">https://map-befine-official.github.io/trouble-shooting-modifying-annotation/</guid><pubDate>Mon, 02 Oct 2023 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 우테코 괜찮을지도의 &lt;code class=&quot;language-text&quot;&gt;쥬니&lt;/code&gt;가 작성하였습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;배경&lt;/h3&gt;
&lt;p&gt;괜찮을지도 서비스에서는 테스트를 &lt;code class=&quot;language-text&quot;&gt;Layer To End&lt;/code&gt; 방식으로 수행하고 있습니다.&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;Layer To End&lt;/code&gt;란 우리가 알고 있는 &lt;code class=&quot;language-text&quot;&gt;E2E&lt;/code&gt; 테스트에서 따온 네이밍입니다. (서비스 -&gt; 레포지토리까지의 테스트만으로도 E2E라고 불리는지는 잘 모르겠습니다)
&lt;br&gt; 이때, Layer는 각 계층(Service, Repo 등)을 말합니다.&lt;/p&gt;
&lt;p&gt;서비스 계층에서 데이터를 삭제하는 테스트를 수행하는 도중, 데이터가 삭제되지 않고 조회되는 문제가 발생하였습니다.
&lt;br&gt; 지금부터, 그 이야기를 시작해 보려 합니다.&lt;/p&gt;
&lt;h3&gt;문제 상황&lt;/h3&gt;
&lt;p&gt;문제를 직면한 상황은 &lt;code class=&quot;language-text&quot;&gt;사용자의 즐겨찾기 목록을 모두 삭제하는 상황&lt;/code&gt;이었습니다.
&lt;br&gt; 테스트를 위해, 각 Repositry를 사용하여 아래와 같이 데이터를 넣어주는 작업을 수행했습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@DisplayName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;즐겨찾기 목록에 있는 모든 토픽을 삭제할 수 있다&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;deleteAllBookmarks_Success&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// 회원 저장&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Member&lt;/span&gt; member &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; memberRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MemberFixture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;member&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&quot;member@naver.com&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Role&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;USER&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            
            &lt;span class=&quot;token class-name&quot;&gt;Topic&lt;/span&gt; topic1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TopicFixture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createPrivateAndGroupOnlyTopic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;member&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Topic&lt;/span&gt; topic2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TopicFixture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createPrivateAndGroupOnlyTopic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;member&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 지도 저장&lt;/span&gt;
            topicRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            topicRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            
            &lt;span class=&quot;token class-name&quot;&gt;Bookmark&lt;/span&gt; bookmark1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Bookmark&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createWithAssociatedTopicAndMember&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; member&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;Bookmark&lt;/span&gt; bookmark2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Bookmark&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createWithAssociatedTopicAndMember&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; member&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

            &lt;span class=&quot;token comment&quot;&gt;// 즐겨찾기 등록&lt;/span&gt;
            bookmarkRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bookmark1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            bookmarkRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bookmark2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 코드의 결과로, 사용자(Member)와 지도(Topic)가 생성되어 있을 것이고, 사용자는 자신이 만든 지도를 즐겨찾기(Bookmark)로 등록해 놓은 상황일 것입니다.
&lt;br&gt; 이후, 아래와 같은 코드를 수행하면 해당 사용자의 즐겨찾기 목록이 전부 삭제되어, 테스트를 통과할 것이라 예상하였습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;        &lt;span class=&quot;token comment&quot;&gt;// 생략 ...&lt;/span&gt;
        
        &lt;span class=&quot;token comment&quot;&gt;// 통과 !&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;creatorBefore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getBookmarks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// 해당 회원의 즐겨찾기 목록 전체 삭제&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;AuthMember&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MemberFixture&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;creatorBefore&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        bookmarkCommandService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;deleteAllBookmarks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        
        &lt;span class=&quot;token comment&quot;&gt;// 실패 !&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bookmarkRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;creatorBefore&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;테스트 실패 메시지는 아래와 같았습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lang&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;AssertionError&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; 
&lt;span class=&quot;token class-name&quot;&gt;Expecting&lt;/span&gt; empty but was&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mapbefine&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mapbefine&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bookmark&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;Bookmark&lt;/span&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@23504729&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mapbefine&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mapbefine&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bookmark&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;domain&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;Bookmark&lt;/span&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@2447e2e&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;즉, 즐겨찾기가 존재하지 않을 것이라고 예상하였지만, 데이터가 존재한다는 의미였습니다.
&lt;br&gt; 테스트에 사용된 메서드들의 로직적인 오류를 재차 확인하였지만, 발견할 수 없었습니다.
&lt;br&gt; 그렇다면, 도대체 왜 데이터가 삭제되지 않고 조회되는 것일까요 ?&lt;/p&gt;
&lt;h3&gt;원인 파악&lt;/h3&gt;
&lt;p&gt;위 문제의 원인을 찾기 위해 여러 방법을 시도하던 중, &lt;code class=&quot;language-text&quot;&gt;TestEntityManager&lt;/code&gt;를 통해 즐겨찾기 삭제 메서드 호출 전, 후에 다음과 같은 로직을 추가하였습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Test&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@DisplayName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;즐겨찾기 목록에 있는 모든 토픽을 삭제할 수 있다&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;deleteAllBookmarks_Success&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;InterruptedException&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 생략&lt;/span&gt;
        testEntityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        testEntityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        bookmarkCommandService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;deleteAllBookmarks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        testEntityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        testEntityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 생략&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;즉, 삭제 메서드를 호출한 뒤, 명시적으로 영속성 컨텍스트를 flush &amp;#x26; clear 해준 것입니다.
&lt;br&gt; 위와 같은 로직을 추가하자, 테스트가 성공적으로 통과했습니다.
&lt;br&gt; 이로써, 문제 원인은 영속성 컨텍스트와 관련이 있음을 알게 되었습니다.&lt;/p&gt;
&lt;p&gt;하지만, 한 가지 의문점이 생겼습니다.
&lt;br&gt; 분명, 우리는 데이터의 변경이 일어나는 &lt;code class=&quot;language-text&quot;&gt;Repository&lt;/code&gt;의 메서드에는 &lt;code class=&quot;language-text&quot;&gt;@Modifying&lt;/code&gt; 어노테이션과 함께, &lt;code class=&quot;language-text&quot;&gt;clearAutomatically = true&lt;/code&gt;로 설정해 둔 상태였습니다.
&lt;br&gt; 테스트에서 직면한 문제처럼, 데이터를 수정(삭제)하였더라도 1차 캐시 내부에서는 수정 전 데이터가 존재할 수 있음을 인지하고 있었습니다.
&lt;br&gt; 이로인해, 수정 관련 쿼리가 실행된 후, 명시적으로 영속성 컨텍스트를 비워주었습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BookmarkRepository&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;JpaRepository&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Bookmark&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Modifying&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clearAutomatically &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;deleteAllByMemberId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; memberId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위와 같은 설정을 해두었음에도 불구하고, 영속성 컨텍스트가 비워지지 않았다는 사실을 납득하기 어려웠습니다.
하지만, 그 원인은 생각보다 쉽게 찾을 수 있었습니다.
우리가 사용한 &lt;code class=&quot;language-text&quot;&gt;@Modifying&lt;/code&gt; 어노테이션을 확인해 보니, 다음과같이 쓰여있었습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Indicates a query method should be considered as modifying query as that changes the way it needs to be executed. &lt;br&gt;
&lt;strong&gt;This annotation is only considered if used on query methods defined through a {@link Query} annotation.&lt;/strong&gt;&lt;br&gt; It&apos;s not
applied on custom implementation methods or queries derived from the method name as they already have control over
the underlying data access APIs or specify if they are modifying by their name.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;우리가 주목할 점은, 위 설명의 두 번째 줄이었습니다.
&lt;br&gt; 간단하게 설명하자면, &lt;code class=&quot;language-text&quot;&gt;@Modifying&lt;/code&gt; 어노테이션은 &lt;code class=&quot;language-text&quot;&gt;@Query&lt;/code&gt; 어노테이션과 함께 사용될 때만 효력이 있다는 것입니다.
&lt;br&gt; 즉, 아래와 같은 &lt;code class=&quot;language-text&quot;&gt;NamedQeury&lt;/code&gt;를 사용할 때는 옵션값을 넣어주더라도 동작하지 않았던 것이죠.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BookmarkRepository&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;JpaRepository&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Bookmark&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Modifying&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clearAutomatically &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;deleteAllByMemberId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; memberId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;문제 해결&lt;/h3&gt;
&lt;p&gt;(1) &lt;code class=&quot;language-text&quot;&gt;@Query&lt;/code&gt; 어노테이션을 사용하여 직접 쿼리를 작성하는 방법과, (2) 테스트 코드에서 flush &amp;#x26; clear를 명시적으로 수행하는 방법이 있었습니다.
&lt;br&gt; 단순히 테스트 통과에 목적을 둔 것이 아니기 때문에, 실제 프로덕트 코드에서도 예상치 못한 동작을 방지하기 위해 (1)번 방법을 선택하였습니다.
&lt;br&gt; 이에 따라, &lt;code class=&quot;language-text&quot;&gt;Named Query -&gt; JPQL&lt;/code&gt;로 변경함으로써 문제를 해결할 수 있었습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;BookmarkRepository&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;JpaRepository&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Bookmark&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Modifying&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clearAutomatically &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Query&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;delete from Bookmark b where b.member.id = :memberId&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;deleteAllByMemberId&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Param&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;memberId&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Long&lt;/span&gt; memberId&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[괜찮을지도의 Nginx 활용법]]></title><description><![CDATA[이 글은 우아한테크코스 괜찮을지도팀의 가 작성했습니다. 지난 글 GitHub Actions로 CI/CD 구축하기에서 현재 저희 프로젝트의 인프라 구조를 간략하게 이미지로 설명드렸습니다. 다시 이미지를 보여드리자면, 서버의 앞단에서 Nginx…]]></description><link>https://map-befine-official.github.io/how-to-use-nginx/</link><guid isPermaLink="false">https://map-befine-official.github.io/how-to-use-nginx/</guid><pubDate>Tue, 01 Aug 2023 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 우아한테크코스 괜찮을지도팀의 &lt;code class=&quot;language-text&quot;&gt;도이&lt;/code&gt;가 작성했습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;지난 글 &lt;a href=&quot;https://map-befine-official.github.io/github-actions-ci-cd&quot;&gt;GitHub Actions로 CI/CD 구축하기&lt;/a&gt;에서&lt;br&gt;
현재 저희 프로젝트의 인프라 구조를 간략하게 이미지로 설명드렸습니다.&lt;/p&gt;
&lt;p&gt;다시 이미지를 보여드리자면, 서버의 앞단에서 Nginx를 사용하고 있는데요.&lt;/p&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/45ee08747158f5004979e90c9b76cdf4/77dcf/infra_nginx.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 41.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABYklEQVR42oVSy27CMBDMn/cXOFH1E3rsseqtFw4UIQUUDhxQAgkOSdqEOLEdP6a2UyhIlbrS2Ct7PfsYB8YY3OJP0wqQ/Arjdj2ANhWOJEe+fAN7f/ShgVuGYfC4mFIKUkoPn0QJaJfQXV6TGnDGoK0n2wqKbOyRRlDXNRaLBebzOZzvSIqiQBzHSJIEXc+AvoUhR6iihOlrCEsgbdJ4H4Nz/sNvqdWAYL1eoyxLnE4nRFHkq3PVUkohhBiDSYbNMURKdlA5wZm2kIPEfpeCdeyecLVaYTqdYjKZIAxDX2FVVZ6waRp03D44U7x8PCPazrzf2aq0UZglr2i4bVdqCBs38G6cYZZlSNPUJ3JVudbdWU4I+r53qsAcDjBfNYxo8JlnaDnF0/IB+/MWA1N2NBS8a0fCf80pa1vycmjpBVG2kzzNwXv2+xNcy6Nw91/m4pursnY+UoxwhPahx63vYDS+AbnzZ8y1wl3+AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;infra_nginx.png&apos; title=&apos;&apos; src=&apos;/static/45ee08747158f5004979e90c9b76cdf4/ca1dc/infra_nginx.png&apos; srcset=&apos;/static/45ee08747158f5004979e90c9b76cdf4/e7570/infra_nginx.png 170w,
/static/45ee08747158f5004979e90c9b76cdf4/f46e7/infra_nginx.png 340w,
/static/45ee08747158f5004979e90c9b76cdf4/ca1dc/infra_nginx.png 680w,
/static/45ee08747158f5004979e90c9b76cdf4/77dcf/infra_nginx.png 930w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;infra_nginx.png&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;⚠️ 편의상 개발 서버, DB 서버 부분은 생략하고 확대한 이미지입니다.&lt;br&gt;
개발 서버의 Nginx도 같은 역할을 수행합니다.&lt;br&gt;
또, 80 포트 요청에 대해서도 443 포트로 리다이렉트해주고 있으나 이 또한 편의상 그림에는 생략하고 있습니다.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;이번 글에서는 Nginx의 모든 것에 대해 설명하기보다는 Nginx를 왜 썼는지, 어떻게 썼는지에 초점을 맞춰보도록 하겠습니다.  &lt;/p&gt;
&lt;h2&gt;Nginx란?&lt;/h2&gt;
&lt;p&gt;그래도 이게 뭔지 알아야겠죠? 간단하게 설명하면, 경량화된 웹 서버 프로그램입니다.&lt;br&gt;
정적 파일을 제공하는 HTTP 서버로도, 리버스 프록시 서버로도 사용할 수 있습니다.  &lt;/p&gt;
&lt;p&gt;이제 저희의 Nginx 설정 파일을 보면서 어떻게 활용했는지 설명드리겠습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;설정 파일은 과거 방식으로는 /etc/nginx/sites-available 또는 /sites-enabled에서 관리하고,&lt;br&gt;
최신 방법으로는 /etc/nginx/conf.d 디렉토리에서 관리합니다.&lt;br&gt;
또, 전역 설정을 관리하는 파일로는 &lt;code class=&quot;language-text&quot;&gt;/etc/nginx/nginx.conf&lt;/code&gt;가 있습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;properties&quot;&gt;&lt;pre class=&quot;language-properties&quot;&gt;&lt;code class=&quot;language-properties&quot;&gt;&lt;span class=&quot;token key attr-name&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;        # (1) HTTPS 적용 전, 서버 이름 지정&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        server_name&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;${도메인};&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;        # (1) HTTPS 적용 : SSL을 사용하여 443포트에서 수신&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        listen&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;443 ssl; # managed by Certbot&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        ssl_certificate&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/etc/letsencrypt/live/${도메인}/fullchain.pem; # managed by Certbot&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        ssl_certificate_key&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/etc/letsencrypt/live/${도메인}/privkey.pem; # managed by Certbot&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        include&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        ssl_dhparam&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;        # (3) 웹 서버의 루트 디렉토리 지정&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        root&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/var/www/html;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;        # (3) 웹 서버가 디렉토리를 열 때 사용할 기본 파일 지정 (나열된 순서대로 탐색)&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        index&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;index.html index.htm index.nginx-debian.html;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;        # (2, 3) 루트 URL에 대한 동작 정의 : 프론트엔드 정적 파일 서브&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        location&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/ {&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;            root&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/usr/share/nginx/html/dist;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;            include&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/etc/nginx/mime.types;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;            try_files&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;$uri $uri/ /index.html;&lt;/span&gt;
        }

&lt;span class=&quot;token comment&quot;&gt;        # (2) /api/ URL에 대한 동작 정의 : 백엔드 API 연결&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        location&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/api/ {&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;            rewrite&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;^/api/(.*) /$1?$args break;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;            proxy_pass&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;http://${서버 IP 주소}:8080;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;            proxy_set_header&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;Host $host;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;            proxy_set_header&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;X-Real-IP $remote_addr;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;            proxy_set_header&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;X-Forwarded-For $proxy_add_x_forwarded_for;&lt;/span&gt;
        }
}

&lt;span class=&quot;token comment&quot;&gt;# 해당 도메인에 대해 80번 포트 HTTP 요청이 오면 HTTPS로 리다이렉션&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    if&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;($host = ${도메인}) {&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;        return&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;301 https://$host$request_uri;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    }&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;# managed by Certbot&lt;/span&gt;
    
    
&lt;span class=&quot;token key attr-name&quot;&gt;    listen&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;80 ;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    listen&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;[::]:80 ;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    server_name&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;${도메인};&lt;/span&gt;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;(1) HTTPS 적용하기&lt;/h2&gt;
&lt;p&gt;SSL 인증서만 있으면, 웹서버를 통해 쉽게 HTTPS 프로토콜을 적용할 수 있습니다.&lt;br&gt;
무료 이용이 가능하고, &lt;code class=&quot;language-text&quot;&gt;Nginx&lt;/code&gt;와 통합하여 사용하기 좋은 &lt;code class=&quot;language-text&quot;&gt;Certbot&lt;/code&gt;을 사용해 이를 적용했습니다.&lt;br&gt;
전체적인 흐름은 아래와 같습니다.  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;도메인을 구매하고, 레코드 A에 public IP 주소를 등록한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Cerbot&lt;/code&gt;을 설치한다.&lt;/li&gt;
&lt;li&gt;설정 파일의 server_name을 구매한 도메인으로 변경한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Certbot&lt;/code&gt;을 이용해 구매한 도메인을 이용해 SSL 인증서를 발급받는다.&lt;/li&gt;
&lt;li&gt;인증서를 발급받으면, &lt;code class=&quot;language-text&quot;&gt;Certbot&lt;/code&gt;이 자동으로 설정 파일에서 server_name이 일치하는 블록을 찾아 SSL 관련 내용들을 추가해준다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;# managed by Certbot&lt;/code&gt;이라는 주석이 붙어있는 내용들이 &lt;code class=&quot;language-text&quot;&gt;Certbot&lt;/code&gt;이 추가해준 내용입니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Certbot&lt;/code&gt;은 SSL 인증 발급 도구로, 무료 SSL 인증서 발급 기관인 &lt;code class=&quot;language-text&quot;&gt;Let&apos;s Encrypt&lt;/code&gt;와 통합되어 있습니다.&lt;br&gt;
이를 통해 쉽게 SSL 인증서를 발급받을 수 있습니다.&lt;br&gt;
또, &lt;code class=&quot;language-text&quot;&gt;Nginx&lt;/code&gt; 설정 파일을 자동 업데이트하는 방식으로 SSL 인증서를 적용할 수 있어 편리합니다.
단, 유효 기간이 90일이기 때문에 자동 갱신 설정이 별도로 필요합니다.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;하단에 첨부한 참고 자료와 같이, 잘 정리된 자료가 기존에 많기 때문에 자세한 내용은 생략하겠습니다.&lt;/p&gt;
&lt;h2&gt;(2) 프론트엔드, 백엔드 요청 구분하기&lt;/h2&gt;
&lt;p&gt;저희 프로젝트의 인프라 구조에서는 프론트엔드와 백엔드가 같은 서버를 공유하므로&lt;br&gt;
클라이언트가 이용하는 화면에 대한 요청과, 백엔드 API에 대한 요청을 구분할 필요가 있었습니다.  &lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;location&lt;/code&gt; 블록을 사용해 특정 URL에 대한 동작을 설정하는 방식으로 이를 구분할 수 있었습니다.  &lt;/p&gt;
&lt;p&gt;해당하는 부분을 가져와 설명드리겠습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;properties&quot;&gt;&lt;pre class=&quot;language-properties&quot;&gt;&lt;code class=&quot;language-properties&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 루트 URL에 대해 프론트엔드 정적 파일 서브&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/ {&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    root&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/usr/share/nginx/html/dist;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    include&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/etc/nginx/mime.types;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    try_files&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;$uri $uri/ /index.html;&lt;/span&gt;
}

&lt;span class=&quot;token comment&quot;&gt;# /api/ URL에 대해 백엔드 API 연결&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/api/ {&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    rewrite&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;^/api/(.*) /$1?$args break; # URL에서 /api 제거&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    proxy_pass&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;http://${서버 IP 주소}:8080;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    proxy_set_header&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;Host $host;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    proxy_set_header&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;X-Real-IP $remote_addr;&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;    proxy_set_header&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;X-Forwarded-For $proxy_add_x_forwarded_for;&lt;/span&gt;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;https://mapbefine.com/api/&lt;/code&gt; 로 시작하는 URL에 대해서는 백엔드 API와 연결합니다.  &lt;/p&gt;
&lt;p&gt;이 설정을 맞추어, 백엔드 코드에서 &lt;code class=&quot;language-text&quot;&gt;/api&lt;/code&gt;가 추가된 요청 URL을 매핑할 수도 있습니다.&lt;br&gt;
하지만 이는 자원을 명시하기 위한 내용보다는 요청을 구분하기 위함이므로,&lt;br&gt;
리버시 프록시를 거치고 나면 실제로는 &lt;code class=&quot;language-text&quot;&gt;/api&lt;/code&gt;를 제외한 요청 URL로 연결되도록 하였습니다.&lt;br&gt;
&lt;code class=&quot;language-text&quot;&gt;# URL에서 /api 제거&lt;/code&gt; 주석이 있는 부분이 해당하는 내용입니다.  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;proxy_set_header&lt;/code&gt;는 Nginx가 프록시 요청을 전달하기 전에, HTTP 요청 헤더를 설정하는 지시문입니다.&lt;br&gt;
원래 요청의 호스트 이름을 백엔드 서버에 전달합니다.&lt;br&gt;
필수 설정은 아니지만 IP 기반의 접근 제어, 로깅, 다중 호스트 설정 등에 유용할 수 있다고 합니다.  &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;(3) 정적 파일 서브하기&lt;/h2&gt;
&lt;p&gt;저희는 프론트엔드의 React를 서버에서 실행시키는 대신, 빌드 결과물을 정적 파일로 서브하는 방식을 택하였습니다.&lt;br&gt;
이유는 다음과 같습니다.  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;어플리케이션을 서버 내에 실행하여 동적으로 파일을 생성해야 하는 상황이 아닙니다.&lt;/li&gt;
&lt;li&gt;정적 파일로 서브하여 서버 메모리를 절약할 수 있습니다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;어플리케이션을 실행시킨 상태라면, 해당하는 URL에 대해 3000번 포트로 포워딩해주면 됩니다.&lt;/p&gt;
&lt;p&gt;반면 정적 파일로 서브한다면 어떻게 해야 할요?&lt;br&gt;
해당하는 부분을 가져와 설명드리겠습니다.&lt;/p&gt;
&lt;p&gt;아래 내용은 설정 파일의 기본 값과 같습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;properties&quot;&gt;&lt;pre class=&quot;language-properties&quot;&gt;&lt;code class=&quot;language-properties&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# (3) 웹 서버의 루트 디렉토리 지정&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;root&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;/var/www/html;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# (3) 웹 서버가 디렉토리를 열 때 사용할 기본 파일 지정 (나열된 순서대로 탐색)&lt;/span&gt;
&lt;span class=&quot;token key attr-name&quot;&gt;index&lt;/span&gt; &lt;span class=&quot;token value attr-value&quot;&gt;index.html index.htm index.nginx-debian.html;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;https://mapbefine.com&lt;/code&gt; 요청이 들어오면, Nginx는 루트 디렉토리의 &lt;code class=&quot;language-text&quot;&gt;index.html&lt;/code&gt;을 우선적으로 찾아 반환합니다.&lt;br&gt;
따라서 해당 웹 서버의 루트 디렉토리에 우리의 빌드 결과물인 &lt;code class=&quot;language-text&quot;&gt;index.html&lt;/code&gt;와 모듈 파일들을 위치시키면 됩니다.&lt;br&gt;
반대로, 정적 파일을 저장하고 있는 위치를 root 값으로 설정해주어도 좋습니다.&lt;/p&gt;
&lt;h2&gt;결론&lt;/h2&gt;
&lt;p&gt;괜찮을지도 서버의 Nginx는&lt;br&gt;
클라이언트와 WAS(Spring Boot) 사이에 Nginx를 두어 리버스 프록시 서버로 사용하며,&lt;br&gt;
동시에 HTTPS 적용을 해결하고 HTTP 서버와 같이 정적 파일 서브도 수행하고 있습니다.&lt;/p&gt;
&lt;p&gt;다만 현재 규모에서 간단한 방법을 택한 것으로,&lt;br&gt;
서비스의 규모가 커짐에 따라 정적 파일을 별도 서버에 관리하는 것이 유리하거나 동적인 파일 생성이 필요한 경우 활용 방식은 얼마든지 달라질 수 있을 것입니다.&lt;/p&gt;
&lt;h2&gt;참고자료&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://nginx.org/en/docs/&quot;&gt;Nginx 공식 문서&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;https://www.baeldung.com/linux/sites-available-sites-enabled-conf-d&quot;&gt;baledung - sites-available &amp;#x26; sites-enabled, conf.d 설정 파일 방식 차이&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;https://hudi.blog/https-with-nginx-and-lets-encrypt/&quot;&gt;Nginx와 Let&apos;s Encrypt로 HTTPS 웹 서비스 배포하기 (feat. Certbot)&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-22-04&quot;&gt;how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-22-04 (Step2 부분 참고)&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[인수테스트에서 테스트 격리하기!]]></title><description><![CDATA[이 글은 우아한테크코스 괜찮을지도팀의 가 작성했습니다I 테스트 간 격리.. 왜 필요할까? 우리는 프로덕션 코드의 신뢰성을 보장하기 위해서 테스트 코드를 작성한다. 그렇기 때문에, 테스트 코드는 100번을 실행시키던 10…]]></description><link>https://map-befine-official.github.io/how-to-isolating-test/</link><guid isPermaLink="false">https://map-befine-official.github.io/how-to-isolating-test/</guid><pubDate>Mon, 31 Jul 2023 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 우아한테크코스 괜찮을지도팀의 &lt;code class=&quot;language-text&quot;&gt;매튜&lt;/code&gt;가 작성했습니다I&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2&gt;테스트 간 격리.. 왜 필요할까?&lt;/h2&gt;
&lt;p&gt;우리는 프로덕션 코드의 신뢰성을 보장하기 위해서 테스트 코드를 작성한다.&lt;/p&gt;
&lt;p&gt;그렇기 때문에, 테스트 코드는 100번을 실행시키던 100만번을 실행시키던, 동일한 결과를 내뱉어야한다.&lt;/p&gt;
&lt;p&gt;테스트 코드를 아무리 잘 작성하더라도, 매번 테스트의 결과가 다르다면 의미가 없다.&lt;/p&gt;
&lt;p&gt;예를 들어 아래와 같은 테스트가 있다고 해보자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@DataJpaTest&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ExampleTest&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  

    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Autowired&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PinRepository&lt;/span&gt; pinRepository&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
      
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Test&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; 모든_핀을_조회한다&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token comment&quot;&gt;// given  &lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;Pin&lt;/span&gt; pin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Pin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        pinRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
          
        &lt;span class=&quot;token comment&quot;&gt;// when  &lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Pin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; pins &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pinRepository&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;findAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token comment&quot;&gt;// then  &lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;assertAll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;  
                &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pins&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hasSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
                &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;assertThat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pins&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isEqualTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;정상적인 경우라면, 위 테스트는 통과해야한다.&lt;/p&gt;
&lt;p&gt;하지만, 테스트 간 격리를 진행하지 않은 상태에서 이 테스트 이전에 다른 테스트에서 pin 을 저장하는 동작을 수행했고, 데이터를 지워주지 않았다면?&lt;/p&gt;
&lt;p&gt;해당 테스트는 실패하게 될 것이다.&lt;/p&gt;
&lt;p&gt;위 테스트는 이전에 수행된 테스트들의 동작에도 영향을 받는, 독립적이지 못한 테스트가 된 것이다.&lt;/p&gt;
&lt;p&gt;이것이 바로 테스트 간 격리가 필요한 이유이다.&lt;/p&gt;
&lt;p&gt;그렇다면 위와 같은 상황을 @Transactional 어노테이션만으로 완벽하게 예방할 수 있을까?&lt;/p&gt;
&lt;p&gt;결론부터 말하자면 그럴 수 없다.&lt;/p&gt;
&lt;p&gt;@SpringBootTest 를 사용하는 인수테스트 같은 경우는 Port 를 지정하여 서버를 띄우게 되는데, 이 때 HTTP 클라이언트와 서버는 각기 다른 스레드에서 실행되게 된다.&lt;/p&gt;
&lt;p&gt;그렇기 때문에 테스트 코드에 @Transactional 있더라도 호출되는 쪽은 다른 스레드에서 새로운 트랜잭션을 커밋하기 때문에, 롤백 전략은 무색해지게 되고, 테스트 간 격리도 제대로 이행될 수가 없는 것이다.&lt;/p&gt;
&lt;h2&gt;그렇다면 격리를 위해 사용할 수 있는 방법들은 무엇이 있을까?&lt;/h2&gt;
&lt;p&gt;이번 포스트를 통해서 다뤄볼 방법은 3가지이다.&lt;/p&gt;
&lt;p&gt;바로 &lt;code class=&quot;language-text&quot;&gt;Dirtiest Context&lt;/code&gt;,  &lt;code class=&quot;language-text&quot;&gt;@Sql 어노테이션&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Entity Manager&lt;/code&gt; 이다.&lt;/p&gt;
&lt;p&gt;하나씩 짚어보면서 넘어가보자.&lt;/p&gt;
&lt;h3&gt;DirtiesContext&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@DirtiesContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;classMode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DirtiesContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ClassMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BEFORE_EACH_TEST_METHOD&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token annotation punctuation&quot;&gt;@SpringBootTest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;webEnvironment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SpringBootTest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WebEnvironment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;RANDOM_PORT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ExampleTest&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;DiriesContext&lt;/code&gt; 는 현재 테스트를 실행하고자 하는 컨텍스트에 빈이 로드되어 있으면 Dirties 를 확인하고 Bean 들을 Reload 하게 된다.&lt;/p&gt;
&lt;p&gt;즉, 테이블도 다시 만들기 때문에 테스트 간의 격리가 가능하다.&lt;/p&gt;
&lt;p&gt;하지만, 매번 테스트하기 이전에 컨텍스트를 Reload 하게 된다면, 테스트 시간은 한없이 길어지게 될 것이기 때문이다.&lt;/p&gt;
&lt;p&gt;테스트의 장점은 프로덕션 코드의 신뢰성을 보장함에도 존재하지만, 개발자가 개발을 진행중에 코드를 올바르게 작성중인지 바로 바로 응답받기 위한 수단이기도 하다.&lt;/p&gt;
&lt;p&gt;따라서, 응답 속도는 개발 진행 속도와 크게 연관되어 있는 것이다.&lt;/p&gt;
&lt;p&gt;하지만, 인수테스트에 DirtiesContext 를 난사하게 되면, 매 테스트 실행마다 속이 터지는 경험을 하게 될 것이다.&lt;/p&gt;
&lt;h3&gt;@Sql 어노테이션&lt;/h3&gt;
&lt;p&gt;해당 방법은 꽤나 획기적인 방법이다.&lt;/p&gt;
&lt;p&gt;간단한 sql 구문만으로 테스트 간의 격리를 이뤄낼 수 있다. &lt;/p&gt;
&lt;p&gt;어떤 이는 외래키 제약 조건으로 인해 한번에 데이터를 삭제하는 것이 불가능하다고 생각할 수도 있지만, 아래 코드와 같이 외래키 제약 조건을 해제해주고 데이터를 삭제하는 것이 가능하다. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; FOREIGN_KEY_CHECKS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;TRUNCATE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;TABLE&lt;/span&gt; 테이블이름&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;SET&lt;/span&gt; FOREIGN_KEY_CHECKS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@DataJpaTest&lt;/span&gt;
&lt;span class=&quot;token annotation punctuation&quot;&gt;@Sql&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/truncate.sql&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ExampleTest&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;하지만, 해당 방법에도 단점은 존재한다.&lt;/p&gt;
&lt;p&gt;바로, 테이블이 추가될 때마다, 해당 sql 구문을 수정해주어야 한다는 것이다.&lt;/p&gt;
&lt;p&gt;큰 단점은 아니지만, 항상 신경써주어야 한다는 점에서 조금은 아쉽다는 생각이 든다. &lt;/p&gt;
&lt;h3&gt;Entity Manager&lt;/h3&gt;
&lt;p&gt;위에서도 언급하였듯 &lt;code class=&quot;language-text&quot;&gt;@Sql&lt;/code&gt; 어노테이션은 정말 강력하지만, 테이블이 추가될 때마다 sql 구문을 다시 수정해주어야 한다는 단점이 존재했다.&lt;/p&gt;
&lt;p&gt;이 때, &lt;code class=&quot;language-text&quot;&gt;@Sql&lt;/code&gt; 어노테이션의 장점을 모두 가져가면서, 위에서 언급한 단점도 보완할 수 있는 방법이 있다.&lt;/p&gt;
&lt;p&gt;바로 &lt;code class=&quot;language-text&quot;&gt;Entity Manager&lt;/code&gt; 를 활용하는 방법이다.&lt;/p&gt;
&lt;p&gt;도대체 어떻게? &lt;code class=&quot;language-text&quot;&gt;Entity Manager&lt;/code&gt; 를 통해서 Data 를 지운다는 것일까?&lt;/p&gt;
&lt;p&gt;우리는 개발자이니 코드를 통해 살펴보자. &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Componenet&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DatabaseCleanup&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;InitializingBean&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  

	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;UNDERSCORE&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;_&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@PersistenceContext&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EntityManager&lt;/span&gt; entityManager&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; tableNames&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;afterPropertiesSet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        tableNames &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; entityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMetamodel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEntities&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stream&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;entityType &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; entityType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getJavaType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getAnnotation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Entity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;entityType &lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;convertTableNameFromCamelCaseToSnakeCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;entityType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
                &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;convertTableNameFromCamelCaseToSnakeCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; tableName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;StringBuilder&lt;/span&gt; tableNameSnake &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringBuilder&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; letter &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; tableName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toCharArray&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            &lt;span class=&quot;token function&quot;&gt;addUnderScoreForCapitalLetter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tableNameSnake&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; letter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            tableNameSnake&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;letter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; tableNameSnake&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;substring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toLowerCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;addUnderScoreForCapitalLetter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;StringBuilder&lt;/span&gt; tableNameSnake&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; letter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Character&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isUpperCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;letter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            tableNameSnake&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;UNDERSCORE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Entity Manager 를 통해 데이터를 관리하기 위해 DatabaseCleanup 이라는 객체를 생성해줬다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;InitializingBean&lt;/code&gt; 을 implements 해 &lt;code class=&quot;language-text&quot;&gt;afterPropertiesSet&lt;/code&gt; 메서드를 구현하게되면, 프로퍼티가 모두 초기화되었을 때, BeanFactory에 의해 자동으로 해당 메서드가 호출되게 된다.&lt;/p&gt;
&lt;p&gt;그러니, 해당 메서드의 내부 구현으로 Entity 들의 ClassName 을 이용하여 모든 테이블명을 생성해내어 저장하면 된다. (Entity Class 명을 Camel Case -&gt; Snake Case 로 변환해준다. &lt;code class=&quot;language-text&quot;&gt;convertTableNameFromCamelCaseToSnakeCase&lt;/code&gt; 가 해당 동작을 수행해주고 있다.)&lt;/p&gt;
&lt;p&gt;위와 같이 모든 테이블명을 생성해내어 저장했다면, 해당 테이블 명들을 이용하여 Data 를 모두 지워주는 execute 를 구현해주자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@Service&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DatabaseCleanup&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;InitializingBean&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  

	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;SET_REFERENTIAL_INTEGRITY_SQL_MESSAGE&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;SET REFERENTIAL_INTEGRITY %s&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TRUNCATE_SQL_MESSAGE&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TRUNCATE TABLE %s&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
	&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ID_RESET_SQL_MESSAGE&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ALTER TABLE %s ALTER COLUMN ID RESTART WITH 1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@PersistenceContext&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EntityManager&lt;/span&gt; entityManager&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; tableNames&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

	&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

	&lt;span class=&quot;token annotation punctuation&quot;&gt;@Transactional&lt;/span&gt;  
	&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
	    entityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
	    entityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createNativeQuery&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SET_REFERENTIAL_INTEGRITY_SQL_MESSAGE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;executeUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
	  
	    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; tableName &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; tableNames&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
	        entityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createNativeQuery&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TRUNCATE_SQL_MESSAGE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tableName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;executeUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
	        entityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createNativeQuery&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ID_RESET_SQL_MESSAGE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tableName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;executeUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
	    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
	  
	    entityManager&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createNativeQuery&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SET_REFERENTIAL_INTEGRITY_SQL_MESSAGE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;executeUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위의 코드를 순서대로 간단하게 설명해보자면&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;외래키 제약조건을 비활성화 해준다. &lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;afterPropertiesSet&lt;/code&gt; 을 통해 생성해놓은 모든 테이블 명들을 이용하여 Data 들을 모두 Truncate 해주고, ID 값을 다시 세팅해준다.&lt;/li&gt;
&lt;li&gt;외래키 제약조건을 활성화해준다. &lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;이런 Flow 로 흘러가는 execute 메서드를 구현해주었다면&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token annotation punctuation&quot;&gt;@SpringBootTest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;webEnvironment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SpringBootTest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WebEnvironment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;RANDOM_PORT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ExampleTest&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@LocalServerPort&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; port&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Autowired&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DatabaseCleanup&lt;/span&gt; databaseCleanup&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@BeforeEach&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setUp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;RestAssured&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;port &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; port&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@AfterEach&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tearDown&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        databaseCleanup&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 코드와 같이 @AfterEach 를 통해 매 인수테스트 동작 이후 실행시켜주면, 모든 테스트들을 격리할 수 있게 되는 것이다.&lt;/p&gt;
&lt;h2&gt;결론&lt;/h2&gt;
&lt;p&gt;지금으로서는 데이터 삭제가 쉽고, 테이블이 추가되었을 때 sql 구문을 수정하지 않아도 되는 &lt;code class=&quot;language-text&quot;&gt;Entity Manager&lt;/code&gt; 를 통해 테스트를 격리하는 것이 최선의 방법으로 보인다.&lt;/p&gt;
&lt;p&gt;하지만, 추후에 이보다 더 좋은 방법을 발견하면, 면밀히 검토해보고 바꿀 의사가 충분하다고 생각한다.&lt;/p&gt;
&lt;h2&gt;참고&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://tecoble.techcourse.co.kr/post/2020-09-15-test-isolation/&quot;&gt;https://tecoble.techcourse.co.kr/post/2020-09-15-test-isolation/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[EC2 환경 변수 적용 및 Actions Runner에 환경 변수 적용이 안되는 이슈]]></title><description><![CDATA[이 글은 우테코 괜찮을지도의 가 작성하였습니다. 배경 괜찮을지도 서비스는 CI/CD 툴로 Github Actions를 적용하였습니다.
 자세한 내용이 궁금하다면 ? 괜찮을지도 CI/CD 구축기 바로가기 프로젝트의 설정 파일(.yml)은 DB…]]></description><link>https://map-befine-official.github.io/trouble-shooting-actions-runner/</link><guid isPermaLink="false">https://map-befine-official.github.io/trouble-shooting-actions-runner/</guid><pubDate>Mon, 31 Jul 2023 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 우테코 괜찮을지도의 &lt;code class=&quot;language-text&quot;&gt;쥬니&lt;/code&gt;가 작성하였습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;배경&lt;/h3&gt;
&lt;p&gt;괜찮을지도 서비스는 CI/CD 툴로 Github Actions를 적용하였습니다.
&lt;br&gt; 자세한 내용이 궁금하다면 ? &lt;a href=&quot;/contents/posts/github-actions-ci-cd/index.md&quot;&gt;괜찮을지도 CI/CD 구축기 바로가기&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;프로젝트의 설정 파일(.yml)은 DB 주소 등 민감한 정보를 담고 있었기 때문에, 이를 저장소에 그대로 업로드할 수 없었습니다.
&lt;br&gt;위 문제점을 해결하기 위한 과정과 실제 우리가 직면한 문제를 설명해 드리고자 합니다.&lt;/p&gt;
&lt;h3&gt;환경변수 적용&lt;/h3&gt;
&lt;p&gt;괜찮을지도는 환경 변수를 활용하여 민감한 정보를 숨기기로 했습니다.
이에 따라, 각 배포 환경(prod, dev)에 맞는 설정 파일을 아래와 같이 작성하였습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# `application-dev`의 일부 &lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;spring&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;datasource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;driver-class-name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; com.mysql.cj.jdbc.Driver
    &lt;span class=&quot;token key atrule&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;MYSQL_DATABASE_URL&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; 
    &lt;span class=&quot;token key atrule&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;MYSQL_DATABASE_USER_NAME&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;MYSQL_DATABASE_PASSWORD&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;설정 파일에서 사용한 환경 변수는 각 EC2 인스턴스에서 관리하도록 하였습니다.
&lt;br&gt;EC2 인스턴스에 환경변수를 적용하는 방법은 아래와 같습니다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;1. EC2 터미널에 접속한다.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;2. &apos;sudo vim ~/.bashrc&apos; 명령어를 입력한다.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;3. .bashrc 파일의 맨 아래에 아래와 같이 필요한 환경변수를 입력한 뒤, 저장한다.&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 기존 .bashrc 코드 생략 &lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# Database&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;profile&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;dev&apos;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;MYSQL_DATABASE_URL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Database url&apos;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;MYSQL_DATABASE_USER_NAME&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;User name&apos;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;MYSQL_DATABASE_PASSWORD&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Password&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;4. &apos;source ~/.bashrc&apos; 명령어를 입력하여 환경변수를 업데이트해 준다.&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;5. &apos;echo $profile&apos; 명령어를 입력하여 환경변수가 적용되었는지 확인한다.&lt;/code&gt;&lt;/p&gt;
&lt;h3&gt;환경 변수가 Actions Runner 동작에 적용되지 않는 이슈&lt;/h3&gt;
&lt;p&gt;우리는 위 과정을 통해, 환경 변수가 EC2에 올바르게 적용된 것을 확인했습니다.
&lt;br&gt;실제로, 아래와 같은 명령어를 통해 어플리케이션을 실행할 경우 &lt;code class=&quot;language-text&quot;&gt;profile&lt;/code&gt;로 설정한 환경변수인 dev가 올바르게 적용되는 것을 확인할 수 있었습니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# $JAR_FILE_PATH는 &apos;deploy.sh&apos; 파일 내에 존재하는 jar 파일의 경로를 나타내는 변수입니다.&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;nohup&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-E&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;java&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-jar&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$JAR_FILE_PATH&lt;/span&gt;/mapbefine.jar &lt;span class=&quot;token parameter variable&quot;&gt;--spring.profiles.active&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$profile&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$JAR_FILE_PATH&lt;/span&gt;/deploy.log &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$JAR_FILE_PATH&lt;/span&gt;/deploy-err.log &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/aeefe9b57b1e8d4ae02a373d8e985894/d50f3/active-profile-dev.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 16.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAlklEQVR42nVO0Q6DIBDzRQHRRFQIczFOUED///+6gyW+7aFpr9f0rpq1gRonjASlxsJd34Mx9hdtKyG7DlJK0i2EEOCcF1TL8sa+O1j7gqbyPA/DgLquKcBKiDH+cNM0j5+LhOC/Q6VQoEop4bouxJgQQiR9QxuDaZ7hnIPzDsdx4DxPbJ+N/AnruhbPe18yeRdioKcsvv8eSSlotqJIAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;active profile dev&apos; title=&apos;&apos; src=&apos;/static/aeefe9b57b1e8d4ae02a373d8e985894/ca1dc/active-profile-dev.png&apos; srcset=&apos;/static/aeefe9b57b1e8d4ae02a373d8e985894/e7570/active-profile-dev.png 170w,
/static/aeefe9b57b1e8d4ae02a373d8e985894/f46e7/active-profile-dev.png 340w,
/static/aeefe9b57b1e8d4ae02a373d8e985894/ca1dc/active-profile-dev.png 680w,
/static/aeefe9b57b1e8d4ae02a373d8e985894/02d09/active-profile-dev.png 1020w,
/static/aeefe9b57b1e8d4ae02a373d8e985894/9d567/active-profile-dev.png 1360w,
/static/aeefe9b57b1e8d4ae02a373d8e985894/d50f3/active-profile-dev.png 2788w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;하지만, Actions Runner를 통해 CD를 수행하는 경우 아래와 같이 환경 변수가 적용되지 않았습니다.
&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/203870e569e82274f809e7b13f7f26cc/346de/active-profile-default.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 14.117647058823529%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAnElEQVR42lWO2w6CMBBEeXF7E6NCUWhDxRrbB2iC//9vY0FM9OFkTiaZ7Ba6uUI3F1Rao9YNysMRxBhYhhjlpNW/EBE45xmx8e+F9w+0bYe61mg7g9O5wm4ZMf4z2Jx9XEoJpRSEEGtKmT13y8EipYRxHDMTFjfG5k81niEgxIApTZhfM+7eY1+WMLaDuzk459D3/cowDLDWIsaIN/1/SWo3y4voAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;active profile default&apos; title=&apos;&apos; src=&apos;/static/203870e569e82274f809e7b13f7f26cc/ca1dc/active-profile-default.png&apos; srcset=&apos;/static/203870e569e82274f809e7b13f7f26cc/e7570/active-profile-default.png 170w,
/static/203870e569e82274f809e7b13f7f26cc/f46e7/active-profile-default.png 340w,
/static/203870e569e82274f809e7b13f7f26cc/ca1dc/active-profile-default.png 680w,
/static/203870e569e82274f809e7b13f7f26cc/02d09/active-profile-default.png 1020w,
/static/203870e569e82274f809e7b13f7f26cc/9d567/active-profile-default.png 1360w,
/static/203870e569e82274f809e7b13f7f26cc/346de/active-profile-default.png 2770w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;원인 및 문제 해결&lt;/h3&gt;
&lt;p&gt;우리는 위 문제를 해결하기 위해, 아래와 같이 우리의 상황을 정리하였습니다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;터미널에서 쉘 스크립트를 실행할 경우, 환경 변수가 적용된다.&lt;/li&gt;
&lt;li&gt;Actions Runner를 통해 쉘 스크립트를 실행할 경우, 환경변수가 적용되지 않는다.&lt;/li&gt;
&lt;li&gt;CI/CD를 구축한 뒤에 환경 변수를 적용했다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;위 상황을 통해, 우리는 환경 변수를 적용하기 전, 이미 실행되고 있었던 Actions Runner에 환경변수가 적용되지 않았음을 직감할 수 있었습니다.
&lt;br&gt;실제로, 환경 변수는 프로세스가 시작될 때 해당 프로세스에게 제공되는 환경 설정의 일부이기 때문에, 위와 같은 문제가 발생한 것이었습니다.&lt;/p&gt;
&lt;p&gt;기존에 실행되고 있었던 Actions Runner 프로세스를 종료한 후, 재시작을 하였고 환경 변수가 올바르게 적용되는 것을 확인할 수 있었습니다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[GitHub Actions로 CI/CD 구축하기]]></title><description><![CDATA[이 글은 우테코 괜찮을지도팀의 가 작성했습니다. 보다 편리하고 안정적인 개발 및 배포를 위해, 괜찮을지도 서비스에 CI/CD를 적용하였습니다. 이를 위한 도구로 GitHub Actions(self hosted runner…]]></description><link>https://map-befine-official.github.io/github-actions-ci-cd/</link><guid isPermaLink="false">https://map-befine-official.github.io/github-actions-ci-cd/</guid><pubDate>Sat, 29 Jul 2023 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 우테코 괜찮을지도팀의 &lt;code class=&quot;language-text&quot;&gt;도이&lt;/code&gt;가 작성했습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;보다 편리하고 안정적인 개발 및 배포를 위해, 괜찮을지도 서비스에 CI/CD를 적용하였습니다.&lt;br&gt;
이를 위한 도구로 GitHub Actions(self hosted runner)를 선택한 이유와, 파이프라인, 적용 방법에 대해 설명드리겠습니다.&lt;/p&gt;
&lt;h2&gt;GitHub Actions를 사용한 이유&lt;/h2&gt;
&lt;p&gt;먼저 저희의 상황을 설명드리자면,
아래와 같은 제약 사항 안에서 개발 서버, 운영 서버의 분리가 필요했습니다.&lt;/p&gt;
&lt;h3&gt;제약 사항&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;EC2 최대 3개&lt;/li&gt;
&lt;li&gt;최대 t4g.small&lt;/li&gt;
&lt;li&gt;최대 20GiB&lt;/li&gt;
&lt;li&gt;매모리 2GiB&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;운영 서버에서 사용하는 DB는 서버 분리가 필요하다고 판단해, 세 대의 인스턴스를 각각 아래 그림과 같이 개발, 운영, 운영 DB 서버로 분담했습니다.&lt;br&gt;
그리고 이 제약 사항 안에서 알뜰하게 서버를 사용하고 트러블 슈팅하는 것을 저희의 기술적 도전으로 삼고자 합니다.&lt;/p&gt;
&lt;h3&gt;인프라 구조&lt;/h3&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/87e65d80fb642a2a2d8b157bf2909454/aaf92/infra.jpg&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3lAH/8QAFhAAAwAAAAAAAAAAAAAAAAAAACBB/9oACAEBAAEFAip//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRAAAgMBAAAAAAAAAAAAAAAAABEBECFR/9oACAEBAAE/Ic1Iiijgq//aAAwDAQACAAMAAAAQA8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAEBAQEAAwAAAAAAAAAAAAABEQAxECFB/9oACAEBAAE/ECeJezVViTDfiYKwFaw7gV9d8f/Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;infra&apos; title=&apos;&apos; src=&apos;/static/87e65d80fb642a2a2d8b157bf2909454/a22ce/infra.jpg&apos; srcset=&apos;/static/87e65d80fb642a2a2d8b157bf2909454/0b705/infra.jpg 170w,
/static/87e65d80fb642a2a2d8b157bf2909454/31389/infra.jpg 340w,
/static/87e65d80fb642a2a2d8b157bf2909454/a22ce/infra.jpg 680w,
/static/87e65d80fb642a2a2d8b157bf2909454/29373/infra.jpg 1020w,
/static/87e65d80fb642a2a2d8b157bf2909454/232dc/infra.jpg 1360w,
/static/87e65d80fb642a2a2d8b157bf2909454/aaf92/infra.jpg 1920w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;팀원들 모두가 CI/CD에 능숙하지 않은 상황에서 상대적으로 대중적이고 관련 자료를 쉽게 접할 수 있는 기술을 생각했을 때,&lt;br&gt;
Jenkins와 GitHub Actions가 고려 대상이었습니다.&lt;/p&gt;
&lt;p&gt;아래와 같은 이유로, 둘 중 GitHub Actions를 사용해 최대한 간단하게 CI/CD를 구축하는 것이 적합하다고 판단했습니다.  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;메모리 부담 최소화&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Jenkins를 사용하면, EC2에서 빌드 및 테스트를 수행해야 합니다.&lt;/li&gt;
&lt;li&gt;반면, GitHub Actions는 GitHub Artifact에 업로드한 빌드 결과물을 EC2에서 다운로드하면 됩니다.&lt;/li&gt;
&lt;li&gt;실제로 한 팀원이 EC2 t2g.micro에 젠킨스 CI/CD를 적용했다가, 메모리가 부족해 서버가 죽는 과거의 경험을 공유해주었습니다.&lt;/li&gt;
&lt;li&gt;때문에 적어도 CI 만큼은 GitHub Actions로 분리해 테스트 실행을 외부 서비스에 위임하기로 했습니다.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;하지만 그렇다면, 간결한 파이프라인을 위해 CI/CD를 모두 GitHub Actions로 통합하는 것이 좋다고 판단했습니다.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;EC2에서 &lt;code class=&quot;language-text&quot;&gt;./gradlew build&lt;/code&gt;를 수행해 직접 빌드 및 테스트를 할 경우 아래와 같이 총 26.2%의 사용량이 확인되지만,&lt;br&gt;
&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/3e3b041ba86d85b4ba5b6adb3ab991ab/ca756/ec2-build-usage.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 39.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoElEQVR42k2R2U7CUBCG+xJIvGWnLWWpUNqytGUTmlCgxHfwQhI3BKNeCHqhRo0RfdzfmRMgXvw5kzNz/vlmjvS9vMb7/BybuwU+by6xuV/i5+EWvySOP+ju63aOl/MZvrlmcYXns1O8Xszw9rTG43qN9Var1QqSU6vhJJxAz2uwq4bQ0B+gYVvouC56rRYMXUfdMtFqNhGOArRdB1o2i8NoFNF/ihxEIOn6EYJgBKNahUMGHhkMg2AfsxqNJlzXw2DgYxKGGE8mMC0LqXQasiwjS+Y7SfF4HJ1OB2lKNomgXC5DVRQopHw+j1KpBNuuoV6v47jXw3Q6Rb/fJ/OBMEgkEkKpVArJZBISBy7RZDIZ1Gh8wzCQy+WgqioKhYIwrVQq4p4bBkTf7XZFzM3YVNM08V4YyrKCdrstEkzBhFygbA1LtL+qacKiET3Pw3g8FoZM6DgO0dswKb83ZBIegU8mZZNisSgomYDJeIeO44o6HrlHo4e0SwbhJlzHq9sSyiKhKKp4zHQ85o5QZ0L6sB2h7/uCkE+uj8ViYn+7Hf4BLR8XxB5LO8UAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;ec2-build-usage.png&apos; title=&apos;&apos; src=&apos;/static/3e3b041ba86d85b4ba5b6adb3ab991ab/ca1dc/ec2-build-usage.png&apos; srcset=&apos;/static/3e3b041ba86d85b4ba5b6adb3ab991ab/e7570/ec2-build-usage.png 170w,
/static/3e3b041ba86d85b4ba5b6adb3ab991ab/f46e7/ec2-build-usage.png 340w,
/static/3e3b041ba86d85b4ba5b6adb3ab991ab/ca1dc/ec2-build-usage.png 680w,
/static/3e3b041ba86d85b4ba5b6adb3ab991ab/02d09/ec2-build-usage.png 1020w,
/static/3e3b041ba86d85b4ba5b6adb3ab991ab/ca756/ec2-build-usage.png 1296w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;ec2-build-usage.png&lt;/figcaption&gt;
  &lt;/figure&gt;
그 대신 Actions Runner가 가동하는 상황을 확인해본 결과, 전체 메모리의 최대 11.9%만을 사용함을 알 수 있었습니다.&lt;br&gt;
&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/da18fd4f83fb28e329badab6f664e0ab/41396/actions-runner-usage.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 22.352941176470587%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEklEQVR42h2QXWuCABSG/RvrojUI+hBGGUQt01omZjS6aBeDxjZYNTO/yiw3lS7638+ki8N7Hng4HF5htVoTRRGbr0+S6MjlN+YSx/wdQ/b2lux8Ij1FhK7D0XNxfzbYq2/8rcV5H+Bs1ux323xs1vktodlsMp1MkOtVFuMRH/MZr7rGTJHp1ivMhwpvpsG038XsdWhXyvQfRbR2i4U+unkvqkyvWua+WEQQRRFd16nXajx1OpgTg4Gq8jwc0s1Z7vUYaxotSUJVFKRG4+Z22m1Mw2A4UJHypx5KJe4KBYTdbkeSJARBgOd5pGmGn+9plnE4hIRhyOkc3/h6vWLnvmVZ+L5PnFfj5blcvuO4Lo7j8A8rfZ//YZfDmwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;actions-runner-usage.png&apos; title=&apos;&apos; src=&apos;/static/da18fd4f83fb28e329badab6f664e0ab/ca1dc/actions-runner-usage.png&apos; srcset=&apos;/static/da18fd4f83fb28e329badab6f664e0ab/e7570/actions-runner-usage.png 170w,
/static/da18fd4f83fb28e329badab6f664e0ab/f46e7/actions-runner-usage.png 340w,
/static/da18fd4f83fb28e329badab6f664e0ab/ca1dc/actions-runner-usage.png 680w,
/static/da18fd4f83fb28e329badab6f664e0ab/02d09/actions-runner-usage.png 1020w,
/static/da18fd4f83fb28e329badab6f664e0ab/9d567/actions-runner-usage.png 1360w,
/static/da18fd4f83fb28e329badab6f664e0ab/41396/actions-runner-usage.png 1610w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;actions-runner-usage.png&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;쉽고 빠른 적용 &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GitHub 레포지토리에서 바로 설정이 가능해 기존 개발 환경과 통합해 사용 가능합니다.&lt;/li&gt;
&lt;li&gt;YAML 파일 작성만으로도 쉽고 빠른 적용이 가능합니다.&lt;/li&gt;
&lt;li&gt;GitHub가 Runner를 관리해주기 때문에, 서버 관리 부담이 덜합니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;CI/CD 파이프라인&lt;/h2&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/7a8df2a639dab8236f0b2622d706c43a/aaf92/cicd-pipeline.jpg&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAQAF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB3ZQmP//EABgQAAIDAAAAAAAAAAAAAAAAAAABEDFB/9oACAEBAAEFAtTFU//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAIDAQEAAAAAAAAAAAAAAAERACExEMH/2gAIAQEAAT8hylexoBRDhNm4NPf/2gAMAwEAAgADAAAAEHDP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAQEAAgMAAAAAAAAAAAAAAREAECExQXH/2gAIAQEAAT8Q6JHZiB5YJ2NiRPuIBBrXEFPbXgAIEN//2Q==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;cicd pipeline&apos; title=&apos;&apos; src=&apos;/static/7a8df2a639dab8236f0b2622d706c43a/a22ce/cicd-pipeline.jpg&apos; srcset=&apos;/static/7a8df2a639dab8236f0b2622d706c43a/0b705/cicd-pipeline.jpg 170w,
/static/7a8df2a639dab8236f0b2622d706c43a/31389/cicd-pipeline.jpg 340w,
/static/7a8df2a639dab8236f0b2622d706c43a/a22ce/cicd-pipeline.jpg 680w,
/static/7a8df2a639dab8236f0b2622d706c43a/29373/cicd-pipeline.jpg 1020w,
/static/7a8df2a639dab8236f0b2622d706c43a/232dc/cicd-pipeline.jpg 1360w,
/static/7a8df2a639dab8236f0b2622d706c43a/aaf92/cicd-pipeline.jpg 1920w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
CI/CD 파이프라인은 다음과 같습니다.  &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Pull Request의 생성 또는 업데이트, Pull Request에 대한 Merge가 발생합니다.&lt;/li&gt;
&lt;li&gt;이벤트에 트리거된 &lt;code class=&quot;language-text&quot;&gt;GitHub Actions workflow&lt;/code&gt;가 실행됩니다.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;workflow&lt;/code&gt;에 작성한 내용에 의해, &lt;code class=&quot;language-text&quot;&gt;GitHub hosting Runner&lt;/code&gt;가 빌드 및 테스트를 수행합니다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;이 때, 테스트 결과를 PR 코멘트로 등록해줍니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Pull Request의 생성 또는 업데이트에 대한 workflow&lt;/code&gt;의 경우 이 단계까지만 수행합니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Pull request Merge에 대한 workflow&lt;/code&gt;의 경우, 빌드한 결과물을 GitHub의 자체 저장소인 &lt;code class=&quot;language-text&quot;&gt;Artifact Storage&lt;/code&gt;에 업로드합니다.&lt;/li&gt;
&lt;li&gt;우리의 &lt;code class=&quot;language-text&quot;&gt;EC2&lt;/code&gt;에 설치된 &lt;code class=&quot;language-text&quot;&gt;Self Hosted Runner&lt;/code&gt;가 4번의 결과물을 다운로드 받습니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Self Hosted Runner&lt;/code&gt;가 배포 스크립트를 실행하게 하여, 필요한 어플리케이션을 실행하고 정적 파일을 적절한 위치에 배치합니다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;2번부터 6번까지, 모두 하나의 workflow 내에서 벌어지는 일입니다.&lt;/p&gt;
&lt;h2&gt;적용 방법&lt;/h2&gt;
&lt;h3&gt;GitHub Actions workflow&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;workflow&lt;/code&gt;란 하나 이상의 작업을 실행하는, 자동화된 프로세스입니다.&lt;br&gt;
레포지토리의 &lt;code class=&quot;language-text&quot;&gt;.github/workflows&lt;/code&gt; 디렉토리에 YAML 파일을 저장해 &lt;code class=&quot;language-text&quot;&gt;workflow&lt;/code&gt; 를 정의할 수 있습니다.
하나의 레포지토리는 여러 개의 &lt;code class=&quot;language-text&quot;&gt;workflow&lt;/code&gt;를 가질 수 있습니다.&lt;/p&gt;
&lt;p&gt;괜찮을지도 서비스에서는&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;pull request&lt;/code&gt;에 대한 빌드 및 테스트만 수행하는 상황 vs &lt;code class=&quot;language-text&quot;&gt;pull request merge&lt;/code&gt; 시 배포까지 수행하는 상황&lt;/li&gt;
&lt;li&gt;대상이 &lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt; 브랜치 vs &lt;code class=&quot;language-text&quot;&gt;dev&lt;/code&gt; 브랜치&lt;/li&gt;
&lt;li&gt;대상이 프론트엔드 / 백엔드&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;세 가지 상황을 고려하여 여러 개의 &lt;code class=&quot;language-text&quot;&gt;workflow&lt;/code&gt;를 작성했습니다.  &lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/bf42bd6f3c4972bedd4c3962661f345e/aaf92/workflows-dev.jpg&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHdW2CwB//EABgQAQADAQAAAAAAAAAAAAAAAAEAAhEQ/9oACAEBAAEFAlyFq7Hv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAIhIP/aAAgBAQAGPwKkbP8A/8QAGxABAAICAwAAAAAAAAAAAAAAAQARECFBUdH/2gAIAQEAAT8hM2gO2KoKvFzeHuP/2gAMAwEAAgADAAAAEEDP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxAAAgIDAQAAAAAAAAAAAAAAAREAIRAxkUH/2gAIAQEAAT8QuX6YgIGVOAPyClkTbZ7Emnt7j//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;workflows dev&apos; title=&apos;&apos; src=&apos;/static/bf42bd6f3c4972bedd4c3962661f345e/a22ce/workflows-dev.jpg&apos; srcset=&apos;/static/bf42bd6f3c4972bedd4c3962661f345e/0b705/workflows-dev.jpg 170w,
/static/bf42bd6f3c4972bedd4c3962661f345e/31389/workflows-dev.jpg 340w,
/static/bf42bd6f3c4972bedd4c3962661f345e/a22ce/workflows-dev.jpg 680w,
/static/bf42bd6f3c4972bedd4c3962661f345e/29373/workflows-dev.jpg 1020w,
/static/bf42bd6f3c4972bedd4c3962661f345e/232dc/workflows-dev.jpg 1360w,
/static/bf42bd6f3c4972bedd4c3962661f345e/aaf92/workflows-dev.jpg 1920w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/7b25b45d7feddcba30970fd1c6a9cb32/aaf92/workflows-prod.jpg&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHdW2CwB//EABgQAQADAQAAAAAAAAAAAAAAAAEAAhEQ/9oACAEBAAEFAlyFq7Hv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAgMAAAAAAAAAAAAAAAAAACECESD/2gAIAQEABj8CYpXn/8QAGxABAAICAwAAAAAAAAAAAAAAAQARECFBUdH/2gAIAQEAAT8hM2gO2KoKeLm8Pcf/2gAMAwEAAgADAAAAEEDP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxAAAgIDAQAAAAAAAAAAAAAAAREAMRAhkUH/2gAIAQEAAT8Q3L9MQEDNCgD8g0sS1nsSadvcf//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;workflows prod&apos; title=&apos;&apos; src=&apos;/static/7b25b45d7feddcba30970fd1c6a9cb32/a22ce/workflows-prod.jpg&apos; srcset=&apos;/static/7b25b45d7feddcba30970fd1c6a9cb32/0b705/workflows-prod.jpg 170w,
/static/7b25b45d7feddcba30970fd1c6a9cb32/31389/workflows-prod.jpg 340w,
/static/7b25b45d7feddcba30970fd1c6a9cb32/a22ce/workflows-prod.jpg 680w,
/static/7b25b45d7feddcba30970fd1c6a9cb32/29373/workflows-prod.jpg 1020w,
/static/7b25b45d7feddcba30970fd1c6a9cb32/232dc/workflows-prod.jpg 1360w,
/static/7b25b45d7feddcba30970fd1c6a9cb32/aaf92/workflows-prod.jpg 1920w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;workflow 만들기&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;workflow&lt;/code&gt;는 기본적으로 아래와 같은 요소들을 가져야 합니다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;workflow&lt;/code&gt;를 유발시킬 하나 이상의 이벤트 : &lt;code class=&quot;language-text&quot;&gt;on&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;workflow&lt;/code&gt;에서 수행할 하나 이상의 작업: &lt;code class=&quot;language-text&quot;&gt;job&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;job&lt;/code&gt; 블록 내에 단계 별 스크립트 또는 익스텐션 실행을 정의: &lt;code class=&quot;language-text&quot;&gt;step&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;여기서 주의할 점은, 여러개의 &lt;code class=&quot;language-text&quot;&gt;job&lt;/code&gt;은 기본적으로 병렬적으로 처리된다는 것입니다.&lt;br&gt;
순차적으로 실행하고 싶다면, &lt;code class=&quot;language-text&quot;&gt;needs&lt;/code&gt; 블록을 사용해야 합니다.  &lt;/p&gt;
&lt;p&gt;아래는 현재 적용된 workflow입니다. 이해를 돕기 위해 주석을 추가하였습니다.  &lt;/p&gt;
&lt;h3&gt;백엔드 CI workflow&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Backend CI For Test Validation

&lt;span class=&quot;token comment&quot;&gt;# 트리거 설정&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;workflow_dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  
  &lt;span class=&quot;token key atrule&quot;&gt;pull_request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; main&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; develop &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend/&lt;span class=&quot;token important&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 해당 디렉토리 내 파일의 변경이 있을 때만 트리거됨&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 테스트 결과 등록을 위한 권한 설정&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;permissions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
  &lt;span class=&quot;token key atrule&quot;&gt;pull-requests&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; write
  &lt;span class=&quot;token key atrule&quot;&gt;checks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; write
  &lt;span class=&quot;token key atrule&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; write
  
&lt;span class=&quot;token comment&quot;&gt;# 수행할 작업들&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;build-and-comment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# 해당 job을 실행할 환경 설정&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ubuntu&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22.04&lt;/span&gt;

    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/checkout@v3
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Set up JDK 17
      &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/setup&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;java@v3
      &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;java-version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;17&apos;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;distribution&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;temurin&apos;&lt;/span&gt;
        
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gradlew 실행 권한 부여
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; chmod +x gradlew
      &lt;span class=&quot;token key atrule&quot;&gt;working-directory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend

    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Gradle build 시작
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./gradlew clean build
      &lt;span class=&quot;token key atrule&quot;&gt;working-directory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend

    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 테스트 결과를 PR에 코멘트로 등록합니다
      &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; EnricoMi/publish&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;unit&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;test&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;action@v1
      &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; always()
      &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;files&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;backend/build/test-results/test/TEST-*.xml&apos;&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 테스트 실패 시&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 실패한 코드 라인에 Check 코멘트를 등록합니다
      &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; mikepenz/action&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;junit&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;report@v3
      &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; always()
      &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;report_paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;**/build/test-results/test/TEST-*.xml&apos;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; github.token &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;백엔드 CD workflow&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Backend develop CI/CD

&lt;span class=&quot;token key atrule&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;workflow_dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  
  &lt;span class=&quot;token key atrule&quot;&gt;pull_request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
     &lt;span class=&quot;token comment&quot;&gt;# 배포 설정은 main, develop 브랜치 별로 다르게 트리거&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; develop &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
     &lt;span class=&quot;token comment&quot;&gt;# 브랜치가 닫힐 때만 트리거&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;types&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;closed&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend/&lt;span class=&quot;token important&quot;&gt;**&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;permissions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; read
  
&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;build-and-upload&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;    
    &lt;span class=&quot;token comment&quot;&gt;# Pull Request를 그냥 닫은 게 아니라, merge해서 닫았을 때만 실행&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; github.event.pull_request.merged
    
    &lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ubuntu&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22.04&lt;/span&gt;

    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/checkout@v3
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Set up JDK 17
      &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/setup&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;java@v3
      &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;java-version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;17&apos;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;distribution&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;temurin&apos;&lt;/span&gt;
        
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gradlew 실행 권한 부여
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; chmod +x gradlew
      &lt;span class=&quot;token key atrule&quot;&gt;working-directory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend

    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Gradle build 시작
      &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./gradlew clean build
      &lt;span class=&quot;token key atrule&quot;&gt;working-directory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend
        
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; jar 파일 artifact에 업로드
      &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/upload&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;artifact@v3
      &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; BackendApplication
        &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; backend/build/libs/mapbefine.jar

  &lt;span class=&quot;token key atrule&quot;&gt;deploy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
     &lt;span class=&quot;token comment&quot;&gt;# Pull Request를 그냥 닫은 게 아니라, merge해서 닫았을 때만 실행&lt;/span&gt;
     &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; github.event.pull_request.merged

     &lt;span class=&quot;token comment&quot;&gt;# deploy는 build-and-upload 작업과 달리 self-hosted runner를 사용&lt;/span&gt;
     &lt;span class=&quot;token comment&quot;&gt;# main, develop 브랜치마다 각각 운영 서버, 개발 서버의 runner만을 실행하도록 해야 함&lt;/span&gt;
     &lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;hosted&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dev &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;를
     &lt;span class=&quot;token comment&quot;&gt;# build-and-upload 작업이 성공적으로 완료될 경우 실행&lt;/span&gt;
     &lt;span class=&quot;token key atrule&quot;&gt;needs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; build&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;and&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;upload
  
     &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 구버전 jar 파일 삭제
        &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rm &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;rf /home/ubuntu/backend/build/&lt;span class=&quot;token important&quot;&gt;*.jar&lt;/span&gt; 

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; jar파일 artifact에서 다운로드
        &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/download&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;artifact@v3 
        &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; BackendApplication
          &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /home/ubuntu/backend/build/

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 배포하기
        &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /home/ubuntu/backend/deploy.sh

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 슬랙 메시지 보내기

        &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 8398a7/action&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;slack@v3
        &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;mention&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;here&apos;&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;if_mention&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; always
          &lt;span class=&quot;token key atrule&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; job.status &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; workflow&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;job&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;commit&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;ref&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;author&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;took
        &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;SLACK_WEBHOOK_URL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; secrets.SLACK_WEBHOOK_URL &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; always()&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;프론트엔드 CI workflow&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Frontend CI For Test Validation
&lt;span class=&quot;token comment&quot;&gt;# 어떤 이벤트가 발생하면 실행할지 결정&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;#pull request open과 reopen 시 실행한다.&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;pull_request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;main&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; develop&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; frontend/&lt;span class=&quot;token important&quot;&gt;**&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;defaults&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;working-directory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./frontend
&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;jest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ubuntu&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22.04&lt;/span&gt;

    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Checkout repository
        &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/checkout@v2

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Setup Node.js
        &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/setup&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;node@v2
        &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;node-version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;18&quot;&lt;/span&gt;

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Install node modules
        &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm install

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Run Jest test
        &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm run test&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;프론트엔드 CD workflow&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Frontend develop CD

&lt;span class=&quot;token key atrule&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;workflow_dispatch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

  &lt;span class=&quot;token key atrule&quot;&gt;pull_request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;branches&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; develop &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;types&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; closed &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; frontend/&lt;span class=&quot;token important&quot;&gt;**&lt;/span&gt;

&lt;span class=&quot;token key atrule&quot;&gt;permissions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;contents&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; read

&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;build-and-upload&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; github.event.pull_request.merged

    &lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ubuntu&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;22.04&lt;/span&gt;

    &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/checkout@v3
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Set up Node.js 18
        &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/setup&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;node@v3
        &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;node-version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;npm&quot;&lt;/span&gt;

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Install npm
        &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm install &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;force

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; grant excute access
        &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; chmod +x npm

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Build project
        &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; npm run build

      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; upload to artifact
        &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/upload&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;artifact@v3
        &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; FrontendApplication
          &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; frontend/dist

  &lt;span class=&quot;token key atrule&quot;&gt;deploy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;hosted&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dev &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;needs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; build&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;and&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;upload

      &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; github.event.pull_request.merged

      &lt;span class=&quot;token key atrule&quot;&gt;steps&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; delete old js file
          &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rm &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;rf /home/ubuntu/frontend/dist

        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; download js file from artifact
          &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; actions/download&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;artifact@v3
          &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; FrontendApplication
            &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /home/ubuntu/frontend

        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; deploy
          &lt;span class=&quot;token key atrule&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /home/ubuntu/frontend/deploy.sh

        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; send slack message

          &lt;span class=&quot;token key atrule&quot;&gt;uses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 8398a7/action&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;slack@v3
          &lt;span class=&quot;token key atrule&quot;&gt;with&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;mention&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;here&apos;&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;if_mention&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; always
            &lt;span class=&quot;token key atrule&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; job.status &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; workflow&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;job&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;commit&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;message&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;ref&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;author&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;took
          &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;SLACK_WEBHOOK_URL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; secrets.SLACK_WEBHOOK_URL &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; always()&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Self-hosted Runner&lt;/h2&gt;
&lt;p&gt;앞서 말씀드린 파이프라인 대로 배포를 하기 위해서는, 배포를 할 서버에 &lt;code class=&quot;language-text&quot;&gt;GitHub Actions&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;Self-hosted Runner&lt;/code&gt;를 설치해야 합니다.  &lt;/p&gt;
&lt;p&gt;앞서 설명드린 &lt;code class=&quot;language-text&quot;&gt;workflow&lt;/code&gt;는 GitHub에서 호스팅하는 Runner가 수행할 수도 있지만,&lt;br&gt;
원하는 서버에 자체적으로 Runner를 호스팅하여 사용할 수도 있습니다.&lt;/p&gt;
&lt;p&gt;workflow의 &lt;code class=&quot;language-text&quot;&gt;runs-on&lt;/code&gt; 블록에서 어떤 Runner를 통해 작업을 수행할지 정의합니다.&lt;/p&gt;
&lt;h3&gt;EC2에 Self-hosted Runner 띄우기&lt;/h3&gt;
&lt;h4&gt;1. 다운로드&lt;/h4&gt;
&lt;p&gt;레포지토리의 &lt;code class=&quot;language-text&quot;&gt;Settings&lt;/code&gt; - &lt;code class=&quot;language-text&quot;&gt;Actions&lt;/code&gt; - &lt;code class=&quot;language-text&quot;&gt;Runners&lt;/code&gt;에 들어가면 &lt;code class=&quot;language-text&quot;&gt;New self-hosted runner&lt;/code&gt; 버튼이 있습니다.&lt;br&gt;
&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/24564f825750ff54f3a9c51f8ffb805b/d621b/create-runner.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 51.17647058823529%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABC0lEQVR42qVS2U7DQAzs//8Or/xDJQ7BGxIliByk2e6dPaa2Q1pAPJGRrF35GI+9u3MhwlgHTcan9UHO8TjBeQ+Os8+xX2t48pVc0PQNHg9PeB8a5DkhpoyZbAdCiFRkLVaknPHRf+JkPMVmSkxiiY1iiZrcv9zhZn+Lh9dnqalftUIYKaFtOzjnxFlKhZ8rbKBiUhMDK3SimBvPpOiKiu9YCEnhcZqIqFxS1rSQKrrRoB0U+mFE23XQ2iBTbqnlUvODkPdijLn2rJUMYoXvv3Ss8b8ghM5HTJOSUXMq0v2/EEJtLA5vjexmGaVuI+RlK6VklK1Yvg29slInIeavsZnQ06ft+l5eb6vKM30SExSjfMg1AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;create-runner.png&apos; title=&apos;&apos; src=&apos;/static/24564f825750ff54f3a9c51f8ffb805b/ca1dc/create-runner.png&apos; srcset=&apos;/static/24564f825750ff54f3a9c51f8ffb805b/e7570/create-runner.png 170w,
/static/24564f825750ff54f3a9c51f8ffb805b/f46e7/create-runner.png 340w,
/static/24564f825750ff54f3a9c51f8ffb805b/ca1dc/create-runner.png 680w,
/static/24564f825750ff54f3a9c51f8ffb805b/02d09/create-runner.png 1020w,
/static/24564f825750ff54f3a9c51f8ffb805b/9d567/create-runner.png 1360w,
/static/24564f825750ff54f3a9c51f8ffb805b/d621b/create-runner.png 1439w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;create-runner.png&lt;/figcaption&gt;
  &lt;/figure&gt;
버튼을 누르면 아래와 같은 설정 페이지로 접속하는데, Runner를 띄울 서버 환경에 맞는 설정을 선택해줍니다.&lt;br&gt;
&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/64b8788e7ab4312363528c8e98b26d58/722fb/architecture-runner.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 51.17647058823529%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABeElEQVR42n1Ta5ODIAzs//+TN3e9+hYpAlJB97KpfX05ZnZUSJbNJp7ikmCvM2YfEeTdzR4uJPRTgJmuGCeLYTQw9ooQk4I5RPABTvbTLSOXHdY6nLZtQ4wR+74ruELK6G3EOAzoe8Fwx7JErOuqBLdVcFvB/McKIeBUSoExE0ZjhHjRA+s8vs41qs7iUrdomhbOOYkzEieKrai/yoXWY83lk3DbdkxSlnPzU+Eqt9MGBnOLMUWUPM75zDmrOm49K7sTbkpY3qRzz80zUkr6TX/oHUmYy6ooYJHzHS9C7/295FFMf/eCjWnb7kjehKg8k/5bvFAJ66ZRuY/Fm9lVGs+yFRJXjtIzUV54t+JUtDyvKvJhMJ9V22tD6m7ApekwyAg5v8BL6cTMEVpuMhHS6YOQVaqHXd9/dDnJaJwvjYLElRASdTso8XiA0xDfCFUh54pjw5LpgRLKfP1canz/Vqqy7UexYFYCI8M7yQQ4+RH47UXlg5D2/QH2dAmr1rh9agAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;architecture-runner.png&apos; title=&apos;&apos; src=&apos;/static/64b8788e7ab4312363528c8e98b26d58/ca1dc/architecture-runner.png&apos; srcset=&apos;/static/64b8788e7ab4312363528c8e98b26d58/e7570/architecture-runner.png 170w,
/static/64b8788e7ab4312363528c8e98b26d58/f46e7/architecture-runner.png 340w,
/static/64b8788e7ab4312363528c8e98b26d58/ca1dc/architecture-runner.png 680w,
/static/64b8788e7ab4312363528c8e98b26d58/02d09/architecture-runner.png 1020w,
/static/64b8788e7ab4312363528c8e98b26d58/9d567/architecture-runner.png 1360w,
/static/64b8788e7ab4312363528c8e98b26d58/722fb/architecture-runner.png 1465w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;architecture-runner.png&lt;/figcaption&gt;
  &lt;/figure&gt;
해당 환경의 터미널에서 runner package를 다운로드합니다. 선택한 설정에 맞게 제공된 커맨드를 복사해 실행하면 됩니다.&lt;br&gt;
&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/e179cbebe9b0269f6f728b54f6b7f512/d621b/download-runner.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 54.70588235294118%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiklEQVR42o2Ta4rcMBCE9/6HCGQh5AqBkFMElvxM2Ox4xpYfsvV+uLbUMxNm2SFJQ1lGsj5Xd0sPYGzGQGuNa+Sc0Z96xJhQckFOGXutwL7f1008tIexFicCatvEKClBK4UcAmqMop1zTTXFs2SOiuENVICWwOZwvyzs4nDAUU1Qs8YwLVhWAxsSXMw3KojeAxcjf4DOeQFa55BLkQ+6lw6/fh9wOPYU4ScFRbDerMCbjI/3gd4HqHGS1MUhoV13xM/nA55fjuh6hWFczm7HGeO8YlpWLJtDdHeAzdk4zdKMFpXj2PcYuXnivG6bCTPGys9FLjCzgMS974CJXdw2wzGdgXQ40OFM17MaoRu0aV7geCI8M2mpJoJLTO+7fBvXxnz5+g0fPj7i8dNnfH/6gdV6THpjmmygcVI/wyaFVP4OFIdModV0oLuFkFwqStmpKu+ZZzNd1Ob+CWwuZ4JaA6SbrNVqHVyICDwuV/mQBfpfwFbTdd04WrlJTeu28SQ4WTMsgXZ0WN/elFeo6FfQ1tbFBAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;download-runner.png&apos; title=&apos;&apos; src=&apos;/static/e179cbebe9b0269f6f728b54f6b7f512/ca1dc/download-runner.png&apos; srcset=&apos;/static/e179cbebe9b0269f6f728b54f6b7f512/e7570/download-runner.png 170w,
/static/e179cbebe9b0269f6f728b54f6b7f512/f46e7/download-runner.png 340w,
/static/e179cbebe9b0269f6f728b54f6b7f512/ca1dc/download-runner.png 680w,
/static/e179cbebe9b0269f6f728b54f6b7f512/02d09/download-runner.png 1020w,
/static/e179cbebe9b0269f6f728b54f6b7f512/9d567/download-runner.png 1360w,
/static/e179cbebe9b0269f6f728b54f6b7f512/d621b/download-runner.png 1439w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;download-runner.png&lt;/figcaption&gt;
  &lt;/figure&gt;   &lt;/p&gt;
&lt;p&gt;아래는 Linux, ARM64 환경의 runner를 다운로드받기 위한 스크립트입니다.  &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Create a folder&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; actions-runner &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; actions-runner
&lt;span class=&quot;token comment&quot;&gt;# Download the latest runner package&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; actions-runner-linux-arm64-2.307.1.tar.gz &lt;span class=&quot;token parameter variable&quot;&gt;-L&lt;/span&gt; https://github.com/actions/runner/releases/download/v2.307.1/actions-runner-linux-arm64-2.307.1.tar.gz
&lt;span class=&quot;token comment&quot;&gt;# Optional: Validate the hash&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;01edc84342ef4128a8f19bc2f33709b40f2f1c40e250e2a4c5e0adf620044ab3  actions-runner-linux-arm64-2.307.1.tar.gz&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; shasum &lt;span class=&quot;token parameter variable&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# Extract the installer&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; xzf ./actions-runner-linux-arm64-2.307.1.tar.gz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;2. Runner 생성 및 설정&lt;/h4&gt;
&lt;p&gt;마찬가지로 제공된 스크립트에 따라, runner를 생성하고 설정합니다.&lt;br&gt;
&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/c60bf6833f878124f1a20547fc2900a9/d621b/configure-runner.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 54.70588235294118%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABhUlEQVR42o2T60rsMBSFff+HEI4i5xUE8SkEwX/n4GVq06ZNc22azHIltTIyRdywmjaZ+bL2zs4FGNoYKKWwxZISWiEwLxEp5/p9PB7xm7goD2Mt3t9bZP65REoZatIEZWSCio6fyifa5s6AlsDicFssY9tLNG2HTo4QcsA4Gdgww4W4al7HOaZzoHO+Aq1zNb0Sh0bg/8sb3pqWEit8UFDaEm7rBsYFlmUH6H1AR0cldfpD8Xkg4N/zK55fm/ou+rECy9gPE+SoK3iOy07KdNYzrWVZFzNd9tygSHJejRNGwoyxdfNNjg4jUz8DRu6iteG4LmbvIQ4Nhr7H0PVQUq4aBjh2hGcmM38TCU2OWX0e5hfwNOrBULd397j8c42rm794eHzCZAOkMhi1gzIOxkeYkBDo8kdgdTizpnQomgYjHS50k0KoKu9FkWUqShROWmcXWFwOrJvo5NdpTnTl/IzAmm3ybJu4d8p7wFLTSWveIltvUhknzhnr6pqxbDWXeJO+N/YHaNxYBOj1FvYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;configure-runner.png&apos; title=&apos;&apos; src=&apos;/static/c60bf6833f878124f1a20547fc2900a9/ca1dc/configure-runner.png&apos; srcset=&apos;/static/c60bf6833f878124f1a20547fc2900a9/e7570/configure-runner.png 170w,
/static/c60bf6833f878124f1a20547fc2900a9/f46e7/configure-runner.png 340w,
/static/c60bf6833f878124f1a20547fc2900a9/ca1dc/configure-runner.png 680w,
/static/c60bf6833f878124f1a20547fc2900a9/02d09/configure-runner.png 1020w,
/static/c60bf6833f878124f1a20547fc2900a9/9d567/configure-runner.png 1360w,
/static/c60bf6833f878124f1a20547fc2900a9/d621b/configure-runner.png 1439w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;configure-runner.png&lt;/figcaption&gt;
  &lt;/figure&gt;
먼저 아래 커맨드를 실행하면, 아래와 같이 Runner 환경 설정을 위해 몇 가지를 입력해야 합니다.  &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./config.sh &lt;span class=&quot;token parameter variable&quot;&gt;--url&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${repository URL}&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--token&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${runner 생성 페이지에서 제공된 토큰}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/6fedd99483492e0a4fda63fa9cc0365f/911ab/runner-registration.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 81.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVR42o1UabKGIAzzdo4bqGxu7/7H4DVIHPXTGX9kWqQNKS0WWusI9H0f6Sulku267rKmj+/81jTNBQU3QwjRGJMA8lEsDxqGIRpro/c++eM4Hge+EpLMSPAoJLBGkgdJdPLdZUIrFgDpIyHI4LSy2cKirG2Lal1jtyyxmyZZ/4m/phgmtm37TogNAmslChM0oLMvJWIvg7E/hDaXAiCgruukNKm4BUPVGXeyXaFWlw6/BX5FYYONk9wTugwL0qqqktKvuBAGH1K5JEX3oJiqz+q5JjAV93ssnHfROXfMIX0c4PLdzvkwAjFoyiPhPM8RWGVMYEG0yLgQINhkjADsIYYH8mquJU/hICE51lCGRA4zfQJxTw0s/ObjKmRQsGSLhLIskwKqoH/GY5dxH87u94Z3yhLOXXxLfiT0bi8pEQvgszl8s7Bf57MwPs/hFI4Hr25P7Ok39Ub4D2J5aL3E0xoNAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;runner-registration.png&apos; title=&apos;&apos; src=&apos;/static/6fedd99483492e0a4fda63fa9cc0365f/ca1dc/runner-registration.png&apos; srcset=&apos;/static/6fedd99483492e0a4fda63fa9cc0365f/e7570/runner-registration.png 170w,
/static/6fedd99483492e0a4fda63fa9cc0365f/f46e7/runner-registration.png 340w,
/static/6fedd99483492e0a4fda63fa9cc0365f/ca1dc/runner-registration.png 680w,
/static/6fedd99483492e0a4fda63fa9cc0365f/911ab/runner-registration.png 710w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;runner-registration.png&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;위 이미지처럼 name, 추가 label을 지정하고 설치한 runner를 확인하면, 다음과 같이 &lt;code class=&quot;language-text&quot;&gt;dev&lt;/code&gt; 라벨이 추가된 것을 확인할 수 있습니다.
&lt;figure class=&apos;gatsby-resp-image-figure&apos; style=&apos;margin-bottom: 16px;&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; &apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/d42a5c2af740caa6234742b088b86f9e/9f1c6/runner-label.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 29.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA8klEQVR42oVQy0oEMRDM/8P+gHr2Nxb1sOhFEPayIgvjg2F1Hnn0ZJJJpuzOqCy4aENRXZ1KdyfKWouqqtC2LSTmecZ/8e1ZP22wur7A2e0lVlfnuH/dQrnBoz40aDoN4wYYSyAiuCPQMGBgHxGz96XmWe/e9rjZ3WGz32L9+IDaNFAUEt5NxEFH1N2IxoyIcfqFaRKOX7zkOWVeVzZeIKEmLhpHCGxKnMcpMfIC1oF1iKfhQ0RvXfGMnEsvNY4B1fMLOm3Q9aY8WRvH7Iom8rxVKsNO4aNp0ff6x6Pkg+UZOecyIaXjy6nU/4rE5+KRPoJPfd3QMifHA3wAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;runner-label.png&apos; title=&apos;&apos; src=&apos;/static/d42a5c2af740caa6234742b088b86f9e/ca1dc/runner-label.png&apos; srcset=&apos;/static/d42a5c2af740caa6234742b088b86f9e/e7570/runner-label.png 170w,
/static/d42a5c2af740caa6234742b088b86f9e/f46e7/runner-label.png 340w,
/static/d42a5c2af740caa6234742b088b86f9e/ca1dc/runner-label.png 680w,
/static/d42a5c2af740caa6234742b088b86f9e/9f1c6/runner-label.png 828w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
    &lt;figcaption class=&apos;gatsby-resp-image-figcaption&apos;&gt;runner-label.png&lt;/figcaption&gt;
  &lt;/figure&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;⚠️ 개인 로컬에서 테스트로 만든 예시 이미지로, 실제 서비스의 운영 환경과는 상이합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;더 빠른 설정을 원한다면, 아래와 같이 &lt;code class=&quot;language-text&quot;&gt;./config.sh&lt;/code&gt; 실행 시 원하는 값들을 바로 전달해줘도 됩니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./config.sh &lt;span class=&quot;token parameter variable&quot;&gt;--url&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${repository URL}&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--token&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${runner 생성 페이지에서 제공된 토큰}&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--labels&lt;/span&gt; dev&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;label을 왜 추가했을까요?&lt;/strong&gt;&lt;br&gt;
각 Runner를 구분할 수 있는 label을 지정해서 &lt;code class=&quot;language-text&quot;&gt;runs-on&lt;/code&gt; 블록에서 어떤 Runner에게 일을 시킬지 명시하기 위함입니다.&lt;br&gt;
괜찮을지도 팀은 한 리포지토리에서 운영 서버, 개발 서버에 각각 띄울 두 개의 Runner를 사용하기 때문에
이를 구분하기 위한 &lt;code class=&quot;language-text&quot;&gt;dev&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;prod&lt;/code&gt; label을 지정하였습니다.&lt;br&gt;
아래는 &lt;code class=&quot;language-text&quot;&gt;dev&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;self-hosted&lt;/code&gt; 라벨을 가진 runner를 지정하는 예시입니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;runs-on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;hosted&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; dev &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;이미 생성한 Runner에 label을 추가하려면?&lt;/strong&gt;&lt;br&gt;
GitHub 공식문서에 따르면, 2023년 2월부터 GUI로 label을 추가하는 기능을 제공하지 않는다고 합니다.&lt;br&gt;
config.sh 파일을 수정해 설정할 수도 없습니다.&lt;br&gt;
대신 GitHub에서 제공하는 &quot;Self-hosted runners&quot; REST API를 사용해 추가해주어야 합니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;3. Runner 실행&lt;/h4&gt;
&lt;p&gt;   Runner 설정이 완료되었다면, 아래 명령어로 Runner를 실행합니다.&lt;br&gt;
레포지토리의 &lt;code class=&quot;language-text&quot;&gt;Settings&lt;/code&gt; - &lt;code class=&quot;language-text&quot;&gt;Actions&lt;/code&gt; - &lt;code class=&quot;language-text&quot;&gt;Runners&lt;/code&gt; 페이지에서 Status가 &lt;code class=&quot;language-text&quot;&gt;idle&lt;/code&gt;로 바뀌었다면 정상적으로 실행된 것입니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ ./run.sh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;참고로 서버 내 저장한 환경변수를 업데이트 했을 때에는, Runner도 재시작하기를 잊지 마세요!&lt;br&gt;
왜일까요? 자세한 내용은&lt;br&gt;
&lt;a href=&quot;https://map-befine-official.github.io/trouble-shooting-actions-runner&quot;&gt;EC2 환경 변수 적용 및 Actions Runner에 환경 변수 적용이 안되는 이슈&lt;/a&gt;에서 확인하실 수 있습니다.&lt;/p&gt;
&lt;h2&gt;참고 자료&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.github.com/ko/actions/using-workflows/about-workflows&quot;&gt;https://docs.github.com/ko/actions/using-workflows/about-workflows&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/about-self-hosted-runners&quot;&gt;https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/about-self-hosted-runners&lt;/a&gt;&lt;br&gt;
&lt;a href=&quot;https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/using-labels-with-self-hosted-runners&quot;&gt;https://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/using-labels-with-self-hosted-runners&lt;/a&gt;  &lt;/p&gt;</content:encoded></item><item><title><![CDATA[포스트 작성 방법]]></title><description><![CDATA[이 글은 우테코 괜찮을지도팀의 가 작성했습니다. 첫 글은 포스트 작성법에 대해서 다루어보도록 하겠습니다. Repository Local 로 Clone 해오기 본인이 원하는 Directory…]]></description><link>https://map-befine-official.github.io/how-to-write-a-post/</link><guid isPermaLink="false">https://map-befine-official.github.io/how-to-write-a-post/</guid><pubDate>Mon, 24 Jul 2023 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;
&lt;p&gt;이 글은 우테코 괜찮을지도팀의 &lt;code class=&quot;language-text&quot;&gt;매튜&lt;/code&gt;가 작성했습니다.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;첫 글은 포스트 작성법에 대해서 다루어보도록 하겠습니다.&lt;/p&gt;
&lt;h3&gt;Repository Local 로 Clone 해오기&lt;/h3&gt;
&lt;p&gt;본인이 원하는 Directory 로 이동해 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/map-befine-official/map-befine-official.github.io &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위와 같은 명령어를 이용하여 우리 팀의 Repository 를 Local 로 가져옵니다.&lt;/p&gt;
&lt;h2&gt;글 작성하기&lt;/h2&gt;
&lt;p&gt;Repository 를 Local 로 가져오셨다면, 이제 글을 작성해봅시다!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; map-befine-official.github.io&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 명령어를 통해서 map-befine-official.github.io 에 Directory 에 들어가주시면 Contents Directory 가 보이실 겁니다.&lt;/p&gt;
&lt;p&gt;여기서 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; contents/posts&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 명령어를 통해 contents/posts 디렉토리 내부까지 가고&lt;/p&gt;
&lt;p&gt;본인이 작성하고자 하는 주제에 걸맞는 이름으로 Directory 를 생성한 후, 만드신 Directory까지 들어가주세요&lt;/p&gt;
&lt;p&gt;저 같은 경우는 Directory 명을 how-to-write-a-post 로 지었기 때문에&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; how-to-write-a-post&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위와 같은 명령어를 통해 이동 해주었습니다.&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/afac0117c60ff7905d6f9cb98860a235/5b89d/command.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 23.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWElEQVR42iWPSzNCcRyG+2A2DEIakZBUpxviZFD/CBvUOaeT+wwRili4RO6XhTHjK5ixsuGLPP5l8cwzv3fx/ua1LK4V0fd1jEOVhbVhHA4bzm4nA71uXH1e1HQBX9JkKK5L5/CKrPQKPpGr3/6ZVZTUBsrsKp5pDUuu/MpG5YSt6ib6sUkwlmRUxFDnPYzM+HGrKTq9MdoHx+jwjGMbUqXVemYdjNLSP0KrO4p1YJQmZxCLeVhBz19IriUVzINbdp9O2XuZxTxPMLZoEBY6IbFMMJEmnNQISWruiQhs3gnsgWnsyiRt8qksrJI9uKyjF85I5y9ZvyiweZVAOxEE5zMocQ0lkSEgMvjiS0RSJq7oHJ3KFF0hgSOcpCssy/1TtcnPGKU7skf36MVbtP0qRvEGs/yAcfxI/v2Xnbcf9j6+Ofo8o/xVIr69TLMzQmNP4B85tUaD3cMfEnvzTyzTjc4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;command&apos; title=&apos;&apos; src=&apos;/static/afac0117c60ff7905d6f9cb98860a235/ca1dc/command.png&apos; srcset=&apos;/static/afac0117c60ff7905d6f9cb98860a235/e7570/command.png 170w,
/static/afac0117c60ff7905d6f9cb98860a235/f46e7/command.png 340w,
/static/afac0117c60ff7905d6f9cb98860a235/ca1dc/command.png 680w,
/static/afac0117c60ff7905d6f9cb98860a235/02d09/command.png 1020w,
/static/afac0117c60ff7905d6f9cb98860a235/9d567/command.png 1360w,
/static/afac0117c60ff7905d6f9cb98860a235/5b89d/command.png 1410w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;여기서부터 이제 &lt;code class=&quot;language-text&quot;&gt;index.md&lt;/code&gt; 파일을 만들어 작성하실 글을 Markdown 형식으로 작성 해주시면되고, &lt;code class=&quot;language-text&quot;&gt;.index_image&lt;/code&gt; 라는 이름으로 Directory 만들어 해당 Directory 에 이미지 파일을 넣어주시면 됩니다.&lt;/p&gt;
&lt;p&gt;잘 따라오셨다면 최종적으로 이런 구조가 나올겁니다!&lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/3ecb386f317dad7f94bb32cf08e0c7b7/5b89d/directory_structure.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 20%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAABG0lEQVR42lWOv0sCcRiHv+eildAFat6Z+eM85fBOME+L9CpaosmlllqbaqgphzLLaMmKXEQSWlojqKUpaqopaOy/efriIDQ8PO/nfXlfXtG4uKXdvad1M6B1fUez0+fossepzCdXfdqDF7qvv3Sefnj4+Obx/Y3nr08anR7bB+ds7Z+xsXvM5l6T+s4hwlurU15exyrVJN7Q+fISueIizsKqrD1siTVXo7ZSxavmKbsmqjqBEAKfogw9wjTSRKcjzMZniOkaOTODmTGGvXhMJxIJEw6FpEMkk0km1Sm56MPvDxAYG0fIg4riGyEsyyKRSKBpGoZhUKlUKJVcUqkUjuMQDAblTJc5jW3bZLNZXHeeQqFINKr//04I/gCACIWBplPJEAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;directory structure&apos; title=&apos;&apos; src=&apos;/static/3ecb386f317dad7f94bb32cf08e0c7b7/ca1dc/directory_structure.png&apos; srcset=&apos;/static/3ecb386f317dad7f94bb32cf08e0c7b7/e7570/directory_structure.png 170w,
/static/3ecb386f317dad7f94bb32cf08e0c7b7/f46e7/directory_structure.png 340w,
/static/3ecb386f317dad7f94bb32cf08e0c7b7/ca1dc/directory_structure.png 680w,
/static/3ecb386f317dad7f94bb32cf08e0c7b7/02d09/directory_structure.png 1020w,
/static/3ecb386f317dad7f94bb32cf08e0c7b7/9d567/directory_structure.png 1360w,
/static/3ecb386f317dad7f94bb32cf08e0c7b7/5b89d/directory_structure.png 1410w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;글 올리기!&lt;/h2&gt;
&lt;p&gt;글을 모두 작성하셨다면 이제 올리기만 하면 될 겁니다.&lt;/p&gt;
&lt;p&gt;아주 쉽습니다.&lt;/p&gt;
&lt;p&gt;그냥 main 브랜치에 push 를 하시면돼요!&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.github/workflows/deploy.yml&lt;/code&gt; 로 인해서 push 만 하셔도 배포 될겁니다.&lt;/p&gt;
&lt;p&gt;야물딱지죠?&lt;/p&gt;
&lt;p&gt;우리 글도 한번 야무지게 써봅시다!&lt;/p&gt;
&lt;h2&gt;글의 제목 작성하기&lt;/h2&gt;
&lt;p&gt;글의 서두에 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;---
title: &quot;제목&quot;
description: &quot;설명&quot;
date: &quot;작성 날짜&quot;
update: &quot;수정 날짜&quot;
tags:
  - 태그들
  - ...
---&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이런 식으로 작성해주셔야지 &lt;/p&gt;
&lt;p&gt;&lt;span class=&apos;gatsby-resp-image-wrapper&apos; style=&apos;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;&apos;&gt;
      &lt;a class=&apos;gatsby-resp-image-link&apos; href=&apos;/static/b50759e515c677df95ccad84bf69ecd1/f967b/title.png&apos; style=&apos;display: block&apos; target=&apos;_blank&apos; rel=&apos;noopener&apos;&gt;
    &lt;span class=&apos;gatsby-resp-image-background-image&apos; style=&quot;padding-bottom: 31.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAnUlEQVR42p2PywqDMBBF/Ys8RJoimOCDOom6K20xumvp///MbTp00W1cXIZhhsO5BfmANW643u6I24415fl647FGCCGglMpKYa3FSISu69G2HS4jwYcpzfEY0JgzrHWo6xplWUJrDSklH6uqOmDoHCgEhk7zwrb9MIDIJ+shPek84MkYNE3Dy7ciJxnKX7INXTKcl4Wraq145kL+gR+FuKLVhaBWTAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&apos;gatsby-resp-image-image&apos; alt=&apos;title&apos; title=&apos;&apos; src=&apos;/static/b50759e515c677df95ccad84bf69ecd1/ca1dc/title.png&apos; srcset=&apos;/static/b50759e515c677df95ccad84bf69ecd1/e7570/title.png 170w,
/static/b50759e515c677df95ccad84bf69ecd1/f46e7/title.png 340w,
/static/b50759e515c677df95ccad84bf69ecd1/ca1dc/title.png 680w,
/static/b50759e515c677df95ccad84bf69ecd1/02d09/title.png 1020w,
/static/b50759e515c677df95ccad84bf69ecd1/9d567/title.png 1360w,
/static/b50759e515c677df95ccad84bf69ecd1/f967b/title.png 1418w&apos; sizes=&apos;(max-width: 680px) 100vw, 680px&apos; style=&apos;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&apos; loading=&apos;lazy&apos; decoding=&apos;async&apos;&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;위에서 보시는 바와 같이 하실 수 있습니다.&lt;/p&gt;
&lt;h2&gt;이미지 삽입&lt;/h2&gt;
&lt;p&gt;이미지를 삽입하시고 싶으시다면, &lt;/p&gt;
&lt;p&gt;저의 가이드를 모두 잘 따르셨다고 가정했을 때, .index_image 내부에 image 파일을 넣고&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;![](.index_image/{이미지 파일 명})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이런 식으로 작성해주시면 이미지도 정상적으로 삽입하실  수 있습니다!&lt;/p&gt;
&lt;h2&gt;주의!&lt;/h2&gt;
&lt;p&gt;다른 사람들의 정성스런 글을 날리지 않기 위해, 항상 Push 이전에 Pull 해주는 거 잊지 않으셨죠? ㅋㅋㅋ&lt;/p&gt;
&lt;p&gt;물론 Warning Message 가 뜨긴 할테지만, 잊지 말아주세용~~~&lt;/p&gt;
&lt;h2&gt;레퍼런스&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://pium-official.github.io/blog-starter/&quot;&gt;https://pium-official.github.io/blog-starter/&lt;/a&gt;&lt;/p&gt;</content:encoded></item></channel></rss>