{"componentChunkName":"component---src-pages-search-jsx","path":"/search/","result":{"data":{"allMarkdownRemark":{"nodes":[{"excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„íŒ€ì˜ ì´ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. í™ˆí˜ì´ì§€ì—ì„œ ìš©ëŸ‰ì„ ë§ì´ ì°¨ì§€í•˜ê³  í˜ì´ì§€ ë¡œë”© ì†ë„ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì´ë¯¸ì§€ì™€ ë²ˆë“¤ ì‚¬ì´ì¦ˆ ìµœì í™”ë¥¼ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ ìµœì í™” í™ˆí˜ì´ì§€ì—ì„œ ê°€ì¥ ë§ì€ ìš©ëŸ‰ì„ ì°¨ì§€í•˜ê³  í˜ì´ì§€ ë¡œë”© ì†ë„ì— ê°€ì¥ í° ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ê²ƒì€ ì´ë¯¸ì§€ë¼ëŠ” ì˜ê²¬ì´ ë‚˜ì™”ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ìª½ì—ì„œëŠ” ì´ë¯¸ì§€ ì—…ë¡œë“œ ìš©ëŸ‰ í•œê³„ì¹˜ë¥¼ ë‘ê³  í”„ë¡ íŠ¸ ë‹¨ì—â€¦","fields":{"slug":"/how-to-optimize-website/"},"frontmatter":{"date":"October 18, 2023","title":"ê´œì°®ì„ì§€ë„ ì‚¬ì´íŠ¸ ìµœì í™” ì§„í–‰","tags":["ë¸”ë¡œê·¸"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„íŒ€ì˜ `íŒ¨íŠ¸ë¦­`ì´ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.\n\ní™ˆí˜ì´ì§€ì—ì„œ ìš©ëŸ‰ì„ ë§ì´ ì°¨ì§€í•˜ê³  í˜ì´ì§€ ë¡œë”© ì†ë„ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì´ë¯¸ì§€ì™€ ë²ˆë“¤ ì‚¬ì´ì¦ˆ ìµœì í™”ë¥¼ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n## ì´ë¯¸ì§€ ìµœì í™”\n\ní™ˆí˜ì´ì§€ì—ì„œ ê°€ì¥ ë§ì€ ìš©ëŸ‰ì„ ì°¨ì§€í•˜ê³  í˜ì´ì§€ ë¡œë”© ì†ë„ì— ê°€ì¥ í° ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ê²ƒì€ ì´ë¯¸ì§€ë¼ëŠ” ì˜ê²¬ì´ ë‚˜ì™”ìŠµë‹ˆë‹¤. ë°±ì—”ë“œ ìª½ì—ì„œëŠ” ì´ë¯¸ì§€ ì—…ë¡œë“œ ìš©ëŸ‰ í•œê³„ì¹˜ë¥¼ ë‘ê³  í”„ë¡ íŠ¸ ë‹¨ì—ì„œ ìš©ëŸ‰ì„ ì¤„ì´ê¸°ë¡œ í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n### browser-image-compression ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©\n![Alt text](.index_image/browser-compression.png)\n\nê·¸ë¦¬ê³  í•˜ë‚˜ì˜ ì´ë¯¸ì§€ì™€ ì—¬ëŸ¬ ê°œì˜ ì´ë¯¸ì§€ë¥¼ ì••ì¶•í•˜ëŠ” ê³³ì´ ë”°ë¡œ ìˆì–´ êµ¬ë¶„í•´ì„œ ì ìš©í•˜ê¸° ìœ„í•´ custom hookìœ¼ë¡œ ë¶„ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.\n```typescript\nimport imageCompression from 'browser-image-compression';\n\nconst useCompressImage = () => {\n  const compressImage = async (file: File) => {\n    const resizingBlob = await imageCompression(file, {\n      maxSizeMB: 1, // ìµœëŒ€ ì´ë¯¸ì§€ ìš©ëŸ‰\n      maxWidthOrHeight: 750, // ìµœëŒ€ ì´ë¯¸ì§€ í¬ê¸°\n      useWebWorker: true, // ë¹„ë™ê¸° ì²˜ë¦¬ ìœ ë¬´\n    });\n    const resizingFile = new File([resizingBlob], file.name, {\n      type: file.type,\n    });\n    return resizingFile;\n  };\n\n  const compressImageList = async (files: FileList) => {\n    const compressedImageList: File[] = [];\n\n    for (const file of files) {\n      const compressedImage = await compressImage(file);\n      compressedImageList.push(compressedImage);\n    }\n\n    return compressedImageList;\n  };\n\n  return { compressImage, compressImageList };\n};\n\nexport default useCompressImage;\n```\n\nì´ë¥¼ í†µí•´ ì„±ëŠ¥ì´ ê°œì„ ëœ ì§€í‘œì…ë‹ˆë‹¤.\n![Alt text](.index_image/optimize-compress.png)\n\n\n\n## ë²ˆë“¤ ì‚¬ì´ì¦ˆ\nì´ë¯¸ì§€ ë‹¤ìŒìœ¼ë¡œ ë²ˆë“¤ ì‚¬ì´ì¦ˆê°€ í˜ì´ì§€ ë¡œë”© ì†ë„ì— ì˜í–¥ì„ ë¼ì¹œë‹¤ëŠ” ê²ƒì„ ì•Œì•˜ìŠµë‹ˆë‹¤. ë™ì  import(lazy, suspense ì´ìš©)ì™€ tree shakingì„ í†µí•´ ê°œì„ í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n\n```typescript\nconst SelectedTopic = lazy(() => import('./pages/SelectedTopic'));\nconst NewPin = lazy(() => import('./pages/NewPin'));\nconst NewTopic = lazy(() => import('./pages/NewTopic'));\nconst SeeAllPopularTopics = lazy(() => import('./pages/SeeAllPopularTopics'));\nconst SeeAllNearTopics = lazy(() => import('./pages/SeeAllNearTopics'));\nconst SeeAllLatestTopics = lazy(() => import('./pages/SeeAllLatestTopics'));\nconst KakaoRedirect = lazy(() => import('./pages/KakaoRedirect'));\nconst Profile = lazy(() => import('./pages/Profile'));\nconst AskLogin = lazy(() => import('./pages/AskLogin'));\nconst Bookmark = lazy(() => import('./pages/Bookmark'));\n```\n\n```typescript\n\nfunction SuspenseComp({ children }: SuspenseCompProps) {\n  return <Suspense fallback={null}>{children}</Suspense>;\n}\n\n{\n  path: 'topics/:topicId',\n  element: (\n    <SuspenseComp>\n      <SelectedTopic />\n    </SuspenseComp>\n  ),\n  withAuth: false,\n},\n{\n  path: 'new-topic',\n  element: (\n    <SuspenseComp>\n      <NewTopic />\n    </SuspenseComp>\n  ),\n  withAuth: true,\n},\n{\n  path: 'new-pin',\n  element: (\n    <SuspenseComp>\n      <NewPin />\n    </SuspenseComp>\n  ),\n  withAuth: true,\n},\n{\n  path: 'see-all/popularity',\n  element: (\n    <SuspenseComp>\n      <SeeAllPopularTopics />\n    </SuspenseComp>\n  ),\n  withAuth: false,\n},\n{\n  path: 'see-all/near',\n  element: (\n    <SuspenseComp>\n      <SeeAllNearTopics />\n    </SuspenseComp>\n  ),\n  withAuth: false,\n},\n{\n  path: 'see-all/latest',\n  element: (\n    <SuspenseComp>\n      <SeeAllLatestTopics />\n    </SuspenseComp>\n  ),\n  withAuth: false,\n},\n{\n  path: 'favorite',\n  element: (\n    <SuspenseComp>\n      <Bookmark />\n    </SuspenseComp>\n  ),\n  withAuth: true,\n},\n{\n  path: 'my-page',\n  element: (\n    <SuspenseComp>\n      <Profile />\n    </SuspenseComp>\n  ),\n  withAuth: true,\n},\n{\n  path: '/askLogin',\n  element: (\n    <SuspenseComp>\n      <AskLogin />\n    </SuspenseComp>\n  ),\n  withAuth: false,\n},\n```\n\n\n- ê°œì„  ì „\n![Alt text](.index_image/before.png)\n\n- ê°œì„  í›„\n![Alt text](.index_image/after.png)"},{"excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„íŒ€ì˜ ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ë°±ì—”ë“œ í¬ë£¨ 'ë§¤íŠœ'ì™€ í˜‘ë ¥í•´ S3ì— ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ì‘ì—…ì„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. ìƒê°ë³´ë‹¤ ì‹œê°„ë„ ì˜¤ë˜ ê±¸ë¦¬ê³  ì–´ë ¤ì›€ë„ ë§ì•˜ì§€ë§Œ ë§ì´ ë°°ì› ê³  ë³´ëŒìˆëŠ” ì‹œê°„ì´ì—ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ ê´€ë ¨ ì‚¬ìš©ì í”¼ë“œë°± ì´ë¯¸ì§€ë¥¼ stringìœ¼ë¡œ ì €ì¥í•˜ê³  ìˆì–´ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ”ë° ë²ˆê±°ëŸ½ë‹¤ëŠ” í”¼ë“œë°±ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. formDataë¥¼ í†µí•´ ì´ë¯¸â€¦","fields":{"slug":"/how-to-store-image-s3/"},"frontmatter":{"date":"October 18, 2023","title":"ë°±ì—”ë“œì™€ í˜‘ë ¥í•´ S3ì— ì´ë¯¸ì§€ ì €ì¥í•˜ê¸°","tags":["ë¸”ë¡œê·¸"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„íŒ€ì˜ `íŒ¨íŠ¸ë¦­`ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.\n\në°±ì—”ë“œ í¬ë£¨ 'ë§¤íŠœ'ì™€ í˜‘ë ¥í•´ S3ì— ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ” ì‘ì—…ì„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤. ìƒê°ë³´ë‹¤ ì‹œê°„ë„ ì˜¤ë˜ ê±¸ë¦¬ê³  ì–´ë ¤ì›€ë„ ë§ì•˜ì§€ë§Œ ë§ì´ ë°°ì› ê³  ë³´ëŒìˆëŠ” ì‹œê°„ì´ì—ˆìŠµë‹ˆë‹¤.\n\n### ì´ë¯¸ì§€ ê´€ë ¨ ì‚¬ìš©ì í”¼ë“œë°± \nì´ë¯¸ì§€ë¥¼ stringìœ¼ë¡œ ì €ì¥í•˜ê³  ìˆì–´ ì´ë¯¸ì§€ë¥¼ ì €ì¥í•˜ëŠ”ë° ë²ˆê±°ëŸ½ë‹¤ëŠ” í”¼ë“œë°±ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.\n\n##  formDataë¥¼ í†µí•´ ì´ë¯¸ì§€ ì„œë²„ì— ì „ì†¡í•˜ê¸°\n\nfile typeì˜ Input íƒœê·¸ë¥¼ ë§Œë“­ë‹ˆë‹¤.<br>\nfileì„ ì„œë²„ë¡œ ì „ì†¡í•˜ë©´ í•´ë‹¹ file ë°ì´í„°ë¥¼ multipart/form-dataí˜•íƒœë¡œ ë°›ìŠµë‹ˆë‹¤.\n\n```typescript\n<ImageInputButton id=\"file\" type=\"file\" name=\"image\" onChange={onHandler} />\n``` \n\nform ë°ì´í„°ë¥¼Â ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê³  ì „ì†¡ ê°€ëŠ¥í•œÂ ê°ì²´ì¸ formDataë¥¼ ì¨ì„œ ë‚´ìš©ì„ keyì™€ value í˜•ì‹ìœ¼ë¡œ ë³´ë‚´ë„ë¡ í–ˆìŠµë‹ˆë‹¤.\n\n```typescript\nconst formData = new FormData();\n\nif (formImage) {\n   formData.append('image', formImage);\n}\n``` \n\n### ë¬¸ì œ ìƒí™© : 1ì°¨ ì„œë²„ ì—ëŸ¬ ë°œìƒ\nì„œë²„ Post ìš”ì²­ ì‹œ ì„œë²„ìª½ì—ì„œ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n```java\n// ì—ëŸ¬\nCaused by: org.apache.tomcat.util.http.fileupload.FileUploadException: the request was rejected because no multipart boundary was found\nat org.apache.tomcat.util.http.fileupload.impl.FileItemIteratorImpl.init(FileItemIteratorImpl.java:189)\nat org.apache.tomcat.util.http.fileupload.impl.FileItemIteratorImpl.getMultiPartStream(FileItemIteratorImpl.java:205)\nat org.apache.tomcat.util.http.fileupload.impl.FileItemIteratorImpl.findNextItem(FileItemIteratorImpl.java:224)\nat org.apache.tomcat.util.http.fileupload.impl.FileItemIteratorImpl.<init>(FileItemIteratorImpl.java:142)\nat org.apache.tomcat.util.http.fileupload.FileUploadBase.getItemIterator(FileUploadBase.java:252)\nat org.apache.tomcat.util.http.fileupload.FileUploadBase.parseRequest(FileUploadBase.java:276)\nat org.apache.catalina.connector.Request.parseParts(Request.java:2799)\n... 46 common frames omitted\n``` \n\nì—ëŸ¬ì˜ ì›ì¸ì€ boundaryë¥¼ ì°¾ì§€ ëª»í•´ ë‚˜ëŠ” ê²ƒì´ì—ˆê³  formDataì— íŒŒì¼ì´ ìˆì„ ê²½ìš° ë¸Œë¼ìš°ì €ëŠ” ìë™ìœ¼ë¡œ boundaryë¥¼ ë¶™ì—¬ì¤€ë‹¤ëŠ” ê²ƒì„ ì•Œì•˜ìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ Post ìš”ì²­ì„ í•  ë•Œ ê°œë°œìê°€ content-typeì„ multipart/form-dataë¡œ ì§€ì •í•´ì£¼ë©´ ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ìƒì„±í•œ boundaryë¥¼ ë®ì–´ì¨ ë²„ë¦½ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì„œë²„ëŠ” ìš”ì²­ ë³¸ë¬¸ì„ ì˜¬ë°”ë¥´ê²Œ íŒŒì‹±í•˜ì§€ ëª»í•˜ì—¬ íŒŒì¼ ë° í¼ ë°ì´í„°ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì²˜ë¦¬í•˜ì§€ ëª»í•©ë‹ˆë‹¤.<br>\nê·¸ë˜ì„œ content-typeì„ ì§€ìš°ë©´ í•´ê²°ì´ ë ê±°ë¼ê³  ìƒê°í•´ ì§€ì› ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ì—­ì‹œ ë¬¸ì œëŠ” ì‰½ê²Œ í•´ê²°ë˜ì§€ ì•ŠëŠ” ë²•! ë˜ ë‹¤ë¥¸ ì—ëŸ¬ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.\n\n\n### ë¬¸ì œ ìƒí™© : 2ì°¨ ì„œë²„ ì—ëŸ¬ ë°œìƒ\njson ë°ì´í„°ë¥¼ application/json íƒ€ì…ìœ¼ë¡œ ëª…ì‹œí•´ ì£¼ì§€ ì•Šì•„ octet-stream(8ë¹„íŠ¸ ë‹¨ìœ„ì˜ ì´ì§„ ë°ì´í„°)ë¡œ ì¸ì‹í•˜ì—¬ ë°œìƒí•œ ì—ëŸ¬ì˜€ìŠµë‹ˆë‹¤. 'Blob(Binary Large Object)'ì„ ì‚¬ìš©í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n\n```java\nconst data = JSON.stringify(objectData);\n// Blobì²˜ë¦¬ë¡œ JSON ë¬¸ìì—´ì´ ì´ì§„ ë°ì´í„°ë¡œ ë³€í™˜. ë˜í•œ typeì— application/jsonì„ ëª…ì‹œ\nconst jsonBlob = new Blob([data], { type: 'application/json' });\n\nformData.append('request', jsonBlob);\n``` \n\n\nì´ëŸ¬í•œ ê³¼ì •ì„ í†µí•´ ì„œë²„ì— ì´ë¯¸ì§€ì™€ ë°ì´í„°ë¥¼ ì „ì†¡í•  ìˆ˜ ìˆì—ˆê³  ì´ë¥¼ ë°”íƒ•ìœ¼ë¡œ S3ì— ì´ë¯¸ì§€ë¥¼ ì €ì¥í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤!"},{"excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„ì˜ ê°€ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ì‚­ì œ ê¸°ëŠ¥ì— ëŒ€í•œ ë¦¬íŒ©í„°ë§ ì¤‘, íšŒì› ì°¨ë‹¨ì— ëŒ€í•œ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•´ ì´ë¥¼ í•´ê²°í•´ì•¼ í–ˆëŠ”ë°ìš”. JPAì— ëŒ€í•œ ì§€ì‹ì´ ë¶€ì¡±í•œ ìƒíƒœì—ì„œ ì‚½ì§ˆì„ í•˜ë©° ì•Œê²Œ ëœ ê²ƒë“¤ì„ ê¸°ë¡í•˜ê³ ì í•©ë‹ˆë‹¤. ë¬¸ì œ ìƒí™© 1 : ì¿¼ë¦¬ì˜ ë°œìƒ ì‹œì  ì°¾ê¸° ë„ë©”ì¸: íšŒì› ì°¨ë‹¨ ê¸°ëŠ¥ ë„ë©”ì¸ì— ëŒ€í•´ ë¨¼ì € ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. ê´€ë¦¬ì APIì—ì„œ íšŒì›â€¦","fields":{"slug":"/trouble-shooting-jpa-delete-and-persistence/"},"frontmatter":{"date":"October 13, 2023","title":"JPA ì—”í‹°í‹°ë¥¼ ì‚­ì œí•  ë•Œ ì˜ì†ì„±ê³¼ ì—°ê´€ ê´€ê³„ê°€ ì¤‘ìš”í•œ ì´ìœ ","tags":["Spring Data JPA","Hibernate","JPQL","íŠ¸ëŸ¬ë¸”ìŠˆíŒ…"]},"rawMarkdownBody":"> \n> ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„ì˜ `ë„ì´`ê°€ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\n\nì‚­ì œ ê¸°ëŠ¥ì— ëŒ€í•œ ë¦¬íŒ©í„°ë§ ì¤‘, íšŒì› ì°¨ë‹¨ì— ëŒ€í•œ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•´ ì´ë¥¼ í•´ê²°í•´ì•¼ í–ˆëŠ”ë°ìš”.  \nJPAì— ëŒ€í•œ ì§€ì‹ì´ ë¶€ì¡±í•œ ìƒíƒœì—ì„œ ì‚½ì§ˆì„ í•˜ë©° ì•Œê²Œ ëœ ê²ƒë“¤ì„ ê¸°ë¡í•˜ê³ ì í•©ë‹ˆë‹¤.\n\n## ë¬¸ì œ ìƒí™© 1 : ì¿¼ë¦¬ì˜ ë°œìƒ ì‹œì  ì°¾ê¸°\n\n### ë„ë©”ì¸: íšŒì› ì°¨ë‹¨ ê¸°ëŠ¥\në„ë©”ì¸ì— ëŒ€í•´ ë¨¼ì € ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.  \nê´€ë¦¬ì APIì—ì„œ íšŒì›ì„ ì°¨ë‹¨í•˜ë©´, ì°¨ë‹¨í•œ íšŒì›ì˜ ì§€ë„ `Topic`, í•€ `Pin`, í•€ ì´ë¯¸ì§€ `PinImage`ë¥¼ ì‚­ì œ ìƒíƒœ(soft delete)ë¡œ ë³€ê²½í•©ë‹ˆë‹¤.  \nê·¸ë¦¬ê³  ë§¤í•‘ í…Œì´ë¸” ì—­í• ì„ í•˜ëŠ” ì—”í‹°í‹°ì¸ `Bookmark ì¦ê²¨ì°¾ê¸°`, `Atlas ëª¨ì•„ë³´ê¸°`, `Permission ê¶Œí•œ`ì€ ì‹¤ì œë¡œ ì‚­ì œ(hard delete)í•©ë‹ˆë‹¤.\n\n\n```java\n    public void blockMember(Long memberId) {\n        Member member = findMemberById(memberId);\n        member.updateStatus(Status.BLOCKED);\n\n        deleteAllRelated(member);\n    }\n\n    private void deleteAllRelated(Member member) {\n        List<Long> pinIds = extractPinIdsByMember(member);\n        Long memberId = member.getId();\n\n        permissionRepository.deleteAllByMemberId(memberId);\n        atlasRepository.deleteAllByMemberId(memberId);\n        bookmarkRepository.deleteAllByMemberId(memberId);\n        pinImageRepository.deleteAllByPinIds(pinIds);\n        pinRepository.deleteAllByMemberId(memberId);\n        topicRepository.deleteAllByMemberId(memberId);\n    }\n```\n\nì•„ë˜ì™€ ê°™ì´ ë™ì‘í•˜ê¸°ë¥¼ ê¸°ëŒ€í–ˆìŠµë‹ˆë‹¤.\n\n1. ì°¨ë‹¨í•  íšŒì›ì— ëŒ€í•œ ì •ë³´ ì¡°íšŒ\n2. íšŒì›ì˜ ìƒíƒœë¥¼ ì°¨ë‹¨ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” update ì¿¼ë¦¬ ë°œìƒ\n3. ë§¤í•‘ í…Œì´ë¸” ì—”í‹°í‹°ë“¤ì„ ë¨¼ì € ì‚­ì œí•´ì•¼ í•¨, ì´ ë•Œ delete ì¿¼ë¦¬ ë°œìƒ\n4. ì£¼ìš” ë„ë©”ì¸ ì—”í‹°í‹°ë“¤ì„ ì‚­ì œ ìƒíƒœë¡œ ë³€ê²½í•˜ëŠ” update ì¿¼ë¦¬ ë°œìƒ\n\n### ì˜ˆìƒê³¼ ë‹¤ë¥¸ ì˜ì† ë™ì‘\ní…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n\n```java\n    @DisplayName(\"Memberë¥¼ ì°¨ë‹¨(íƒˆí‡´ì‹œí‚¬)í•  ê²½ìš°, Memberê°€ ìƒì„±í•œ ì§€ë„, í•€, í•€ ì´ë¯¸ì§€ë¥¼ ì‚­ì œ ìƒíƒœ(soft delete)ë¡œ ë³€ê²½í•œë‹¤.\")\n    @Test\n    void blockMember_Success() {\n        //given\n        // ...    \n        // ê°ì²´ ìƒì„±, ì €ì¥ ë° ê¸°ì¡´ ìƒíƒœ ê²€ì¦ ì½”ë“œ ìƒëµ\n        // ...\n            \n        //when\n        adminCommandService.blockMember(member.getId());\n\n        //then\n        Member blockedMember = memberRepository.findById(member.getId()).get();\n\n        assertAll(\n            () -> assertThat(blockedMember.getStatus()).isEqualTo(Status.BLOCKED), // ì‹¤íŒ¨\n            () -> assertThat(bookmarkRepository.existsByMemberIdAndTopicId(member.getId(), topic.getId()))\n            .isFalse(), // ì‹¤íŒ¨\n            () -> assertThat(atlasRepository.existsByMemberIdAndTopicId(member.getId(), topic.getId())).isFalse(), // ì‹¤íŒ¨\n            () -> assertThat(permissionRepository.existsByTopicIdAndMemberId(topic.getId(), member.getId()))\n            .isFalse() // ì‹¤íŒ¨\n            () -> assertThat(topicRepository.existsById(topic.getId())).isFalse(), \n            () -> assertThat(pinRepository.existsById(pin.getId())).isFalse(),\n            () -> assertThat(pinImageRepository.existsById(pinImage.getId())).isFalse(),\n        );\n    }\n```\n\n\ní•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•´ ë¡œê·¸ë¥¼ ë³´ë‹ˆ, ì‹¤ì œ ë™ì‘ì€ ì•„ë˜ì™€ ê°™ì•˜ìŠµë‹ˆë‹¤. ğŸ˜§ğŸ˜§\n\n1. ì°¨ë‹¨í•  íšŒì›ì— ëŒ€í•œ ì •ë³´ ì¡°íšŒ\n2. ~~íšŒì›ì˜ ìƒíƒœë¥¼ ì°¨ë‹¨ìœ¼ë¡œ ë³€ê²½í•˜ëŠ” update ì¿¼ë¦¬ ë°œìƒ~~\n3. ~~ë§¤í•‘ í…Œì´ë¸” ì—”í‹°í‹°ë“¤ì„ ë¨¼ì € ì‚­ì œí•´ì•¼ í•¨, ì´ ë•Œ delete ì¿¼ë¦¬ ë°œìƒ~~\n4. ì£¼ìš” ë„ë©”ì¸ ì—”í‹°í‹°ë“¤ì„ ì‚­ì œ ìƒíƒœë¡œ ë³€ê²½í•˜ëŠ” update ì¿¼ë¦¬ ë°œìƒ\n\n`// when` ì ˆì˜ ì½”ë“œë¥¼ í˜¸ì¶œí•œ ë’¤ entityManagerë¡œ flush, clearë¥¼ í•´ì£¼ì–´ë„ ë§ˆì°¬ê°€ì§€ì˜€ìŠµë‹ˆë‹¤.  \n\n## ì›ì¸\nì´ì „ì—ëŠ” ì˜ í†µê³¼í•˜ë˜ í…ŒìŠ¤íŠ¸ì¸ë°, ì™œ ê°‘ìê¸° ì˜ˆìƒê³¼ ë‹¤ë¥´ê²Œ ì‘ë™í• ê¹Œìš”?  \nJPA ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì“°ê¸° ì§€ì—° ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤.  \n\n1. hard delete ë©”ì„œë“œë¥¼ í†µí•´ í•´ë‹¹ idë¥¼ ê°€ì§„ ì—”í‹°í‹°ë¥¼ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì œê±°í•œë‹¤.\n2. soft delete ë©”ì„œë“œë¥¼ í†µí•´ updateë¥¼ í˜¸ì¶œí•˜ë©´ì„œ, ì—°ê´€ëœ ì—”í‹°í‹°ë“¤ì´ ëª¨ë‘ ì˜ì†í™”ëœë‹¤.  \n   â¡ï¸ (1)ì—ì„œ delete í•´ë„, 2ì—ì„œ ì¡°íšŒí•  ë•Œ í•¨ê»˜ ë¶ˆëŸ¬ì™€ì§€ëŠ” `member`, `permission`, `atlas`, `bookmark`ê¹Œì§€ ë‹¤ì‹œ ì˜ì†í™”ëœë‹¤.   \n3. ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ëŠ” `(ì°¨ë‹¨ ìƒíƒœê°€ ì•„ë‹Œ)member`, `permission`, `atlas`, `bookmark`ê°€ ì¡´ì¬í•œë‹¤.\n4. `blockMember()` í˜¸ì¶œ í›„ flushë¥¼ í•  ë•Œ, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ìƒíƒœë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤.  \n   â¡ï¸ memberì˜ ì°¨ë‹¨ ìƒíƒœì— ëŒ€í•œ ë³€ê²½ ê°ì§€ë„ ë˜ì§€ ì•Šê³ , delete ì¿¼ë¦¬ë„ ë‚˜ê°€ì§€ ì•ŠëŠ”ë‹¤.\n\nê·¸ë˜ì„œ `blockMember()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œ ë’¤ flushë¥¼ í•´ì¤˜ë„ ì†Œìš©ì´ ì—†ì—ˆë˜ ê²ƒì…ë‹ˆë‹¤.  \n\n\n## í•´ê²°\n\në‹¨ìˆœíˆ í•´ê²°ë¶€í„° í•´ë³´ìë©´,  \nsoft delete ë©”ì„œë“œë¡œ ì¸í•œ ì˜ì†í™”ê°€ ë˜ê¸° ì´ì „ì— flushí•´ì„œ memberì˜ ë³€ê²½, hard deleteì— ëŒ€í•œ ì¿¼ë¦¬ë¥¼ ë°œìƒì‹œí‚¤ë©´ ë©ë‹ˆë‹¤.  \n\n\n### flushë¡œ ì¿¼ë¦¬ ë°œìƒ ì‹œì  ì¡°ì •í•˜ê¸°\n\nì•„ë˜ ì²˜ëŸ¼ ì„œë¹„ìŠ¤ ë‹¨ì—ì„œ í•´ì£¼ê±°ë‚˜, `@Modifying` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n```java\n    private void deleteAllRelated(Member member) {\n        permissionRepository.deleteAllByMemberId(memberId);\n        atlasRepository.deleteAllByMemberId(memberId);\n        bookmarkRepository.deleteAllByMemberId(memberId);\n        // flush!\n        bookmarkRepository.flush();\n        pinImageRepository.deleteAllByPinIds(pinIds);\n        pinRepository.deleteAllByMemberId(memberId);\n        topicRepository.deleteAllByMemberId(memberId);\n    }\n```\n## ë¬¸ì œ ìƒí™© 2 : í…ŒìŠ¤íŠ¸ì—ì„œ ë°œìƒí•˜ì§€ ì•ŠëŠ” ì¼ë¶€ ì¿¼ë¦¬\n\nê·¸ëŸ°ë°ë„ í…ŒìŠ¤íŠ¸ëŠ” ì„±ê³µí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ğŸ¥²  \n`delete bookmark~` ì¿¼ë¦¬ëŠ” ì—¬ì „íˆ ë°œìƒí•˜ì§€ ì•Šê³  ìˆì—ˆìŠµë‹ˆë‹¤.  \n\ní…ŒìŠ¤íŠ¸ ë©”ì„œë“œì™€ `blockMember()`ëŠ” ê°™ì€ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì´ê¸° ë•Œë¬¸ì— `// when`ì ˆì—ì„œì˜ ì˜ì†í™” ìƒíƒœ ë•Œë¬¸ì¼ ê²ƒì´ë¼ ì§ì‘í–ˆìŠµë‹ˆë‹¤.  \n`bookmark`ë¥¼ ì°¸ì¡°í•˜ëŠ” `topic`, ë˜ëŠ” `member` ê°ì²´ê°€ ì˜ì†í™”ë˜ì–´ìˆê¸° ë•Œë¬¸ì— delete ì¿¼ë¦¬ê°€ ë‚˜ê°€ì§€ ì•ŠëŠ” ê²ƒì´ë¼ ìƒê°í–ˆìŠµë‹ˆë‹¤.  \n\nê·¸ë˜ì„œ ì´ì— ëŒ€í•´ì„œëŠ” `blockMember()` í˜¸ì¶œ ì „ì— `testEntityManager.clear()`ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™”í•´ë‘ëŠ” ê²ƒìœ¼ë¡œ í•´ê²°í–ˆìŠµë‹ˆë‹¤.  \n\n\n**í•˜ì§€ë§Œ ì •í™•í•œ ì›ì¸ì´ ê¶ê¸ˆí–ˆìŠµë‹ˆë‹¤. \nì™œ `atlas`, `permission`ì€ ì‚­ì œë˜ê³  `bookmark`ë§Œ ì‚­ì œë˜ì§€ ì•Šì•˜ì„ê¹Œìš”?**  \n\n## ì›ì¸\në‹¤ë¥¸ ë§¤í•‘ í…Œì´ë¸” ì—”í‹°í‹°ë“¤ê³¼ `bookmark`ì˜ ì°¨ì´ì ì„ ì‚´í´ë³´ì•˜ìŠµë‹ˆë‹¤.  \ní•´ë‹¹ ì—”í‹°í‹°ë§Œì´ `topic`ê³¼ì˜ ì—°ê´€ ê´€ê³„ì—ì„œ `CasecadeType.PERSIST`ê°€ ê±¸ë ¤ ìˆì—ˆìŠµë‹ˆë‹¤.\n\n```java\n    // Topic.class\n    @OneToMany(mappedBy = \"topic\", cascade = CascadeType.PERSIST, orphanRemoval = true)\n    private List<Bookmark> bookmarks = new ArrayList<>();\n```\n\ní…ŒìŠ¤íŠ¸ ë©”ì„œë“œì˜ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì¡´ì¬í•˜ëŠ” `topic`ì— `bookmark`ê°€ ì‚´ì•„ìˆê¸° ë•Œë¬¸ì—  \n`PERSIST OPERATION`ì´ ë°œìƒí•˜ê³  `bookmark`ì— ëŒ€í•œ delete ì¿¼ë¦¬ëŠ” ë¬´ì‹œë©ë‹ˆë‹¤.  \n\n> [JPA 2.2 specification](https://download.oracle.com/otndocs/jcp/persistence-2_2-mrel-eval-spec/index.html) ë¬¸ì„œ 3.2 ì¥ Entity Instance's Life Cycleì— ë”°ë¥´ë©´,  \n> flushê°€ ë°œìƒí•  ë•Œ `CascadeType.PERSIST`ë‚˜ `CascadeType.ALL`ì´ ìˆì„ ê²½ìš° ìì‹ì— ì—°ì‡„ì ìœ¼ë¡œ `PERSIST OPERATION`ì´ ë°œìƒí•©ë‹ˆë‹¤. \n> `PERSIST OPERATION`ì€ ì—°ê´€ ê´€ê³„ ë§¤í•‘ëœ listì˜ ì—”í‹°í‹°ì— ëŒ€í•´ ëª¨ë‘ ì´ë£¨ì–´ì§€ë©°, ê¸°ì¡´ì— ì—†ë˜ ê°’ì´ë©´ ìƒˆë¡œ ì €ì¥í•©ë‹ˆë‹¤.\n\n## í•´ê²°\nì´ì— ëŒ€í•´ì„œ ì—”í‹°í‹°ì— ê±¸ì–´ë†“ì€ ì¡°ê±´ì— ë”°ë¼ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ë„ë¡ í•˜ë ¤ë©´,   \n`bookmarkRepository`ë¥¼ í†µí•´ delete ì¿¼ë¦¬ë¥¼ í˜¸ì¶œí•˜ëŠ” ëŒ€ì‹  ì—°ê´€ ê´€ê³„ë¥¼ ì œê±°í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‚­ì œí•´ì£¼ì—ˆì–´ì•¼ í–ˆë˜ ê²ƒì…ë‹ˆë‹¤.\n\n```java\n    // Topic.class\n    public void removeBookmarkBy(Member member) {\n        bookmarks.stream()\n        .filter(bookmark -> bookmark.getMember().isSame(member))\n        .findFirst()\n        .ifPresent(this::removeBookmark);\n        bookmarkCount--;\n    }\n\n    // AdminCommandService.class\n    private void deleteAllRelatedMember(Member member) {\n        List<Long> pinIds = extractPinIdsByMember(member);\n        Long memberId = member.getId();\n\n        permissionRepository.deleteAllByMemberId(memberId);\n        atlasRepository.deleteAllByMemberId(memberId);\n        // ë³€ê²½ëœ ë¶€ë¶„\n        topicRepository.findTopicsByBookmarksMemberId(memberId)\n            .forEach(topic -> topic.removeBookmarkBy(member));\n        atlasRepository.flush();\n        pinImageRepository.deleteAllByPinIds(pinIds);\n        pinRepository.deleteAllByMemberId(memberId);\n        topicRepository.deleteAllByMemberId(memberId);\n    }\n```\n\nì•„ë˜ì™€ ê°™ì´ `bookmark`ì— ëŒ€í•œ ì‚­ì œ ë¡œì§ì„ ìˆ˜ì •í•˜ë‹ˆ,  \ní…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ë³„ë„ì˜ `clear`ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ ì˜ í†µê³¼í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n\n\n## ê²°ë¡ \nì´ë²ˆ ì‚½ì§ˆì„ ê³„ê¸°ë¡œ JPAë¥¼ ì˜ í•™ìŠµí•œ ë’¤ ì‚¬ìš©í•´ì•¼ í•œë‹¤ëŠ” êµí›ˆì„ ë‹¤ì‹œ í•œ ë²ˆ ëª¸ì†Œ ëŠê¼ˆìŠµë‹ˆë‹¤..  \n\nì—”í‹°í‹°ì˜ ìƒëª… ì£¼ê¸°ì— ëŒ€í•´ ì˜ ì´í•´í•˜ê³  ê°ì²´ë¥¼ ìƒì„± ë° ì‚­ì œí•´ì•¼í•œë‹¤ëŠ” ê²ƒ, ì‚­ì œí•  ë•Œì—ë„ ì—°ê´€ ê´€ê³„ì˜ ê´€ë¦¬ê°€ ì¤‘ìš”í•˜ë‹¤ëŠ” ê²ƒì„ ì•Œì•˜ìŠµë‹ˆë‹¤.\nì´ì²˜ëŸ¼ ì˜ˆìƒí•˜ì§€ ëª»í•œ ë™ì‘ì„ í”¼í•˜ê¸° ìœ„í•´ ì‚­ì œ ë¡œì§ì—ì„œë„ ì—°ê´€ ê´€ê³„ í¸ì˜ ë©”ì„œë“œë¥¼ ì •ì˜í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì½”ë“œë¥¼ ì˜ ì‘ì„±í•  í•„ìš”ê°€ ìˆì–´ ë³´ì…ë‹ˆë‹¤. \n\n\n## ì°¸ê³  ìë£Œ\n- [[Spring boot] JPA Delete is not Working, ì˜ì†ì„±ì™€ ì—°ê´€ ê´€ê³„ë¥¼ ê³ ë ¤í–ˆëŠ”ê°€.](https://velog.io/@jsb100800/spring-12)  \n- [[jpa] CascadeType.PERSISTë¥¼ í•¨ë¶€ë¡œ ì‚¬ìš©í•˜ë©´ ì•ˆë˜ëŠ” ì´ìœ ](https://joont92.github.io/jpa/CascadeType-PERSIST%EB%A5%BC-%ED%95%A8%EB%B6%80%EB%A1%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%A9%B4-%EC%95%88%EB%90%98%EB%8A%94-%EC%9D%B4%EC%9C%A0/)\n\n"},{"excerpt":"ì´ ê¸€ì€ ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ ê´œì°®ì„ì§€ë„íŒ€ì˜ ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ë°°ê²½ CPU ì½”ì–´ê°€ í•˜ë‚˜ì¸ ì»´í“¨í„°ë¼ë„ ìˆ˜ì‹­ ë˜ëŠ” ìˆ˜ë°± ê°œì˜ ì“°ë ˆë“œë¥¼  ì§€ì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n í•˜ì§€ë§Œ, ì‹¤ì œë¡œ í•˜ë‚˜ì˜ ì½”ì–´ëŠ” í•˜ë‚˜ì˜ ì“°ë ˆë“œë§Œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n ì„ í†µí•´, í•˜ë‚˜ì˜ ì½”ì–´ì—ì„œë„ ì—¬ëŸ¬ ê°œì˜ ì“°ë ˆë“œë¥¼ ë™ì‹œì— ì§€ì›í•  ìˆ˜ ìˆëŠ” ê²ƒì´ì£ . ë¬¼ë¡ , ë‘ ê°œì˜ ì“°ë ˆë“œ A, Bê°€ ì¡´ì¬í•  ë•Œ ì´ë¥¼ ìˆœì°¨ì ìœ¼â€¦","fields":{"slug":"/how-to-hikariCP/"},"frontmatter":{"date":"October 10, 2023","title":"HikariCP ì ìš©ê¸°","tags":["ë°ì´í„°ë² ì´ìŠ¤","HikariCP","ì»¤ë„¥ì…˜ í’€"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ ê´œì°®ì„ì§€ë„íŒ€ì˜ `ì¥¬ë‹ˆ`ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.\n### ë°°ê²½\n\nCPU ì½”ì–´ê°€ í•˜ë‚˜ì¸ ì»´í“¨í„°ë¼ë„ ìˆ˜ì‹­ ë˜ëŠ” ìˆ˜ë°± ê°œì˜ ì“°ë ˆë“œë¥¼ `ë™ì‹œì—` ì§€ì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n<br> í•˜ì§€ë§Œ, ì‹¤ì œë¡œ í•˜ë‚˜ì˜ ì½”ì–´ëŠ” í•˜ë‚˜ì˜ ì“°ë ˆë“œë§Œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n<br> `ì“°ë ˆë“œ ìŠ¤ì¼€ì¤„ë§`ì„ í†µí•´, í•˜ë‚˜ì˜ ì½”ì–´ì—ì„œë„ ì—¬ëŸ¬ ê°œì˜ ì“°ë ˆë“œë¥¼ ë™ì‹œì— ì§€ì›í•  ìˆ˜ ìˆëŠ” ê²ƒì´ì£ .\n\në¬¼ë¡ , ë‘ ê°œì˜ ì“°ë ˆë“œ A, Bê°€ ì¡´ì¬í•  ë•Œ ì´ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ì„±ëŠ¥ì ìœ¼ë¡œëŠ” ë” ë¹ ë¦…ë‹ˆë‹¤.\n<br> `Context Switching Overhead`ê°€ ì—†ê¸° ë•Œë¬¸ì´ì£  !\n\nê·¸ë ‡ë‹¤ë©´, ì–´í”Œë¦¬ì¼€ì´ì…˜ê³¼ ê´€ë ¨ëœ ì“°ë ˆë“œì˜ ê°œìˆ˜ë¥¼ ì„¤ì •í•  ë•Œ, ì½”ì–´ì˜ ê°œìˆ˜ì™€ ë™ì¼í•˜ê²Œ ê°€ì ¸ê°€ë©´ ë ê¹Œìš” ?\n<br> **ê²°ë¡ ë¶€í„° ì´ì•¼ê¸°í•˜ë©´, ê·¸ë ‡ì§€ ì•ŠìŠµë‹ˆë‹¤ !**\n<br> ì‹¤ì œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ìˆëŠ” `ë””ìŠ¤í¬`ë¥¼ ê³ ë ¤í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\n\nì–´í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” ë””ìŠ¤í¬ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.\n<br> ë°ì´í„°ë¥¼ ì½ê¸° ìœ„í•´ì„œëŠ”, ë¬¼ë¦¬ì ì¸ `Disk Armê³¼ Spindle`ì´ ë™ì‘í•©ë‹ˆë‹¤.\n<br> ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì°¾ê¸° ìœ„í•´ ìœ„ì™€ ê°™ì€ ë™ì‘ì„ ìˆ˜í–‰í•˜ë©°, ì´ë•Œ ë“œëŠ” ë¹„ìš©ì€ ìƒë‹¹íˆ í½ë‹ˆë‹¤.\n<br> ì´ ì‹œê°„ì„, `I/O ëŒ€ê¸° ì‹œê°„`ì´ë¼ê³  ë¶€ë¥´ë©°, í•´ë‹¹ ì‹œê°„ ë™ì•ˆ ì“°ë ˆë“œë“¤ì€ `waiting` ìƒíƒœë¡œ ëŒ€ê¸°í•˜ê²Œ ë©ë‹ˆë‹¤.\n\nê·¸ë ‡ê¸° ë•Œë¬¸ì—, I/O ëŒ€ê¸° ì‹œê°„ìœ¼ë¡œ ì¸í•´ waiting ìƒíƒœì¸ ì“°ë ˆë“œê°€ ìƒê¸°ê²Œ ë©ë‹ˆë‹¤.\n<br> ì¦‰, ì¼í•˜ì§€ ì•Šê³  ë†€ê²Œ ë˜ëŠ” ì½”ì–´ê°€ ìƒê¸°ê²Œ ë©ë‹ˆë‹¤.\n\nê·¸ë ‡ë‹¤ë©´, ë°ì´í„°ë² ì´ìŠ¤ Connectionê³¼ ê´€ë ¨ëœ `Thread Pool`ì˜ í¬ê¸°ëŠ” ì–´ëŠ ì •ë„ë¡œ ê´€ë¦¬í•˜ëŠ” ê²Œ ì¢‹ì„ê¹Œìš” ?\n\n### Hikari Connection Pool\n\n`HikariCP` ê³µì‹ ë¬¸ì„œì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ ì¶”ì²œ ê³µì‹ì„ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.\n\n`Connection Pool Size = (Core count * 2) + Effective spindle count`\n\nìœ„ ê³µì‹ì—ì„œ, `Effective spindle count`ì˜ ê°’ì€ ì‚¬ì‹¤ìƒ í•˜ë“œë””ìŠ¤í¬ì˜ ê°œìˆ˜ì™€ ê°™ë‹¤ê³  ë³´ë©´ ë©ë‹ˆë‹¤.\n<br> ë””ìŠ¤í¬ 1ê°œë‹¹, 1ê°œì˜ ë¬¼ë¦¬ì  spindleì„ ê°€ì§€ê³  ìˆê¸° ë•Œë¬¸ì´ì£ .\n\n`ê´œì°®ì„ì§€ë„` ì„œë¹„ìŠ¤ì˜ ìš´ì˜ ì„œë²„ EC2 í™˜ê²½ì€ 2ê°œì˜ ì½”ì–´ì™€ 1ê°œì˜ ë””ìŠ¤í¬ë¥¼ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.\n<br> ì´ë¥¼ ìœ„ ê³µì‹ì— ëŒ€ì…í•´ ë³´ë©´, `Connection Pool Size = 2 * 2 + 1 = 5`\n\n**ì¦‰, `HikariCP`ì—ì„œ ì¶”ì²œí•˜ëŠ” ì»¤ë„¥ì…˜ í’€ ì‚¬ì´ì¦ˆëŠ” 5ê°€ ë‚˜ì˜¤ê²Œ ë©ë‹ˆë‹¤.**\n\n### ì„±ëŠ¥ í…ŒìŠ¤íŠ¸\n`HikariCP`ì—ì„œ ì¶”ì²œí•˜ëŠ” `ê´œì°®ì„ì§€ë„` ì„œë¹„ìŠ¤ì˜ ì»¤ë„¥ì…˜ í’€ ì‚¬ì´ì¦ˆëŠ” `5`ì„ì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n<br> í•˜ì§€ë§Œ, ì´ëŠ” ë‹¨ìˆœíˆ ì´ë¡ ì ì¸ ë‚´ìš©ì¼ ë¿ ë§¹ì‹ í•  ìˆ˜ëŠ” ì—†ìŠµë‹ˆë‹¤.\n<br> ê·¸ë˜ì„œ, `JMETER`ë¥¼ ì´ìš©í•œ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.\n<br> í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ë‹¤ë¥¸ ì„¤ì •ì„ ë™ì¼í•˜ê²Œ ë‘ê³ , ì»¤ë„¥ì…˜ í’€ ì‚¬ì´ì¦ˆë§Œ ë³€ê²½í•˜ë©° ì§„í–‰í–ˆìŠµë‹ˆë‹¤.\n\nConnection Pool SizeëŠ” ì•„ë˜ì™€ ê°™ì´ yml íŒŒì¼ì„ ì‘ì„±í•˜ì—¬ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n```yaml\nspring:\n  datasource:\n    hikari:\n      maximum-pool-size: 5\n```\n\n**- Connection Pool Size 10**\n<br> ê¸°ë³¸ ì„¤ì •ê°’ì¸ 10ìœ¼ë¡œ ì„¤ì •í•œ ë’¤, í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.\n![connection_pool_size_10.png](.index_image/connection_pool_size_10.png)\n\n**- Connection Pool Size 5**\n<br> HikariCPì—ì„œ ì œê³µí•˜ëŠ” ê³µì‹ì„ í†µí•´ ë„ì¶œëœ ê°’ìœ¼ë¡œ ì„¤ì •í•œ ë’¤, í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.\n![connection_pool_size_5.png](.index_image/connection_pool_size_5.png)\n\nìœ ì˜ë¯¸í•œ TPS ì°¨ì´ë¥¼ í†µí•´, ì»¤ë„¥ì…˜ í’€ ì‚¬ì´ì¦ˆê°€ 5ì¼ ë•Œì˜ ì„±ëŠ¥ì´ ì¢‹ë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n<br> ë¬¼ë¡ , íŠ¸ë˜í”½ ì–‘ì— ë”°ë¼, ë‹¤ë¥¸ ê°’ì„ ì ìš©í•˜ì˜€ì„ ë•Œê°€ ë” ìµœì ì˜ ì„±ëŠ¥ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n`ê´œì°®ì„ì§€ë„` ì„œë¹„ìŠ¤ì—ì„œëŠ” ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ëª©í‘œì¹˜ëŸ‰ì„ ê¸°ì¤€ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì˜€ê¸° ë•Œë¬¸ì—, ìœ„ì™€ ê°™ì€ ê²°ê³¼ê°€ ë„ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.\n\n### ë§ˆì¹˜ë©°\n**ìœ„ì—ì„œë„ ì´ì•¼ê¸°í–ˆì§€ë§Œ, ê³µì‹ì„ í†µí•´ ë„ì¶œëœ ê°’ì´ í•­ìƒ ìµœì ì¸ ê²ƒì€ ì•„ë‹™ë‹ˆë‹¤.**\n<br>**ê° ì„œë¹„ìŠ¤ì˜ íŠ¹ì„±ì— ë§ê²Œ, ì»¤ë„¥ì…˜ í’€ ì‚¬ì´ì¦ˆë¥¼ ì„¤ì •í•´ ë³´ì‹œë©´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ì—¬ ìµœì ì˜ ê°’ì„ ë„ì¶œí•´ ë‚´ì‹œê¸¸ ë°”ëë‹ˆë‹¤.**\n\në˜í•œ, ì»¤ë„¥ì…˜ í’€ ì™¸ì—ë„ HikariCPì—ì„œ íŠœë‹í•´ì•¼í•  ì„¤ì •ì„ ì¶”ì²œí•˜ê³  ìˆìŠµë‹ˆë‹¤.\n<br> ì´ ë¶€ë¶„ë„ [ì°¸ê³ ](https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration)í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.\n\n### ì°¸ê³ \n[HikariCP docs](https://github.com/brettwooldridge/HikariCP/wiki/About-Pool-Sizing)\n<br>[HikariCP MySQL Configuration](https://github.com/brettwooldridge/HikariCP/wiki/MySQL-Configuration)\n"},{"excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„íŒ€ì˜ ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. N+1ê³¼ Fetch join ë°±ì—”ë“œì—ì„œëŠ” ì¡°íšŒ APIë¡œ ì—¬ëŸ¬ ì—°ê´€ ê´€ê³„ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” N+1 ë¬¸ì œë¥¼ í•´ê²°í•´ì•¼ í–ˆëŠ”ë°ìš”. ì˜ˆë¥¼ ë“¤ë©´ ì¥ì†Œ(ì´í•˜ í•€) ë‹¤ê±´ ì¡°íšŒì˜ ê²½ìš°, ê° í•€ì´ ì†í•œ ì§€ë„(topic), ìœ„ì¹˜, ìƒì„±ì, í•€ ì´ë¯¸ì§€ë“¤ì„ ëª¨ë‘ ë³„ë„ë¡œ ì¡°íšŒí•˜ëŠ” ì‹¬ê°í•œ ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤. ì§€ë„(topic) ì¡°íšŒ ì‹œì—â€¦","fields":{"slug":"/jpa-multibag-fetch-exception/"},"frontmatter":{"date":"October 04, 2023","title":"Fetch join ì‚¬ìš© ì‹œ MultipleBagFetchExceptionì˜ ë°œìƒ ì´ìœ ì™€ í•´ê²° ë°©ë²•","tags":["Spring Data JPA","Hibernate","JPQL","íŠ¸ëŸ¬ë¸”ìŠˆíŒ…"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„íŒ€ì˜ `ë„ì´`ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.\n\n## N+1ê³¼ Fetch join\n\në°±ì—”ë“œì—ì„œëŠ” ì¡°íšŒ APIë¡œ ì—¬ëŸ¬ ì—°ê´€ ê´€ê³„ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” N+1 ë¬¸ì œë¥¼ í•´ê²°í•´ì•¼ í–ˆëŠ”ë°ìš”.  \nì˜ˆë¥¼ ë“¤ë©´ ì¥ì†Œ(ì´í•˜ í•€) ë‹¤ê±´ ì¡°íšŒì˜ ê²½ìš°, ê° í•€ì´ ì†í•œ ì§€ë„(topic), ìœ„ì¹˜, ìƒì„±ì, í•€ ì´ë¯¸ì§€ë“¤ì„ ëª¨ë‘ ë³„ë„ë¡œ ì¡°íšŒí•˜ëŠ” ì‹¬ê°í•œ ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.  \nì§€ë„(topic) ì¡°íšŒ ì‹œì—ë„ ìƒì„±ì, ê¶Œí•œ ì •ë³´, ì¦ê²¨ì°¾ê¸° ëª©ë¡ì„ ë§¤ë²ˆ ë¶ˆëŸ¬ì™”ê³ ìš”.   \n\n![img.png](.index_image/img.png)\n\në”°ë¼ì„œ í•¨ê»˜ ê°€ì ¸ì˜¬ ì—°ê´€ ê´€ê³„ë“¤ì— ëŒ€í•´ `Fetch join`ì„ ì ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¬¸ì œì— ì ‘ê·¼í–ˆìŠµë‹ˆë‹¤.  \n\n> `Fetch join`ì€ JPQLì—ì„œ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.  \n\n### @EntityGraph\n`Fetch join`ì„ ìœ„í•œ ë°©ë²•ìœ¼ë¡œëŠ”, `@EntityGraph`ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤.  \nJPQLì— ì§ì ‘ í•˜ë“œì½”ë”©ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ê²ƒë³´ë‹¤, ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„±ì— ë” ì¢‹ë‹¤ê³  íŒë‹¨í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.\n\n`@EntityGraph`ëŠ”, ê°ì²´ë¥¼ ë¡œë”©í•  ë•Œ ëŸ°íƒ€ì„ ì„±ëŠ¥ì„ ê°œì„ í•˜ê¸° ìœ„í•´ JPA 2.1ì—ì„œ ë„ì…ëœ ê¸°ëŠ¥ì…ë‹ˆë‹¤.  \nJPA 2.0 ì´ì „ê¹Œì§€ëŠ” `FetchType`ìœ¼ë¡œë§Œ ë¡œë”© ì „ëµì„ ì§€ì •í•  ìˆ˜ ìˆì—ˆì§€ë§Œ   \nì´ë¥¼ í†µí•´ ê°ì²´ì˜ ì—°ê´€ ê´€ê³„ ì¤‘ ê·¸ë˜í”„ë¡œ ì—°ê²°í•  ê²ƒë“¤ì„ í…œí”Œë¦¿ìœ¼ë¡œ ì •ì˜í•˜ê³ , ëŸ°íƒ€ì„ì— ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  \nì›í•˜ëŠ” í•„ë“œë“¤ë§Œ ì‰½ê²Œ Fetch join ì‹œí‚¬ ìˆ˜ ìˆëŠ” ê²ƒì´ì£ .\n\n```java\n// PinRepository.class\n// í•´ë‹¹ ì¿¼ë¦¬ë¡œ ë°ì´í„°ë¥¼ ì½ì„ ë•Œ, Topicì˜ í•„ë“œë¡œ ì¡´ì¬í•˜ëŠ” \"location\", \"topic\", \"creator\", \"pinImages\"ë¥¼ Fetch joinìœ¼ë¡œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.\n@EntityGraph(attributePaths = {\"location\", \"topic\", \"creator\", \"pinImages\"})\nList<Pin> findAllByCreatorId();\n```\n\n## ë¬¸ì œ ìƒí™©\n`@EntityGraph`ëŠ” ë™ì ìœ¼ë¡œ ìƒì„±ë˜ë¯€ë¡œ  \ní•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì— ì‘ì„±í•œ ì„¤ì •ì´ ì˜ëª» ë˜ì—ˆì–´ë„, ì»´íŒŒì¼ íƒ€ì„ì´ ì•„ë‹ˆë¼ í•´ë‹¹ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ëŸ°íƒ€ì„ ì‹œì ì— ì˜ˆì™¸ê°€ ë°œìƒí•©ë‹ˆë‹¤.  \n\nì—¬ëŸ¬ í•„ë“œë“¤ì„ `attributePaths`ì— ë„£ì–´ë³¸ ë’¤, ë¡œì»¬ í™˜ê²½ì—ì„œ APIë¥¼ í˜¸ì¶œí•˜ë©° ì¿¼ë¦¬ ê°œìˆ˜ ë° ì§€ì—° ì‹œê°„ì„ í™•ì¸í•˜ë˜ ì¤‘  \nì•„ë˜ì™€ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n```\norg.hibernate.loader.MultipleBagFetchException: cannot simultaneously fetch multiple bags: \n[com.mapbefine.mapbefine.topic.domain.Topic.bookmarks, com.mapbefine.mapbefine.topic.domain.Topic.permissions]\n```\n\ní˜¸ì¶œëœ ì¿¼ë¦¬ëŠ” ì•„ë˜ì™€ ê°™ì•˜ìŠµë‹ˆë‹¤.\n```java\n// TopicRepository.class\n@EntityGraph(attributePaths = {\"creator\", \"permissions\", \"bookmarks\"})\nList<Topic> findAll();\n```\n\n## MultipleBagFetchExceptionì˜ ë°œìƒ ì´ìœ \nê°„ë‹¨í•˜ê²Œ ì´ì•¼ê¸°í•˜ë©´ **`OneToMany` ê´€ê³„ë¥¼ 1ê°œë³´ë‹¤ ë” ë§ì´ Fetch join** í•˜ë ¤ê³  í–ˆê¸° ë•Œë¬¸ì— ë°œìƒí•œ ë¬¸ì œì…ë‹ˆë‹¤.  \n\"permissons\"ì™€ \"bookmarks\"ë¥¼ ë™ì‹œì— Fetch joiní•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n### Fetch joinê³¼ ì¹´í…Œì‹œì•ˆ ê³±\nFetch joinì€ `*ToOne` ê´€ê³„ì—ëŠ” ê°œìˆ˜ ì œí•œì´ ì—†ì§€ë§Œ, `*ToMany` ê´€ê³„ë¥¼ 1ê°œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  \nfech joinì„ ì—¬ëŸ¬ ê°œì˜ ì»¬ë ‰ì…˜ì— ì ìš©í•œë‹¤ë©´, ì¹´í…Œì‹œì•ˆ ê³±ì— ì˜í•´ ì¤‘ë³µ ë°ì´í„°ê°€ ë°œìƒí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.  \nHibernateì€ ì´ì— ëŒ€í•´ `MultipleBagFetchException` ì˜ˆì™¸ë¥¼ ë˜ì ¸ í•´ë‹¹ ìƒí™© ìì²´ë¥¼ ë§‰ìŠµë‹ˆë‹¤.  \n\në¬¼ë¡  í•˜ë‚˜ì˜ `OneToMany`ë¥¼ Fetch join í•´ë„ join ëŒ€ìƒì¸ ì—”í‹°í‹° ê¸°ì¤€ìœ¼ë¡œëŠ” ì¤‘ë³µì´ ë°œìƒí•©ë‹ˆë‹¤.  \ní•˜ì§€ë§Œ ì´ì— ëŒ€í•´ì„œëŠ” JPQLì—ì„œ ì§€ì›í•˜ëŠ” distinctë¥¼ ì‚¬ìš©í•´ ì—”í‹°í‹°ì˜ ì¤‘ë³µì„ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  \n\n> `Bag`ì€ Hibernate ìš©ì–´ë¡œ, Setê³¼ ê°™ì´ ìˆœì„œê°€ ì—†ê³  Listì™€ ê°™ì´ ì¤‘ë³µì„ í—ˆìš©í•˜ëŠ” ìë£Œêµ¬ì¡°ì…ë‹ˆë‹¤.  \n> ê·¸ëŸ¬ë‚˜ Java Collection APIì—ëŠ” ìœ„ì™€ ê°™ì€ ê°œë…ì˜ ìë£Œêµ¬ì¡°ê°€ ì—†ê¸° ë•Œë¬¸ì—, Listë¥¼ Bagìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.  \n> List ë¡œ ì´ˆê¸°í™”í•œ ê²½ìš°, PersistentBag ì´ë¼ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤.   \n> ë°˜ë©´ Set ìœ¼ë¡œ ì´ˆê¸°í™”í•œ ê²½ìš°, PersistentSet ì´ë¼ëŠ” ì¸ìŠ¤í„´ìŠ¤ë¡œ ë§¤í•‘ë©ë‹ˆë‹¤.\n\n\n## í•´ê²° ë°©ë²•\nì•ì„œ ë°œìƒí•œ ìƒí™©ì˜ ê²½ìš°,  \nì¦ê²¨ì°¾ê¸° ê°œìˆ˜ì— ëŒ€í•œ ì—­ì •ê·œí™”ë¡œ ì¸í•´ \"bookmarks\"ì˜ Fetch joinì´ í•„ìš”ê°€ ì—†ì–´ì§€ë©´ì„œ ë¬¸ì œ ìì²´ê°€ ì‚¬ë¼ì¡ŒìŠµë‹ˆë‹¤.  \ní•˜ì§€ë§Œ í•´ë‹¹ ì˜ˆì™¸ì— ëŒ€í•œ í•´ê²° ë°©ë²•ê³¼, ì´ëŸ¬í•œ ë¬¸ì œë¥¼ íšŒí”¼í•˜ë©´ì„œ ì„±ëŠ¥ì„ ê°œì„ í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì•Œì•„ë‘ë©´ ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤.   \n\në¨¼ì € í•´ë‹¹ ì˜ˆì™¸ì— ëŒ€í•œ ë‹¨ìˆœ í•´ê²° ë°©ë²•ìœ¼ë¡œëŠ” ì•„ë˜ì™€ ê°™ì€ ê²ƒì´ ìˆìŠµë‹ˆë‹¤.   \n### 1. ìë£Œí˜•ì„ Setìœ¼ë¡œ ë³€ê²½\nSetì€ ì¤‘ë³µì„ í—ˆìš©í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ ê²½ìš° ì—¬ëŸ¬ ê°œì˜ `*ToMany`ë¥¼ í—ˆìš©í•´ì¤ë‹ˆë‹¤.  \ní•˜ì§€ë§Œ ìˆœì„œë¥¼ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.  \n\n> ì´ë¡œ ì¸í•´ í™”ë©´ ìƒ ë³´ì´ëŠ” ì§€ë„ ëª©ë¡ ìˆœì„œê°€ ë§¤ë²ˆ ë°”ë€ŒëŠ” ë¬¸ì œë¥¼ ê²ªê¸°ë„ í–ˆìŠµë‹ˆë‹¤.  \n> Hibernateì—ì„œëŠ” DBì—ì„œ ì½ì–´ì˜¨ ë°ì´í„°ë¥¼ ì €ì¥í•  ë•Œ,  \n> Listì™€ ë‹¬ë¦¬ Setì— ëŒ€í•´ì„œëŠ” ìˆœì„œ ë³´ì¥ì„ ì§€ì›í•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— LinkedHashSetìœ¼ë¡œë„ ì†Œìš©ì´ ì—†ì—ˆìŠµë‹ˆë‹¤.\n\n### 2. ìì‹ ì—”í‹°í‹° ì¤‘ í•˜ë‚˜ì—ë§Œ Fetch joinì„ ê±¸ê³ , ë‚˜ë¨¸ì§€ëŠ” Lazy loading\ní•´ë‹¹ ì˜ˆì™¸ë¥¼ í”¼í•˜ëŠ” ë°©ë²•ì´ê¸´ í•˜ì§€ë§Œ, ê¸°ì¡´ì— ëª©í‘œë¡œ ì‚¼ë˜ ì„±ëŠ¥ ê°œì„ ê³¼ëŠ” ê±°ë¦¬ê°€ ë©€ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.   \n\nê·¸ ì™¸ì—ë„ Fetch join ì¿¼ë¦¬ë¥¼ ë‚˜ëˆ„ì–´ ì‹¤í–‰í•˜ê±°ë‚˜, ì¿¼ë¦¬ë¥¼ ì—¬ëŸ¬ ê°œë¡œ ë‚˜ëˆ„ì—ˆë‹¤ ì¡°ë¦½í•˜ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤.  \n**í•˜ì§€ë§Œ ê²°êµ­ ì›í•˜ëŠ” ê±´ ì¿¼ë¦¬ì˜ ìˆ˜ë¥¼ ì¤„ì´ê³  ì„±ëŠ¥ì„ ê°œì„ í•˜ëŠ” ê²ƒì¸ë°, ê°„ë‹¨í•˜ê³  ì¢‹ì€ ë°©ë²• ì—†ì„ê¹Œìš”? ğŸ¤”**\n\n### 3. default_batch_fetch_size ì„¤ì •\në¶ˆê°€í”¼í•˜ê²Œ ì—¬ëŸ¬ ê°œì˜ `*ToMany`ë¥¼ Fetch join í•´ì•¼ í•  ê²½ìš°,  \n2ë²ˆ ë°©ë²•ì„ ì ìš©í•˜ë˜ ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ Lazy loadingìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ì¿¼ë¦¬ë„ íšê¸°ì ìœ¼ë¡œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nHibernateì˜ `default_batch_fetch_size` ì„¤ì •ì„ ë°”ê¾¸ë©´ ì—¬ëŸ¬ ê°œì˜ `*ToMany`ë¥¼ ì‚¬ìš©í•˜ê³ ë„ N+1 ë¬¸ì œë¥¼ íšŒí”¼í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.    \nìì‹ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•ŒëŠ”, ì™¸ë˜í‚¤ë¥¼ ì‚¬ìš©í•´ ì•„ë˜ì™€ ê°™ì€ ì¿¼ë¦¬ê°€ ë‚˜ê°‘ë‹ˆë‹¤.\n\n```sql\nselect * from permission where topic_id = 1;\nselect * from permission where topic_id = 2;\n// ... ì¡°íšŒí•  ëª¨ë“  í† í”½ì— ëŒ€í•´ ì¿¼ë¦¬ ë°œìƒ\nselect * from bookmark where topic_id = 1;\nselect * from bookmark where topic_id = 2;\n// ... ì¡°íšŒí•  í† í”½ì— ëŒ€í•´ ì¿¼ë¦¬ ë°œìƒ\n```\n\ní•˜ì§€ë§Œ í•´ë‹¹ ì˜µì…˜ì€ ì§€ì •ëœ ìˆ˜(size) ë§Œí¼, in ì ˆì— ë¶€ëª¨ keyë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ìì‹ ì—”í‹°í‹°ë“¤ì„ ì¡°íšŒí•˜ë„ë¡ ë°”ê¿”ì¤ë‹ˆë‹¤.  \nì¡°íšŒí•˜ëŠ” topic ê°œìˆ˜ ë§Œí¼ ë‚˜ê°€ë˜ ì¿¼ë¦¬ë¥¼ ê° 1ë²ˆì”©ìœ¼ë¡œ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n```sql\nselect * from permission where topic_id in (1, 2, 3, ...);\nselect * from bookmark where topic_id in (1, 2, 3, ...);\n```\n\n\n## ì°¸ê³  ìë£Œ\n- https://www.baeldung.com/jpa-entity-graph\n- https://www.baeldung.com/java-hibernate-multiplebagfetchexception\n- https://docs.spring.io/spring-data/data-jpa/docs/current/api/org/springframework/data/jpa/repository/EntityGraph.html\n- https://jojoldu.tistory.com/457?fbclid=IwAR132BRMYHrL4D5Pu25YUglIcEN1FGTE2tacFcsVOPAT0MAzwoMX6Flzbe0\n- https://devlog-wjdrbs96.tistory.com/421\n"},{"excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„ì˜ ê°€ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ë°°ê²½ ì¿¼ë¦¬ ê°œì„ ... í•„ìš”í• ì§€ë„? 9ì›” ë§, ì¶”ì„ì„ ì•ë‘ê³  ì‚¬ìš©ì ìœ ì¹˜ ê³„íš ì‹¤í–‰ì„ ì•ë‘ê³  ìˆì—ˆë‹¤. ìš°ë¦¬ëŠ” í–‰ë³µíšŒë¡œë¥¼ ëŒë¦¬ë©°, ë§ì€ ì‚¬ìš©ìë“¤ì´ ì„œë¹„ìŠ¤ì— ë“¤ì–´ì˜¬ ê²ƒì´ë¼ê³  ìƒê°í–ˆê³ , ì‚¬ìš©ìë“¤ì—ê²Œ ì¢‹ì€ ê²½í—˜ì„ ì„ ì‚¬í•˜ê³  ì‹¶ì—ˆë‹¤. í•˜ì§€ë§Œ, ë¬¸ì œê°€ ìˆì—ˆë‹¤. ë§ì€ ì‚¬ìš©ìê°€ ë“¤ì–´ì˜´ì— ë”°ë¼ í‰ì†Œë³´ë‹¤ ë§ì€ íŠ¸ë˜í”½ì´ ë°œìƒí•  ê²ƒâ€¦","fields":{"slug":"/trouble-shooting-fetch-type/"},"frontmatter":{"date":"October 04, 2023","title":"FetchType.EAGER, FetchType.LAZY ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì!","tags":["Spring Data JPA","JPQL"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„ì˜ `ë§¤íŠœ`ê°€ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n## ë°°ê²½\n\n### ì¿¼ë¦¬ ê°œì„ ... í•„ìš”í• ì§€ë„?\n\n9ì›” ë§, ì¶”ì„ì„ ì•ë‘ê³  ì‚¬ìš©ì ìœ ì¹˜ ê³„íš ì‹¤í–‰ì„ ì•ë‘ê³  ìˆì—ˆë‹¤.\n\nìš°ë¦¬ëŠ” í–‰ë³µíšŒë¡œë¥¼ ëŒë¦¬ë©°, ë§ì€ ì‚¬ìš©ìë“¤ì´ ì„œë¹„ìŠ¤ì— ë“¤ì–´ì˜¬ ê²ƒì´ë¼ê³  ìƒê°í–ˆê³ , ì‚¬ìš©ìë“¤ì—ê²Œ ì¢‹ì€ ê²½í—˜ì„ ì„ ì‚¬í•˜ê³  ì‹¶ì—ˆë‹¤.\n\ní•˜ì§€ë§Œ, ë¬¸ì œê°€ ìˆì—ˆë‹¤.\n\në§ì€ ì‚¬ìš©ìê°€ ë“¤ì–´ì˜´ì— ë”°ë¼ í‰ì†Œë³´ë‹¤ ë§ì€ íŠ¸ë˜í”½ì´ ë°œìƒí•  ê²ƒì´ê³ , ì¡°ê¸ˆ ë” ì¢‹ì€ ê²½í—˜ì„ ì œê³µí•˜ê¸° ìœ„í•´ ì¶”ê°€í•œ ì§€ë„ì™€ í•€ìœ¼ë¡œ ì¸í•´ ë°ì´í„°ëŠ” ë°©ëŒ€í•´ì¡Œë‹¤. \n\nìì¹«í•˜ë©´ ì‚¬ìš©ìì—ê²Œ ì¢‹ì§€ ì•Šì€ ê²½í—˜ì„ ì„ ì‚¬í•  ìˆ˜ ìˆë‹¤ëŠ” ìƒê°ì— ì„±ëŠ¥ ê°œì„ ì„ ëª©í‘œë¡œ ì‚¼ì•˜ë‹¤.\n\në•Œë¬¸ì— ìš°ë¦¬ëŠ” í˜„ì¬ ë°œìƒí•˜ê³  ìˆëŠ” `N + 1` ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ , `ì¸ë±ìŠ¤`ë¥¼ í™œìš©í•˜ì—¬ ë¹ ë¥¸ ì„±ëŠ¥ ê°œì„ ì„ ê³„íší–ˆë‹¤.\n\nê·¸ ì¤‘ì—ì„œ `N + 1` ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ê³¼ì • ì¤‘ì— í•´ë‹¹ ê¸€ì„ ì‘ì„±í•˜ê²Œ ëœ ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ë‹¤.\n\n### ë¬¸ì œ ìƒí™©\n\nìœ ì €ê°€ `ì§€ë„` ëª©ë¡ì„ ì¡°íšŒí•˜ë ¤ëŠ” ê²½ìš° ë¹„ì •ìƒì ìœ¼ë¡œ ì¿¼ë¦¬ê°€ ë§ì´ë‚˜ê°”ë‹¤.\n\nì‰½ê²Œ ì˜ˆìƒí•  ìˆ˜ ìˆë“¯ ë‹¹ì—°íˆ `N + 1` ë¬¸ì œì˜€ë‹¤.\n\nìš°ë¦¬ëŠ” í•´ë‹¹ `N + 1` ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ `fetch join` ì„ ì‚¬ìš©í–ˆë‹¤.\n\n### N + 1 ì„ í•´ê²°í•´ë³´ì!\n\n- Topic Entity êµ¬ì¡° (`ì§€ë„ == Topic`)\n```java\n@Entity  \n@NoArgsConstructor(access = PROTECTED)  \n@Getter  \npublic class Topic extends BaseTimeEntity {  \n  \n    @Id  \n    @GeneratedValue(strategy = GenerationType.IDENTITY)  \n    private Long id;  \n\n\t... ìƒëµ\n  \n    @ManyToOne  \n    @JoinColumn(name = \"member_id\")  \n    private Member creator;  \n  \n    @OneToMany(mappedBy = \"topic\")  \n    private List<Permission> permissions = new ArrayList<>();  \n  \n    @OneToMany(mappedBy = \"topic\", cascade = CascadeType.PERSIST)  \n    private List<Pin> pins = new ArrayList<>();  \n  \n    @OneToMany(mappedBy = \"topic\", cascade = CascadeType.PERSIST, orphanRemoval = true)  \n    private List<Bookmark> bookmarks = new ArrayList<>();  \n  \n    @Column(nullable = false)  \n    @ColumnDefault(value = \"0\")  \n    private int pinCount = 0;  \n  \n    @Column(nullable = false)  \n    @ColumnDefault(value = \"0\")  \n    private int bookmarkCount = 0;  \n\n\t... ìƒëµ\n\n}\n```\n\n- Topic Repository \n```java\n@Repository  \npublic interface TopicRepository extends JpaRepository<Topic, Long> {  \n  \n    @EntityGraph(attributePaths = {\"permissions\"})  \n    List<Topic> findAll();\n\n\t... ìƒëµ\n}\n```\n\nì•ì„  `Entity`, `Repository` ëŠ” `ì§€ë„` ëª©ë¡ì„ ì¡°íšŒí•  ë•Œ ì‚¬ìš©ëœ `Entity` ë° `Repository` ì´ë‹¤.\n\në§ˆì§€ë§‰ìœ¼ë¡œ `Topic` ì— í•„ìš”í•œ ì •ë³´ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.\n\n- Topic Response\n```json\n{  \n  \"id\" : 1,  \n  \"name\" : \"í† í”½ ì´ë¦„\",  \n  \"image\" : \"í† í”½ ì´ë¯¸ì§€ ë§í¬\",  \n  \"creator\" : \"í† í”½ì„ ë§Œë“ ì\",  \n  \"pinCount\" : 3,  \n  \"bookmarkCount\" : 5,  \n  \"updatedAt\" : \"2023-10-02T18:00:55.95188832\"  \n}\n```\n\nì—¬ê¸°ì„œ ì‚¬ìš©ìì—ê²Œ `Topic` ëª©ë¡ì„ ì œê³µí•˜ê¸° ìœ„í•´ ë¶€ìˆ˜ì ìœ¼ë¡œ í•„ìš”í•œ `Entity` ëŠ” `Member` , `Permission` ì´ì—ˆë‹¤.\n\nìœ„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯, `Member` ëŠ” `@ManyToOne ê¸°ë³¸ fetch ì„¤ì •`ìœ¼ë¡œ ì¸í•´ `FetchType.EAGER` ë¡œ ì„¤ì •ë˜ê³ , `Permission` ì€ `@OneToMany ê¸°ë³¸ fetch ì„¤ì •` ì¸ `FetchType.LAZY` ì´ì§€ë§Œ, `@EntityGraph` ë¥¼ í†µí•´ì„œ `fetch join` ì„ í•´ì£¼ì—ˆê¸° ë•Œë¬¸ì— ë‹¹ì—°íˆ ì¿¼ë¦¬ëŠ” í•œë²ˆë§Œ ë‚˜ê°ˆ ì¤„ ì•Œì•˜ë‹¤.\n\ní•˜ì§€ë§Œ, ê²°ê³¼ëŠ”....\n\n```text\n// ë°ì´í„° 10ë§Œê°œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰ë˜ì—ˆìŒ\n[http-nio-8080-exec-2] 16496 INFO  com.mapbefine.mapbefine.common.filter.LatencyLoggingFilter - Latency : 4.649s, Query count : 8, Request URI : /topics\n```\n\nìœ„ì™€ ê°™ì•˜ê³ , ìš°ë¦¬ëŠ” ë©˜ë¶•ì´ ì˜¬ ìˆ˜ ë°–ì— ì—†ì—ˆë‹¤.\n\nìš°ë¦¬ ì˜ˆìƒëŒ€ë¡œë¼ë©´ ë¶„ëª…íˆ `Query Count` ê°€ `1`ì´ì–´ì•¼ í•˜ëŠ”ë°??\n\në„ëŒ€ì²´ ì™œ ?? ã… ã… ã… \n\n### í•´ê²°í–ˆëŠ”ë° ì´ìœ ë¥¼ ëª¨ë¥´ê² ì–´\n\në‹¤ë¥¸ ë¬¸ì œë“¤ë„ ë§ì€ë°, í•´ë‹¹ ë¬¸ì œê¹Œì§€ ë°œìƒí•˜ì—¬ ëª‡ ì‹œê°„ ë™ì•ˆ ê³¨ë¨¸ë¦¬ë¥¼ ì•“ì•˜ë‹¤.\n\nê·¸ëŸ¬ë‹¤ ì¡°ê¸ˆì˜ ì‹œê°„ì´ í˜ë €ê³ , ë§ˆìŒì„ ê°€ë‹¤ë“¬ê³  ì²œì²œíˆ ì¿¼ë¦¬ë¥¼ ëœ¯ì–´ë³´ê¸° ì‹œì‘í–ˆê³ , ì›ì¸ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤.\n\n```sql\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        topic t1_0 \n    left join\n        permission p1_0 \n            on t1_0.id=p1_0.topic_id\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        member m1_0 \n    where\n        m1_0.id=?\n\n\t... 7 ë²ˆì„ member ë¥¼ ì°¾ì•„ì˜´\n```\n\nìš°ë¦¬ëŠ” `@ManyToOne` ì˜ `ê¸°ë³¸ fetch ì„¤ì •`ì¸ `FetchType.EAGER` ë¡œ ì¸í•´ `Member` ë¥¼ `join` ì„ í†µí•´ ê°€ì ¸ì˜¬ ê²ƒì´ë¼ê³  ìƒê°í–ˆì§€ë§Œ, ì‹¤ìƒì€ `Topic` ì„ ê°€ì ¸ì˜¬ ë•Œ `permission` ì€ `join`ì„ ì˜í•´ì„œ ê°€ì ¸ì˜¤ì§€ë§Œ, `member` ëŠ” `select ì¿¼ë¦¬`ë¥¼ í†µí•´ ë”°ë¡œ ê°€ì ¸ì˜¤ê³  ìˆì—ˆë‹¤.\n\nì´ë¡œ ì¸í•´ì„œ `Query Count` ê°€ `1`ì´ ì•„ë‹ˆì—ˆë˜ ê²ƒì´ì—ˆë‹¤.\n\n```java\n@EntityGraph(attributePaths = {\"creator\", \"permissions\"})  \nList<Topic> findAll();\n```\n\ní•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, ìœ„ì™€ ê°™ì´ `attributePaths` ì— `creator` ë¥¼ ì¶”ê°€í•´ì£¼ì—ˆë”ë‹ˆ\n\n```text\n[http-nio-8080-exec-5] 16826 INFO  com.mapbefine.mapbefine.common.filter.LatencyLoggingFilter - Latency : 5.941s, Query count : 1, Request URI : /topics\n```\n\në“œë””ì–´ `Query Count` ë¥¼ `1`ë¡œ ë§Œë“¤ ìˆ˜ ìˆì—ˆë‹¤.\n\në„ëŒ€ì²´ ì™œ ê·¸ëŸ°ê±¸ê¹Œ???\n\nì°¨ê·¼ì°¨ê·¼ ì•Œì•„ê°€ë³´ì!\n\n## ManyToOne í…ŒìŠ¤íŠ¸\n\n### í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ì„œ ìƒê°ì„ êµ³í˜€ë³´ì!\n\nì¼ë‹¨ ì´ì „ ìƒí™©ë“¤ë¡œ ë¯¸ë£¨ì–´ ë³´ì•˜ì„ ë•Œ, `Eager` ì™€ `Lazy` ëŠ” ë‹¨ìˆœ `select ì‹œê¸°`ë¥¼ `ê²°ì •`í•˜ëŠ” ê²ƒ ê°™ë‹¤.\n\nê·¸ë ‡ê¸° ë•Œë¬¸ì—, `Eager` ë¡œ ì„¤ì •í•˜ë“  `Lazy` ë¡œ ì„¤ì •í•˜ë“ , ë”°ë¡œ `select` ì¿¼ë¦¬ë¥¼ í†µí•´ì„œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì´ë‹¤.\n\nì´ë¥¼ ì¦ëª…í•˜ê¸° ìœ„í•´ ëª‡ ê°€ì§€ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ë³´ì.\n\n`@ManyToOne` ì„ ì§„í–‰í•˜ê¸° ìœ„í•´ `ëŒ€ìƒ Entity` ë¥¼ ì •í•˜ê³  `Test` í•˜ê¸° ìœ„í•œ `í…ŒìŠ¤íŠ¸ ì½”ë“œ`ë¥¼ ì§œë³´ì!\n\n- Permission (@ManyToOne ì»¬ëŸ¼ë°–ì— ì—†ì–´ì„œ ë”± í…ŒìŠ¤íŠ¸í•˜ê¸° ì¢‹ì€ Entity Class ë¼ê³  íŒë‹¨)\n\n```java\n@Entity  \n@NoArgsConstructor(access = PROTECTED)  \n@Getter  \npublic class Permission extends BaseTimeEntity {  \n  \n    @Id  \n    @GeneratedValue(strategy = GenerationType.IDENTITY)  \n    private Long id;  \n  \n    @ManyToOne // ì—¬ê¸°ì„œ Eager or Lazy ë¡œ ì§„í–‰í•  ê²ƒ \n    @JoinColumn(name = \"topic_id\", nullable = false)  \n    private Topic topic;  \n  \n    @ManyToOne  \n    @JoinColumn(name = \"member_id\", nullable = false)  \n    private Member member;\n\n}\n```\n\n- ManyToOne ì„ í…ŒìŠ¤íŠ¸ í•˜ê¸° ìœ„í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œ\n\n```java\n@ServiceTest  \nclass TestClass {\n  \n    @Autowired  \n    private TopicRepository topicRepository;  \n  \n    @Autowired  \n    private MemberRepository memberRepository;  \n  \n    @Autowired  \n    private PermissionRepository permissionRepository;  \n  \n    @Autowired  \n    private TestEntityManager testEntityManager;  \n  \n    private Member member;  \n    private Topic topic;  \n    private Permission permission;  \n  \n    @BeforeEach  \n    void beforeEach() {  \n        // ë©¤ë²„ë¥¼ ì €ì¥í•œë‹¤.  \n        member = memberRepository.save(MemberFixture.create(\"member\", \"member@naver.com\", Role.USER));  \n        // í† í”½ì„ ì €ì¥í•œë‹¤.  \n        topic = topicRepository.save(TopicFixture.createPublicAndAllMembersTopic(member));  \n        // ê¶Œí•œì„ ì €ì¥í•œë‹¤.  \n        permission = permissionRepository.save(Permission.createPermissionAssociatedWithTopicAndMember(topic, member));  \n  \n        // ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™” (ì´ˆê¸°í™” ì•ˆí•˜ë©´ findById ë•Œ ì¿¼ë¦¬ê°€ ì•ˆ ë‚ ë¼ê°)\n        testEntityManager.clear();  \n    }  \n  \n    @Test  \n    void permissionManyToOneFindById() {  \n        Permission permissionByFindById = permissionRepository.findById(permission.getId()).get();  \n          \n        assertThat(permissionByFindById.getTopic()).isEqualTo(topic);  \n        assertThat(permissionByFindById.getMember()).isEqualTo(member);  \n    }\n}\n```\n\nìœ„ì™€ ê°™ì´ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì§œê³ , `@ManyToOne fetchType` ì€ `Eager` (ê¸°ë³¸ ì„¤ì •) ë¡œ ì„¤ì •í•˜ê³  í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆë‹¤.\n\në‹¹ì—°íˆ ì¶”ê°€ì ì¸ `select` ì¿¼ë¦¬ê°€ ë‚ ì•„ê°€ê² ì§€? ã…ã…\n\n### ì˜ˆìƒê³¼ ë‹¤ë¥¸ ê²°ê³¼\n\n```sql\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤\n    from\n        permission p1_0 \n    join\n        member m1_0 \n            on m1_0.id=p1_0.member_id \n    join\n        topic t1_0 \n            on t1_0.id=p1_0.topic_id \n    left join\n        member c1_0 \n            on c1_0.id=t1_0.member_id \n    where\n        p1_0.id=?\n```\n\nì•„ë‹ˆ ë„ëŒ€ì²´ ì™œ ???\n\nì˜ˆìƒëŒ€ë¡œë¼ë©´ `select` ì¿¼ë¦¬ê°€ ë‚˜ê°€ì•¼ í•˜ëŠ”ë°...\n\nì´í•´ê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤.\n\nì™œ `select` í–ˆë‹¤ê°€ ì§€ ë§ˆìŒëŒ€ë¡œ `join` í•´ì„œ ì˜¤ëŠ”ì§€ ê°ˆëŒ€ê°™ì€ `JPA` ì˜ ë§ˆìŒì„ ì•Œ ìˆ˜ê°€ ì—†ë‹¤.\n\nì´ ê²°ê³¼ë¥¼ ë³´ê³  ì´ì „ê³¼ ë‹¤ë¥¸ê²Œ ë­ì§€... í•˜ë©´ì„œ ê³°ê³°íˆ ìƒê°í•´ë³´ì•˜ë‹¤.\n\nì´ ë•Œ ë‚´ê°€ ë°œê²¬í•œ ì°¨ì´ì ì€ ë‹¨ í•˜ë‚˜ì˜€ë‹¤.\n\n# ì´ì „ì—ëŠ” ëª©ë¡ ì¡°íšŒ(findAll()), ì´ë²ˆì—ëŠ” ë‹¨ê±´ ì¡°íšŒ(findById())ì´ë‹¤.\n\n### í˜¸ë‹¤ë‹¥ findAll ë¡œ í…ŒìŠ¤íŠ¸\n\n```java\n@Test  \nvoid permissionManyToOneFindAll() {  \n    List<Permission> permission = permissionRepository.findAll();  \n}\n```\n\nìœ„ì™€ ê°™ì´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•´ë³´ì•˜ë‹¤.\n\nê²°ê³¼ëŠ”??\n\n```sql\nHibernate: \n    insert \n    into\n        permission\n        (created_at,member_id,topic_id,updated_at,id) \n    values\n        (?,?,?,?,default)\nHibernate: \n    select\n\t    ... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        permission p1_0\nHibernate: \n    select\n\t    ... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        member m1_0 \n    where\n        m1_0.id=?\nHibernate: \n    select\n\t    ... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        topic t1_0 \n    left join\n        member c1_0 \n            on c1_0.id=t1_0.member_id \n    where\n        t1_0.id=?\n```\n\nì—­ì‹œë‚˜ ì˜ˆìƒëŒ€ë¡œ `findAll` ì¸ ê²½ìš°ëŠ” ë˜‘ê°™ì´ `Eager` ì´ë”ë¼ë„ `join` ì„ í•´ì„œ ê°€ì ¸ì˜¤ì§€ ì•ŠëŠ”ë‹¤.\n\n`Eager` ë¡œ `findById`, `findAll` ì„ í…ŒìŠ¤íŠ¸ í•´ë´¤ìœ¼ë‹ˆ\n\n`Lazy` ë¡œ ë” í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ì„œ ê°€ì„¤ì„ ì‚¬ì‹¤ë¡œ êµ³í˜€ë³´ì!\n\n### Lazy í…ŒìŠ¤íŠ¸\n\në¨¼ì € `findById`ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ë³´ì.\n\n```java\n@Test  \nvoid permissionManyToOneFindById() {  \n    Permission permissionByFindById = permissionRepository.findById(permission.getId()).get();  \n  \n    assertThat(permissionByFindById.getTopic()).isEqualTo(topic);  \n    assertThat(permissionByFindById.getMember()).isEqualTo(member);  \n}\n```\n\n```sql\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        permission p1_0 \n    where\n        p1_0.id=?\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        topic t1_0 \n    left join\n        member c1_0 \n            on c1_0.id=t1_0.member_id \n    where\n        t1_0.id=?\n```\n\nê²°ê³¼ëŠ” ë‹¹ì—°í•˜ë‹¤.\n\n`Lazy` í•˜ê²Œ ê°€ì ¸ì˜¤ë‹ˆ `findById` ë¡œ ê°€ì ¸ì˜¤ë”ë¼ë„ `join` ì„ í•˜ì§€ ì•Šì€ ê²ƒì´ê³ , `getTopic()` ì„ í•  ë•Œ `Topic` ì„ ê°€ì ¸ì™”ê¸° ë•Œë¬¸ì— `select` ì¿¼ë¦¬ê°€ ë‚˜ê°”ë‹¤.\n\nê·¼ë° `member` ë¥¼ ì¡°íšŒí•˜ëŠ” `select` ì¿¼ë¦¬ê°€ ì—†ë‹¤. \n\nì™œ ê·¸ëŸ´ê¹Œ?\n\nì´ìœ ëŠ”, ì´ë²ˆì— ì²˜ìŒ ì•Œì•˜ëŠ”ë° `assertJ` ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  ë•Œ ë‹¨ í•˜ë‚˜ë¼ë„ ì˜ˆìƒí•œ ê²°ê³¼ê°€ ë‚˜ì˜¤ì§€ ì•Šì•„ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•˜ê²Œ ë˜ë©´ ê·¸ ì¦‰ì‹œ í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œë˜ëŠ” ê²ƒ ê°™ë‹¤.\n\nê·¸ë˜ì„œ ë’¤ì— ìˆëŠ” `getMember()` êµ¬ë¬¸ì€ ì‹¤í–‰ë˜ì§€ ì•Šì€ ê²ƒì´ë‹¤.\n\nì–´ì¨Œë“ , ë³¸ë¡ ìœ¼ë¡œ ëŒì•„ì™€ `findAll` ë„ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ë³´ì.\n\n```java\n@Test  \nvoid permissionManyToOneFindAll() {  \n    List<Permission> permission = permissionRepository.findAll();  \n  \n    assertThat(permission.get(0).getTopic()).isEqualTo(topic);  \n    assertThat(permission.get(0).getMember()).isEqualTo(member);  \n}\n```\n\nìœ„ì™€ ê°™ì´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í–ˆê³ , ë‚˜ê°„ ì¿¼ë¦¬ëŠ” ë‹¹ì—°íˆ ìœ„ì™€ ë™ì¼í•  ê²ƒì´ë‹¤.\n\n```sql\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        permission p1_0\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        topic t1_0 \n    left join\n        member c1_0 \n            on c1_0.id=t1_0.member_id \n    where\n        t1_0.id=?\n```\n\nì—­ì‹œ ë™ì¼í•˜ë‹¤.\n\n### ManyToOne í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ í™•ì‹¤í•˜ê²Œ ìœ ì¶”í•  ìˆ˜ ìˆëŠ” ê²ƒ\n\n`findAll` ê³¼ ê°™ì€ ëª©ë¡ ì¡°íšŒëŠ” `Eager`, `Lazy` ê°€ ì •ë§ `select ì‹œê¸°`ë§Œì„ ê²°ì •í•˜ì§€ë§Œ, `findById` ê³¼ ê°™ì€ ë‹¨ê±´ ì¡°íšŒëŠ” `Eager` ë¡œ ì„¤ì •í•˜ê²Œ ë˜ë©´, `fetchType` ì´ `select ì‹œê¸° ê²°ì •`ì„ ë„˜ì–´ `join` ì—¬ë¶€ê¹Œì§€ ê²°ì •í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤. (ìµœì í™”)\n\nê²°ê³¼ì•¼ ë»”í•˜ê¸´ í•˜ì§€ë§Œ, ë‚¨ì€ `OneToMany` í…ŒìŠ¤íŠ¸ë“¤ë„ ì§„í–‰í•´ì„œ ìœ„ ì‚¬ì‹¤ì„ ë”ìš± ë” êµ³í˜€ë³´ì.\n\n## OneToMany\n\n### í…ŒìŠ¤íŠ¸ ì¤€ë¹„\n\n`ManyToOne` í…ŒìŠ¤íŠ¸ì™€ ë§ˆì°¬ê°€ì§€ë¡œ `OneToMany` í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•  `ëŒ€ìƒ Entity` ì™€ `Test ì½”ë“œ`ë¥¼ ì§œë³´ì!\n\n- Member Entity (OneTOMany ì»¬ëŸ¼ë§Œ ìˆì–´ì„œ ë”± ì í•©)\n```java\n@Entity  \n@NoArgsConstructor(access = PROTECTED)  \n@Getter  \npublic class Member extends BaseTimeEntity {  \n  \n    @Id  \n    @GeneratedValue(strategy = GenerationType.IDENTITY)  \n    private Long id;  \n\n\t... ìƒëµ ...\n  \n    @OneToMany(mappedBy = \"creator\")  \n    private List<Topic> createdTopics = new ArrayList<>();  \n\n\t... ìƒëµ ...\n\n}\n```\n\n- Test ì½”ë“œ\n```java\n@Test  \nvoid memberOneToManyFindById() {  \n    Member memberByFindById = memberRepository.findById(member.getId()).get();  \n    assertThat(memberByFindById.getCreatedTopics().get(0)).isEqualTo(topic);  \n}  \n  \n@Test  \nvoid memberOneToManyFindAll() {  \n    List<Member> members = memberRepository.findAll();  \n    assertThat(members.get(0).getCreatedTopics().get(0)).isEqualTo(topic);  \n}\n```\n\n### Eager ì— ëŒ€í•´ì„œ ë¨¼ì € í…ŒìŠ¤íŠ¸ í•´ë³´ì!\n\n- findById ë¡œ í…ŒìŠ¤íŠ¸\n```sql\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        member m1_0 \n    left join\n        topic c1_0 \n            on m1_0.id=c1_0.member_id \n    where\n        m1_0.id=?\n```\n\nì´ì¯¤ë˜ë©´ ë‹¹ì—°íˆ ì˜ˆìƒí•  ìˆ˜ ìˆë“¯ì´ `join` ì„ í•´ì„œ ê°€ì ¸ì˜¨ë‹¤.\n\n- findAll ë¡œ í…ŒìŠ¤íŠ¸\n```sql\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        member m1_0\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        topic c1_0 \n    where\n        c1_0.member_id=?\n```\n\nì´ê²ƒë„ ë‹¹ì—°íˆ ì˜ˆìƒí•  ìˆ˜ ìˆë“¯, `join` ì´ ì•„ë‹Œ `select` ì„ í•´ì„œ ê°€ì ¸ì˜¤ê³ , ì‹¤ì œë¡œ `Topic` ì— `createdTopics` ì— ì ‘ê·¼í•˜ì§€ ì•Šë”ë¼ë„ `select` êµ¬ë¬¸ì´ ë°œìƒí•˜ê²Œ ëœë‹¤.\n\nì™œ ? ì§€ê¸ˆê¹Œì§€ ê³„ì†ë³´ì•˜ë“¯ `findAll` ê³¼ ê°™ì€ `ëª©ë¡ ì¡°íšŒ`ì—ì„œëŠ” `Eager`, `Lazy` ê°€ `select ì‹œê¸°`ë§Œì„ ê²°ì •í•˜ë‹ˆê¹Œ\n\n### Lazy ë„ í…ŒìŠ¤íŠ¸ í•´ë³´ì.\n\nì •ë§ ë»”í•˜ë‹ˆ ê·¸ëƒ¥ ë³„ë‹¤ë¥¸ ì½”ë©˜íŠ¸ ì—†ì´ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë§Œì„ ë‚˜ì—´í•˜ê² ë‹¤.\n\n- findById\n```sql\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        member m1_0 \n    where\n        m1_0.id=?\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        topic c1_0 \n    where\n        c1_0.member_id=?\n```\n\në‹¹ì—°íˆ `join` í•˜ì§€ ì•Šê³ \n\n- findAll\n```sql\nHibernate: \n    select\n\t\t... ìˆ˜ë§ì€ ì»¬ëŸ¼ë“¤ ...\n    from\n        member m1_0 \n    where\n        m1_0.id=?\n```\n\në‹¹ì—°íˆ ì¡°íšŒí•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë” ì´ìƒ `select` ì¿¼ë¦¬ë¥¼ ë°œìƒì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤.\n\n## ìµœì¢…ì ì¸ ê²°ë¡ \n\n- `findById` ëŠ” `FetchType` ì´ `Eager` ë¼ë©´ `join` ì„ í•´ì„œ ê°€ì ¸ì™€ì¤€ë‹¤ (ìµœì í™”ë¥¼ ì•Œì•„ì„œ í•´ì£¼ëŠ” ê²ƒ)\n- `findAll` ì€ `findById` ì™€ ë‹¤ë¥´ê²Œ `fetch type` ì´ `Eager` ì¸ì§€ `Lazy` ì¸ì§€ì— ë”°ë¼ í•´ë‹¹ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ `select ì¿¼ë¦¬ ë°œìƒ ì‹œê¸°`ë§Œì„ ê²°ì •í•œë‹¤. (ì¦‰, `fetch type` ìœ¼ë¡œ ì¸í•´ `join ì—¬ë¶€`ê°€ ê²°ì •ë˜ì§€ ì•ŠìŒ)\n\n"},{"excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„ì˜ ê°€ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ë°°ê²½ ê´œì°®ì„ì§€ë„ ì„œë¹„ìŠ¤ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ë¥¼  ë°©ì‹ìœ¼ë¡œ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.\në€ ìš°ë¦¬ê°€ ì•Œê³  ìˆëŠ”  í…ŒìŠ¤íŠ¸ì—ì„œ ë”°ì˜¨ ë„¤ì´ë°ì…ë‹ˆë‹¤. (ì„œë¹„ìŠ¤ -> ë ˆí¬ì§€í† ë¦¬ê¹Œì§€ì˜ í…ŒìŠ¤íŠ¸ë§Œìœ¼ë¡œë„ E2Eë¼ê³  ë¶ˆë¦¬ëŠ”ì§€ëŠ” ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤)\n ì´ë•Œ, LayerëŠ” ê° ê³„ì¸µ(Service, Repo ë“±)ì„ ë§í•©ë‹ˆë‹¤. ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ë°ì´í„°ë¥¼ ì‚­ì œâ€¦","fields":{"slug":"/trouble-shooting-modifying-annotation/"},"frontmatter":{"date":"October 02, 2023","title":"@Modifying ì–´ë…¸í…Œì´ì…˜ì˜ ì˜µì…˜ì´ ì •ìƒ ë™ì‘í•˜ì§€ ì•ŠëŠ” ë¬¸ì œ","tags":["Spring Data JPA","Test","@Modifying"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„ì˜ `ì¥¬ë‹ˆ`ê°€ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n### ë°°ê²½\n\nê´œì°®ì„ì§€ë„ ì„œë¹„ìŠ¤ì—ì„œëŠ” í…ŒìŠ¤íŠ¸ë¥¼ `Layer To End` ë°©ì‹ìœ¼ë¡œ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.<br>\n`Layer To End`ë€ ìš°ë¦¬ê°€ ì•Œê³  ìˆëŠ” `E2E` í…ŒìŠ¤íŠ¸ì—ì„œ ë”°ì˜¨ ë„¤ì´ë°ì…ë‹ˆë‹¤. (ì„œë¹„ìŠ¤ -> ë ˆí¬ì§€í† ë¦¬ê¹Œì§€ì˜ í…ŒìŠ¤íŠ¸ë§Œìœ¼ë¡œë„ E2Eë¼ê³  ë¶ˆë¦¬ëŠ”ì§€ëŠ” ì˜ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤)\n<br> ì´ë•Œ, LayerëŠ” ê° ê³„ì¸µ(Service, Repo ë“±)ì„ ë§í•©ë‹ˆë‹¤.\n\nì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë„ì¤‘, ë°ì´í„°ê°€ ì‚­ì œë˜ì§€ ì•Šê³  ì¡°íšŒë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.\n<br> ì§€ê¸ˆë¶€í„°, ê·¸ ì´ì•¼ê¸°ë¥¼ ì‹œì‘í•´ ë³´ë ¤ í•©ë‹ˆë‹¤.\n\n### ë¬¸ì œ ìƒí™©\n\në¬¸ì œë¥¼ ì§ë©´í•œ ìƒí™©ì€ `ì‚¬ìš©ìì˜ ì¦ê²¨ì°¾ê¸° ëª©ë¡ì„ ëª¨ë‘ ì‚­ì œí•˜ëŠ” ìƒí™©`ì´ì—ˆìŠµë‹ˆë‹¤.\n<br> í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´, ê° Repositryë¥¼ ì‚¬ìš©í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ ë°ì´í„°ë¥¼ ë„£ì–´ì£¼ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.\n```java\n    @Test\n    @DisplayName(\"ì¦ê²¨ì°¾ê¸° ëª©ë¡ì— ìˆëŠ” ëª¨ë“  í† í”½ì„ ì‚­ì œí•  ìˆ˜ ìˆë‹¤\")\n    void deleteAllBookmarks_Success(){\n            // íšŒì› ì €ì¥\n            Member member = memberRepository.save(MemberFixture.create(\n            \"member\",\n            \"member@naver.com\",\n            Role.USER\n            ));\n            \n            Topic topic1 = TopicFixture.createPrivateAndGroupOnlyTopic(member);\n            Topic topic2 = TopicFixture.createPrivateAndGroupOnlyTopic(member);\n\n            // ì§€ë„ ì €ì¥\n            topicRepository.save(topic1);\n            topicRepository.save(topic2);\n            \n            Bookmark bookmark1 = Bookmark.createWithAssociatedTopicAndMember(topic1, member);\n            Bookmark bookmark2 = Bookmark.createWithAssociatedTopicAndMember(topic2, member);\n\n            // ì¦ê²¨ì°¾ê¸° ë“±ë¡\n            bookmarkRepository.save(bookmark1);\n            bookmarkRepository.save(bookmark2);\n}\n```\nìœ„ ì½”ë“œì˜ ê²°ê³¼ë¡œ, ì‚¬ìš©ì(Member)ì™€ ì§€ë„(Topic)ê°€ ìƒì„±ë˜ì–´ ìˆì„ ê²ƒì´ê³ , ì‚¬ìš©ìëŠ” ìì‹ ì´ ë§Œë“  ì§€ë„ë¥¼ ì¦ê²¨ì°¾ê¸°(Bookmark)ë¡œ ë“±ë¡í•´ ë†“ì€ ìƒí™©ì¼ ê²ƒì…ë‹ˆë‹¤.\n<br> ì´í›„, ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ìˆ˜í–‰í•˜ë©´ í•´ë‹¹ ì‚¬ìš©ìì˜ ì¦ê²¨ì°¾ê¸° ëª©ë¡ì´ ì „ë¶€ ì‚­ì œë˜ì–´, í…ŒìŠ¤íŠ¸ë¥¼ í†µê³¼í•  ê²ƒì´ë¼ ì˜ˆìƒí•˜ì˜€ìŠµë‹ˆë‹¤.\n```java\n        // ìƒëµ ...\n        \n        // í†µê³¼ !\n        assertThat(creatorBefore.getBookmarks()).hasSize(2);\n\n        // í•´ë‹¹ íšŒì›ì˜ ì¦ê²¨ì°¾ê¸° ëª©ë¡ ì „ì²´ ì‚­ì œ\n        AuthMember user = MemberFixture.createUser(creatorBefore);\n        bookmarkCommandService.deleteAllBookmarks(user);\n        \n        // ì‹¤íŒ¨ !\n        assertThat(bookmarkRepository.findById(creatorBefore.getId())).isEmpty();\n```\ní…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ë©”ì‹œì§€ëŠ” ì•„ë˜ì™€ ê°™ì•˜ìŠµë‹ˆë‹¤.\n```java\njava.lang.AssertionError: \nExpecting empty but was: [com.mapbefine.mapbefine.bookmark.domain.Bookmark@23504729,\n    com.mapbefine.mapbefine.bookmark.domain.Bookmark@2447e2e]\n```\nì¦‰, ì¦ê²¨ì°¾ê¸°ê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²ƒì´ë¼ê³  ì˜ˆìƒí•˜ì˜€ì§€ë§Œ, ë°ì´í„°ê°€ ì¡´ì¬í•œë‹¤ëŠ” ì˜ë¯¸ì˜€ìŠµë‹ˆë‹¤.\n<br> í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©ëœ ë©”ì„œë“œë“¤ì˜ ë¡œì§ì ì¸ ì˜¤ë¥˜ë¥¼ ì¬ì°¨ í™•ì¸í•˜ì˜€ì§€ë§Œ, ë°œê²¬í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.\n<br> ê·¸ë ‡ë‹¤ë©´, ë„ëŒ€ì²´ ì™œ ë°ì´í„°ê°€ ì‚­ì œë˜ì§€ ì•Šê³  ì¡°íšŒë˜ëŠ” ê²ƒì¼ê¹Œìš” ?\n\n\n### ì›ì¸ íŒŒì•…\n\nìœ„ ë¬¸ì œì˜ ì›ì¸ì„ ì°¾ê¸° ìœ„í•´ ì—¬ëŸ¬ ë°©ë²•ì„ ì‹œë„í•˜ë˜ ì¤‘, `TestEntityManager`ë¥¼ í†µí•´ ì¦ê²¨ì°¾ê¸° ì‚­ì œ ë©”ì„œë“œ í˜¸ì¶œ ì „, í›„ì— ë‹¤ìŒê³¼ ê°™ì€ ë¡œì§ì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.\n```java\n    @Test\n    @DisplayName(\"ì¦ê²¨ì°¾ê¸° ëª©ë¡ì— ìˆëŠ” ëª¨ë“  í† í”½ì„ ì‚­ì œí•  ìˆ˜ ìˆë‹¤\")\n    void deleteAllBookmarks_Success() throws InterruptedException {\n        // ìƒëµ\n        testEntityManager.flush();\n        testEntityManager.clear();\n\n        bookmarkCommandService.deleteAllBookmarks(user);\n\n        testEntityManager.flush();\n        testEntityManager.clear();\n        // ìƒëµ\n    }\n```\nì¦‰, ì‚­ì œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•œ ë’¤, ëª…ì‹œì ìœ¼ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ flush & clear í•´ì¤€ ê²ƒì…ë‹ˆë‹¤.\n<br> ìœ„ì™€ ê°™ì€ ë¡œì§ì„ ì¶”ê°€í•˜ì, í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ í†µê³¼í–ˆìŠµë‹ˆë‹¤.\n<br> ì´ë¡œì¨, ë¬¸ì œ ì›ì¸ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ê´€ë ¨ì´ ìˆìŒì„ ì•Œê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.\n\ní•˜ì§€ë§Œ, í•œ ê°€ì§€ ì˜ë¬¸ì ì´ ìƒê²¼ìŠµë‹ˆë‹¤.\n<br> ë¶„ëª…, ìš°ë¦¬ëŠ” ë°ì´í„°ì˜ ë³€ê²½ì´ ì¼ì–´ë‚˜ëŠ” `Repository`ì˜ ë©”ì„œë“œì—ëŠ” `@Modifying` ì–´ë…¸í…Œì´ì…˜ê³¼ í•¨ê»˜, `clearAutomatically = true`ë¡œ ì„¤ì •í•´ ë‘” ìƒíƒœì˜€ìŠµë‹ˆë‹¤.\n<br> í…ŒìŠ¤íŠ¸ì—ì„œ ì§ë©´í•œ ë¬¸ì œì²˜ëŸ¼, ë°ì´í„°ë¥¼ ìˆ˜ì •(ì‚­ì œ)í•˜ì˜€ë”ë¼ë„ 1ì°¨ ìºì‹œ ë‚´ë¶€ì—ì„œëŠ” ìˆ˜ì • ì „ ë°ì´í„°ê°€ ì¡´ì¬í•  ìˆ˜ ìˆìŒì„ ì¸ì§€í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.\n<br> ì´ë¡œì¸í•´, ìˆ˜ì • ê´€ë ¨ ì¿¼ë¦¬ê°€ ì‹¤í–‰ëœ í›„, ëª…ì‹œì ìœ¼ë¡œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹„ì›Œì£¼ì—ˆìŠµë‹ˆë‹¤.\n```java\npublic interface BookmarkRepository extends JpaRepository<Bookmark, Long> {\n\n    @Modifying(clearAutomatically = true)\n    void deleteAllByMemberId(Long memberId);\n\n}\n```\n\nìœ„ì™€ ê°™ì€ ì„¤ì •ì„ í•´ë‘ì—ˆìŒì—ë„ ë¶ˆêµ¬í•˜ê³ , ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ë¹„ì›Œì§€ì§€ ì•Šì•˜ë‹¤ëŠ” ì‚¬ì‹¤ì„ ë‚©ë“í•˜ê¸° ì–´ë ¤ì› ìŠµë‹ˆë‹¤.\ní•˜ì§€ë§Œ, ê·¸ ì›ì¸ì€ ìƒê°ë³´ë‹¤ ì‰½ê²Œ ì°¾ì„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\nìš°ë¦¬ê°€ ì‚¬ìš©í•œ `@Modifying` ì–´ë…¸í…Œì´ì…˜ì„ í™•ì¸í•´ ë³´ë‹ˆ, ë‹¤ìŒê³¼ê°™ì´ ì“°ì—¬ìˆì—ˆìŠµë‹ˆë‹¤.\n> Indicates a query method should be considered as modifying query as that changes the way it needs to be executed. <br>\n> **This annotation is only considered if used on query methods defined through a {@link Query} annotation.**<br> It's not \n> applied on custom implementation methods or queries derived from the method name as they already have control over \n> the underlying data access APIs or specify if they are modifying by their name.\n\nìš°ë¦¬ê°€ ì£¼ëª©í•  ì ì€, ìœ„ ì„¤ëª…ì˜ ë‘ ë²ˆì§¸ ì¤„ì´ì—ˆìŠµë‹ˆë‹¤.\n<br> ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ìë©´, `@Modifying` ì–´ë…¸í…Œì´ì…˜ì€ `@Query` ì–´ë…¸í…Œì´ì…˜ê³¼ í•¨ê»˜ ì‚¬ìš©ë  ë•Œë§Œ íš¨ë ¥ì´ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.\n<br> ì¦‰, ì•„ë˜ì™€ ê°™ì€ `NamedQeury`ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì˜µì…˜ê°’ì„ ë„£ì–´ì£¼ë”ë¼ë„ ë™ì‘í•˜ì§€ ì•Šì•˜ë˜ ê²ƒì´ì£ .\n```java\npublic interface BookmarkRepository extends JpaRepository<Bookmark, Long> {\n    @Modifying(clearAutomatically = true)\n    void deleteAllByMemberId(Long memberId);\n}\n```\n\n### ë¬¸ì œ í•´ê²°\n\n(1) `@Query` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ê³¼, (2) í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ flush & clearë¥¼ ëª…ì‹œì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ” ë°©ë²•ì´ ìˆì—ˆìŠµë‹ˆë‹¤.\n<br> ë‹¨ìˆœíˆ í…ŒìŠ¤íŠ¸ í†µê³¼ì— ëª©ì ì„ ë‘” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì—, ì‹¤ì œ í”„ë¡œë•íŠ¸ ì½”ë“œì—ì„œë„ ì˜ˆìƒì¹˜ ëª»í•œ ë™ì‘ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ (1)ë²ˆ ë°©ë²•ì„ ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤.\n<br> ì´ì— ë”°ë¼, `Named Query -> JPQL`ë¡œ ë³€ê²½í•¨ìœ¼ë¡œì¨ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n```java\npublic interface BookmarkRepository extends JpaRepository<Bookmark, Long> {\n    @Modifying(clearAutomatically = true)\n    @Query(\"delete from Bookmark b where b.member.id = :memberId\")\n    void deleteAllByMemberId(@Param(value = \"memberId\") Long memberId);\n}\n\n```\n"},{"excerpt":"ì´ ê¸€ì€ ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ ê´œì°®ì„ì§€ë„íŒ€ì˜ ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ì§€ë‚œ ê¸€ GitHub Actionsë¡œ CI/CD êµ¬ì¶•í•˜ê¸°ì—ì„œ í˜„ì¬ ì €í¬ í”„ë¡œì íŠ¸ì˜ ì¸í”„ë¼ êµ¬ì¡°ë¥¼ ê°„ëµí•˜ê²Œ ì´ë¯¸ì§€ë¡œ ì„¤ëª…ë“œë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ë“œë¦¬ìë©´, ì„œë²„ì˜ ì•ë‹¨ì—ì„œ Nginxë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°ìš”.  âš ï¸ í¸ì˜ìƒ ê°œë°œ ì„œë²„, DB ì„œë²„ ë¶€ë¶„ì€ ìƒëµí•˜ê³  í™•ëŒ€í•œ ì´ë¯¸ì§€ì…ë‹ˆë‹¤. ê°œë°œ ì„œë²„ì˜ Nginâ€¦","fields":{"slug":"/how-to-use-nginx/"},"frontmatter":{"date":"August 01, 2023","title":"ê´œì°®ì„ì§€ë„ì˜ Nginx í™œìš©ë²•","tags":["ì¸í”„ë¼"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ ê´œì°®ì„ì§€ë„íŒ€ì˜ `ë„ì´`ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.\n\nì§€ë‚œ ê¸€ [GitHub Actionsë¡œ CI/CD êµ¬ì¶•í•˜ê¸°](https://map-befine-official.github.io/github-actions-ci-cd)ì—ì„œ  \ní˜„ì¬ ì €í¬ í”„ë¡œì íŠ¸ì˜ ì¸í”„ë¼ êµ¬ì¡°ë¥¼ ê°„ëµí•˜ê²Œ ì´ë¯¸ì§€ë¡œ ì„¤ëª…ë“œë ¸ìŠµë‹ˆë‹¤.\n\në‹¤ì‹œ ì´ë¯¸ì§€ë¥¼ ë³´ì—¬ë“œë¦¬ìë©´, ì„œë²„ì˜ ì•ë‹¨ì—ì„œ Nginxë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë°ìš”.\n\n![infra_nginx.png](.index_image/infra_nginx.png)\n> âš ï¸ í¸ì˜ìƒ ê°œë°œ ì„œë²„, DB ì„œë²„ ë¶€ë¶„ì€ ìƒëµí•˜ê³  í™•ëŒ€í•œ ì´ë¯¸ì§€ì…ë‹ˆë‹¤.  \n> ê°œë°œ ì„œë²„ì˜ Nginxë„ ê°™ì€ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.  \n> ë˜, 80 í¬íŠ¸ ìš”ì²­ì— ëŒ€í•´ì„œë„ 443 í¬íŠ¸ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•´ì£¼ê³  ìˆìœ¼ë‚˜ ì´ ë˜í•œ í¸ì˜ìƒ ê·¸ë¦¼ì—ëŠ” ìƒëµí•˜ê³  ìˆìŠµë‹ˆë‹¤.  \n \nì´ë²ˆ ê¸€ì—ì„œëŠ” Nginxì˜ ëª¨ë“  ê²ƒì— ëŒ€í•´ ì„¤ëª…í•˜ê¸°ë³´ë‹¤ëŠ” Nginxë¥¼ ì™œ ì¼ëŠ”ì§€, ì–´ë–»ê²Œ ì¼ëŠ”ì§€ì— ì´ˆì ì„ ë§ì¶°ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.  \n\n## Nginxë€?\nê·¸ë˜ë„ ì´ê²Œ ë­”ì§€ ì•Œì•„ì•¼ê² ì£ ? ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•˜ë©´, ê²½ëŸ‰í™”ëœ ì›¹ ì„œë²„ í”„ë¡œê·¸ë¨ì…ë‹ˆë‹¤.  \nì •ì  íŒŒì¼ì„ ì œê³µí•˜ëŠ” HTTP ì„œë²„ë¡œë„, ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„œë²„ë¡œë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  \n\nì´ì œ ì €í¬ì˜ Nginx ì„¤ì • íŒŒì¼ì„ ë³´ë©´ì„œ ì–´ë–»ê²Œ í™œìš©í–ˆëŠ”ì§€ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n> ì„¤ì • íŒŒì¼ì€ ê³¼ê±° ë°©ì‹ìœ¼ë¡œëŠ” /etc/nginx/sites-available ë˜ëŠ” /sites-enabledì—ì„œ ê´€ë¦¬í•˜ê³ ,  \n> ìµœì‹  ë°©ë²•ìœ¼ë¡œëŠ” /etc/nginx/conf.d ë””ë ‰í† ë¦¬ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤.  \n> ë˜, ì „ì—­ ì„¤ì •ì„ ê´€ë¦¬í•˜ëŠ” íŒŒì¼ë¡œëŠ” `/etc/nginx/nginx.conf`ê°€ ìˆìŠµë‹ˆë‹¤.\n```properties\nserver {\n        # (1) HTTPS ì ìš© ì „, ì„œë²„ ì´ë¦„ ì§€ì •\n        server_name ${ë„ë©”ì¸};\n\n        # (1) HTTPS ì ìš© : SSLì„ ì‚¬ìš©í•˜ì—¬ 443í¬íŠ¸ì—ì„œ ìˆ˜ì‹ \n        listen 443 ssl; # managed by Certbot\n        ssl_certificate /etc/letsencrypt/live/${ë„ë©”ì¸}/fullchain.pem; # managed by Certbot\n        ssl_certificate_key /etc/letsencrypt/live/${ë„ë©”ì¸}/privkey.pem; # managed by Certbot\n        include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot\n        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot\n\n        # (3) ì›¹ ì„œë²„ì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ì§€ì •\n        root /var/www/html;\n\n        # (3) ì›¹ ì„œë²„ê°€ ë””ë ‰í† ë¦¬ë¥¼ ì—´ ë•Œ ì‚¬ìš©í•  ê¸°ë³¸ íŒŒì¼ ì§€ì • (ë‚˜ì—´ëœ ìˆœì„œëŒ€ë¡œ íƒìƒ‰)\n        index index.html index.htm index.nginx-debian.html;\n\n        # (2, 3) ë£¨íŠ¸ URLì— ëŒ€í•œ ë™ì‘ ì •ì˜ : í”„ë¡ íŠ¸ì—”ë“œ ì •ì  íŒŒì¼ ì„œë¸Œ\n        location / {\n            root /usr/share/nginx/html/dist;\n            include /etc/nginx/mime.types;\n            try_files $uri $uri/ /index.html;\n        }\n\n        # (2) /api/ URLì— ëŒ€í•œ ë™ì‘ ì •ì˜ : ë°±ì—”ë“œ API ì—°ê²°\n        location /api/ {\n            rewrite ^/api/(.*) /$1?$args break;\n            proxy_pass http://${ì„œë²„ IP ì£¼ì†Œ}:8080;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        }\n}\n\n# í•´ë‹¹ ë„ë©”ì¸ì— ëŒ€í•´ 80ë²ˆ í¬íŠ¸ HTTP ìš”ì²­ì´ ì˜¤ë©´ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜\nserver {\n    if ($host = ${ë„ë©”ì¸}) {\n        return 301 https://$host$request_uri;\n    } # managed by Certbot\n    \n    \n    listen 80 ;\n    listen [::]:80 ;\n    server_name ${ë„ë©”ì¸};\n}\n```\n\n## (1) HTTPS ì ìš©í•˜ê¸°\nSSL ì¸ì¦ì„œë§Œ ìˆìœ¼ë©´, ì›¹ì„œë²„ë¥¼ í†µí•´ ì‰½ê²Œ HTTPS í”„ë¡œí† ì½œì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  \në¬´ë£Œ ì´ìš©ì´ ê°€ëŠ¥í•˜ê³ , `Nginx`ì™€ í†µí•©í•˜ì—¬ ì‚¬ìš©í•˜ê¸° ì¢‹ì€ `Certbot`ì„ ì‚¬ìš©í•´ ì´ë¥¼ ì ìš©í–ˆìŠµë‹ˆë‹¤.  \nì „ì²´ì ì¸ íë¦„ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.  \n\n1. ë„ë©”ì¸ì„ êµ¬ë§¤í•˜ê³ , ë ˆì½”ë“œ Aì— public IP ì£¼ì†Œë¥¼ ë“±ë¡í•œë‹¤.\n2. `Cerbot`ì„ ì„¤ì¹˜í•œë‹¤.\n3. ì„¤ì • íŒŒì¼ì˜ server_nameì„ êµ¬ë§¤í•œ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½í•œë‹¤.\n4. `Certbot`ì„ ì´ìš©í•´ êµ¬ë§¤í•œ ë„ë©”ì¸ì„ ì´ìš©í•´ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ëŠ”ë‹¤.\n5. ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ìœ¼ë©´, `Certbot`ì´ ìë™ìœ¼ë¡œ ì„¤ì • íŒŒì¼ì—ì„œ server_nameì´ ì¼ì¹˜í•˜ëŠ” ë¸”ë¡ì„ ì°¾ì•„ SSL ê´€ë ¨ ë‚´ìš©ë“¤ì„ ì¶”ê°€í•´ì¤€ë‹¤.\n\n`# managed by Certbot`ì´ë¼ëŠ” ì£¼ì„ì´ ë¶™ì–´ìˆëŠ” ë‚´ìš©ë“¤ì´ `Certbot`ì´ ì¶”ê°€í•´ì¤€ ë‚´ìš©ì…ë‹ˆë‹¤.\n\n> `Certbot`ì€ SSL ì¸ì¦ ë°œê¸‰ ë„êµ¬ë¡œ, ë¬´ë£Œ SSL ì¸ì¦ì„œ ë°œê¸‰ ê¸°ê´€ì¸ `Let's Encrypt`ì™€ í†µí•©ë˜ì–´ ìˆìŠµë‹ˆë‹¤.  \n> ì´ë¥¼ í†µí•´ ì‰½ê²Œ SSL ì¸ì¦ì„œë¥¼ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  \n> ë˜, `Nginx` ì„¤ì • íŒŒì¼ì„ ìë™ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ SSL ì¸ì¦ì„œë¥¼ ì ìš©í•  ìˆ˜ ìˆì–´ í¸ë¦¬í•©ë‹ˆë‹¤.\n> ë‹¨, ìœ íš¨ ê¸°ê°„ì´ 90ì¼ì´ê¸° ë•Œë¬¸ì— ìë™ ê°±ì‹  ì„¤ì •ì´ ë³„ë„ë¡œ í•„ìš”í•©ë‹ˆë‹¤.  \n\ní•˜ë‹¨ì— ì²¨ë¶€í•œ ì°¸ê³  ìë£Œì™€ ê°™ì´, ì˜ ì •ë¦¬ëœ ìë£Œê°€ ê¸°ì¡´ì— ë§ê¸° ë•Œë¬¸ì— ìì„¸í•œ ë‚´ìš©ì€ ìƒëµí•˜ê² ìŠµë‹ˆë‹¤.\n\n## (2) í”„ë¡ íŠ¸ì—”ë“œ, ë°±ì—”ë“œ ìš”ì²­ êµ¬ë¶„í•˜ê¸°\nì €í¬ í”„ë¡œì íŠ¸ì˜ ì¸í”„ë¼ êµ¬ì¡°ì—ì„œëŠ” í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œê°€ ê°™ì€ ì„œë²„ë¥¼ ê³µìœ í•˜ë¯€ë¡œ  \ní´ë¼ì´ì–¸íŠ¸ê°€ ì´ìš©í•˜ëŠ” í™”ë©´ì— ëŒ€í•œ ìš”ì²­ê³¼, ë°±ì—”ë“œ APIì— ëŒ€í•œ ìš”ì²­ì„ êµ¬ë¶„í•  í•„ìš”ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.  \n\n`location` ë¸”ë¡ì„ ì‚¬ìš©í•´ íŠ¹ì • URLì— ëŒ€í•œ ë™ì‘ì„ ì„¤ì •í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì´ë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.  \n\ní•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ ê°€ì ¸ì™€ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n```properties\n# ë£¨íŠ¸ URLì— ëŒ€í•´ í”„ë¡ íŠ¸ì—”ë“œ ì •ì  íŒŒì¼ ì„œë¸Œ\nlocation / {\n    root /usr/share/nginx/html/dist;\n    include /etc/nginx/mime.types;\n    try_files $uri $uri/ /index.html;\n}\n\n# /api/ URLì— ëŒ€í•´ ë°±ì—”ë“œ API ì—°ê²°\nlocation /api/ {\n    rewrite ^/api/(.*) /$1?$args break; # URLì—ì„œ /api ì œê±°\n    proxy_pass http://${ì„œë²„ IP ì£¼ì†Œ}:8080;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n}\n```\n\n`https://mapbefine.com/api/` ë¡œ ì‹œì‘í•˜ëŠ” URLì— ëŒ€í•´ì„œëŠ” ë°±ì—”ë“œ APIì™€ ì—°ê²°í•©ë‹ˆë‹¤.  \n\nì´ ì„¤ì •ì„ ë§ì¶”ì–´, ë°±ì—”ë“œ ì½”ë“œì—ì„œ `/api`ê°€ ì¶”ê°€ëœ ìš”ì²­ URLì„ ë§¤í•‘í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.  \ní•˜ì§€ë§Œ ì´ëŠ” ìì›ì„ ëª…ì‹œí•˜ê¸° ìœ„í•œ ë‚´ìš©ë³´ë‹¤ëŠ” ìš”ì²­ì„ êµ¬ë¶„í•˜ê¸° ìœ„í•¨ì´ë¯€ë¡œ,  \në¦¬ë²„ì‹œ í”„ë¡ì‹œë¥¼ ê±°ì¹˜ê³  ë‚˜ë©´ ì‹¤ì œë¡œëŠ” `/api`ë¥¼ ì œì™¸í•œ ìš”ì²­ URLë¡œ ì—°ê²°ë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.  \n`# URLì—ì„œ /api ì œê±°` ì£¼ì„ì´ ìˆëŠ” ë¶€ë¶„ì´ í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì…ë‹ˆë‹¤.  \n\n> `proxy_set_header`ëŠ” Nginxê°€ í”„ë¡ì‹œ ìš”ì²­ì„ ì „ë‹¬í•˜ê¸° ì „ì—, HTTP ìš”ì²­ í—¤ë”ë¥¼ ì„¤ì •í•˜ëŠ” ì§€ì‹œë¬¸ì…ë‹ˆë‹¤.  \n> ì›ë˜ ìš”ì²­ì˜ í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ë°±ì—”ë“œ ì„œë²„ì— ì „ë‹¬í•©ë‹ˆë‹¤.  \n> í•„ìˆ˜ ì„¤ì •ì€ ì•„ë‹ˆì§€ë§Œ IP ê¸°ë°˜ì˜ ì ‘ê·¼ ì œì–´, ë¡œê¹…, ë‹¤ì¤‘ í˜¸ìŠ¤íŠ¸ ì„¤ì • ë“±ì— ìœ ìš©í•  ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤.  \n\n## (3) ì •ì  íŒŒì¼ ì„œë¸Œí•˜ê¸°\nì €í¬ëŠ” í”„ë¡ íŠ¸ì—”ë“œì˜ Reactë¥¼ ì„œë²„ì—ì„œ ì‹¤í–‰ì‹œí‚¤ëŠ” ëŒ€ì‹ , ë¹Œë“œ ê²°ê³¼ë¬¼ì„ ì •ì  íŒŒì¼ë¡œ ì„œë¸Œí•˜ëŠ” ë°©ì‹ì„ íƒí•˜ì˜€ìŠµë‹ˆë‹¤.  \nì´ìœ ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.  \n1. ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì„œë²„ ë‚´ì— ì‹¤í–‰í•˜ì—¬ ë™ì ìœ¼ë¡œ íŒŒì¼ì„ ìƒì„±í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ì•„ë‹™ë‹ˆë‹¤.\n2. ì •ì  íŒŒì¼ë¡œ ì„œë¸Œí•˜ì—¬ ì„œë²„ ë©”ëª¨ë¦¬ë¥¼ ì ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰ì‹œí‚¨ ìƒíƒœë¼ë©´, í•´ë‹¹í•˜ëŠ” URLì— ëŒ€í•´ 3000ë²ˆ í¬íŠ¸ë¡œ í¬ì›Œë”©í•´ì£¼ë©´ ë©ë‹ˆë‹¤.\n\në°˜ë©´ ì •ì  íŒŒì¼ë¡œ ì„œë¸Œí•œë‹¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ìš”?  \ní•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì„ ê°€ì ¸ì™€ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\nì•„ë˜ ë‚´ìš©ì€ ì„¤ì • íŒŒì¼ì˜ ê¸°ë³¸ ê°’ê³¼ ê°™ìŠµë‹ˆë‹¤.\n```properties\n# (3) ì›¹ ì„œë²„ì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ì§€ì •\nroot /var/www/html;\n\n# (3) ì›¹ ì„œë²„ê°€ ë””ë ‰í† ë¦¬ë¥¼ ì—´ ë•Œ ì‚¬ìš©í•  ê¸°ë³¸ íŒŒì¼ ì§€ì • (ë‚˜ì—´ëœ ìˆœì„œëŒ€ë¡œ íƒìƒ‰)\nindex index.html index.htm index.nginx-debian.html;\n```\n\n`https://mapbefine.com` ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, NginxëŠ” ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì˜ `index.html`ì„ ìš°ì„ ì ìœ¼ë¡œ ì°¾ì•„ ë°˜í™˜í•©ë‹ˆë‹¤.  \në”°ë¼ì„œ í•´ë‹¹ ì›¹ ì„œë²„ì˜ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— ìš°ë¦¬ì˜ ë¹Œë“œ ê²°ê³¼ë¬¼ì¸ `index.html`ì™€ ëª¨ë“ˆ íŒŒì¼ë“¤ì„ ìœ„ì¹˜ì‹œí‚¤ë©´ ë©ë‹ˆë‹¤.  \në°˜ëŒ€ë¡œ, ì •ì  íŒŒì¼ì„ ì €ì¥í•˜ê³  ìˆëŠ” ìœ„ì¹˜ë¥¼ root ê°’ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì–´ë„ ì¢‹ìŠµë‹ˆë‹¤.\n \n## ê²°ë¡ \nê´œì°®ì„ì§€ë„ ì„œë²„ì˜ NginxëŠ”  \ní´ë¼ì´ì–¸íŠ¸ì™€ WAS(Spring Boot) ì‚¬ì´ì— Nginxë¥¼ ë‘ì–´ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„œë²„ë¡œ ì‚¬ìš©í•˜ë©°,  \në™ì‹œì— HTTPS ì ìš©ì„ í•´ê²°í•˜ê³  HTTP ì„œë²„ì™€ ê°™ì´ ì •ì  íŒŒì¼ ì„œë¸Œë„ ìˆ˜í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.\n\në‹¤ë§Œ í˜„ì¬ ê·œëª¨ì—ì„œ ê°„ë‹¨í•œ ë°©ë²•ì„ íƒí•œ ê²ƒìœ¼ë¡œ,  \nì„œë¹„ìŠ¤ì˜ ê·œëª¨ê°€ ì»¤ì§ì— ë”°ë¼ ì •ì  íŒŒì¼ì„ ë³„ë„ ì„œë²„ì— ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ìœ ë¦¬í•˜ê±°ë‚˜ ë™ì ì¸ íŒŒì¼ ìƒì„±ì´ í•„ìš”í•œ ê²½ìš° í™œìš© ë°©ì‹ì€ ì–¼ë§ˆë“ ì§€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.\n\n\n## ì°¸ê³ ìë£Œ\n[Nginx ê³µì‹ ë¬¸ì„œ](https://nginx.org/en/docs/)  \n[baledung - sites-available & sites-enabled, conf.d ì„¤ì • íŒŒì¼ ë°©ì‹ ì°¨ì´](https://www.baeldung.com/linux/sites-available-sites-enabled-conf-d)  \n[Nginxì™€ Let's Encryptë¡œ HTTPS ì›¹ ì„œë¹„ìŠ¤ ë°°í¬í•˜ê¸° (feat. Certbot)](https://hudi.blog/https-with-nginx-and-lets-encrypt/)  \n[how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-22-04 (Step2 ë¶€ë¶„ ì°¸ê³ )](https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-22-04)\n"},{"excerpt":"ì´ ê¸€ì€ ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ ê´œì°®ì„ì§€ë„íŒ€ì˜ ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤I í…ŒìŠ¤íŠ¸ ê°„ ê²©ë¦¬.. ì™œ í•„ìš”í• ê¹Œ? ìš°ë¦¬ëŠ” í”„ë¡œë•ì…˜ ì½”ë“œì˜ ì‹ ë¢°ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì—, í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” 100ë²ˆì„ ì‹¤í–‰ì‹œí‚¤ë˜ 100ë§Œë²ˆì„ ì‹¤í–‰ì‹œí‚¤ë˜, ë™ì¼í•œ ê²°ê³¼ë¥¼ ë‚´ë±‰ì–´ì•¼í•œë‹¤. í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì•„ë¬´ë¦¬ ì˜ ì‘ì„±í•˜ë”ë¼ë„, ë§¤ë²ˆ í…ŒìŠ¤íŠ¸ì˜ ê²°ê³¼ê°€ ë‹¤ë¥´ë‹¤ë©´ ì˜ë¯¸ê°€ ì—†ë‹¤. ì˜ˆë¥¼â€¦","fields":{"slug":"/how-to-isolating-test/"},"frontmatter":{"date":"July 31, 2023","title":"ì¸ìˆ˜í…ŒìŠ¤íŠ¸ì—ì„œ í…ŒìŠ¤íŠ¸ ê²©ë¦¬í•˜ê¸°!","tags":["í…ŒìŠ¤íŠ¸","ë°ì´í„°ë² ì´ìŠ¤"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ ê´œì°®ì„ì§€ë„íŒ€ì˜ `ë§¤íŠœ`ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤I\n\n## í…ŒìŠ¤íŠ¸ ê°„ ê²©ë¦¬.. ì™œ í•„ìš”í• ê¹Œ?\n\nìš°ë¦¬ëŠ” í”„ë¡œë•ì…˜ ì½”ë“œì˜ ì‹ ë¢°ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•´ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.\n\nê·¸ë ‡ê¸° ë•Œë¬¸ì—, í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” 100ë²ˆì„ ì‹¤í–‰ì‹œí‚¤ë˜ 100ë§Œë²ˆì„ ì‹¤í–‰ì‹œí‚¤ë˜, ë™ì¼í•œ ê²°ê³¼ë¥¼ ë‚´ë±‰ì–´ì•¼í•œë‹¤.\n\ní…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì•„ë¬´ë¦¬ ì˜ ì‘ì„±í•˜ë”ë¼ë„, ë§¤ë²ˆ í…ŒìŠ¤íŠ¸ì˜ ê²°ê³¼ê°€ ë‹¤ë¥´ë‹¤ë©´ ì˜ë¯¸ê°€ ì—†ë‹¤.\n\nì˜ˆë¥¼ ë“¤ì–´ ì•„ë˜ì™€ ê°™ì€ í…ŒìŠ¤íŠ¸ê°€ ìˆë‹¤ê³  í•´ë³´ì.\n\n```java\n@DataJpaTest\npublic class ExampleTest {  \n\n    @Autowired  \n    private PinRepository pinRepository;  \n      \n    @Test  \n    void ëª¨ë“ _í•€ì„_ì¡°íšŒí•œë‹¤() {  \n        // given  \n        Pin pin = new Pin(...);  \n        pinRepository.save(pin);  \n          \n        // when  \n        List<Pin> pins = pinRepository.findAll();  \n  \n        // then  \n        assertAll(  \n                () -> assertThat(pins).hasSize(1),  \n                () -> assertThat(pins.get(0)).isEqualTo(pin)  \n        );  \n    }  \n\n}\n```\n\nì •ìƒì ì¸ ê²½ìš°ë¼ë©´, ìœ„ í…ŒìŠ¤íŠ¸ëŠ” í†µê³¼í•´ì•¼í•œë‹¤.\n\ní•˜ì§€ë§Œ, í…ŒìŠ¤íŠ¸ ê°„ ê²©ë¦¬ë¥¼ ì§„í–‰í•˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ì´ í…ŒìŠ¤íŠ¸ ì´ì „ì— ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ì—ì„œ pin ì„ ì €ì¥í•˜ëŠ” ë™ì‘ì„ ìˆ˜í–‰í–ˆê³ , ë°ì´í„°ë¥¼ ì§€ì›Œì£¼ì§€ ì•Šì•˜ë‹¤ë©´?\n\ní•´ë‹¹ í…ŒìŠ¤íŠ¸ëŠ” ì‹¤íŒ¨í•˜ê²Œ ë  ê²ƒì´ë‹¤.\n\nìœ„ í…ŒìŠ¤íŠ¸ëŠ” ì´ì „ì— ìˆ˜í–‰ëœ í…ŒìŠ¤íŠ¸ë“¤ì˜ ë™ì‘ì—ë„ ì˜í–¥ì„ ë°›ëŠ”, ë…ë¦½ì ì´ì§€ ëª»í•œ í…ŒìŠ¤íŠ¸ê°€ ëœ ê²ƒì´ë‹¤.\n\nì´ê²ƒì´ ë°”ë¡œ í…ŒìŠ¤íŠ¸ ê°„ ê²©ë¦¬ê°€ í•„ìš”í•œ ì´ìœ ì´ë‹¤.\n\nê·¸ë ‡ë‹¤ë©´ ìœ„ì™€ ê°™ì€ ìƒí™©ì„ @Transactional ì–´ë…¸í…Œì´ì…˜ë§Œìœ¼ë¡œ ì™„ë²½í•˜ê²Œ ì˜ˆë°©í•  ìˆ˜ ìˆì„ê¹Œ?\n\nê²°ë¡ ë¶€í„° ë§í•˜ìë©´ ê·¸ëŸ´ ìˆ˜ ì—†ë‹¤.\n\n@SpringBootTest ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¸ìˆ˜í…ŒìŠ¤íŠ¸ ê°™ì€ ê²½ìš°ëŠ” Port ë¥¼ ì§€ì •í•˜ì—¬ ì„œë²„ë¥¼ ë„ìš°ê²Œ ë˜ëŠ”ë°, ì´ ë•Œ HTTP í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ëŠ” ê°ê¸° ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ê²Œ ëœë‹¤.\n\nê·¸ë ‡ê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ ì½”ë“œì— @Transactional ìˆë”ë¼ë„ í˜¸ì¶œë˜ëŠ” ìª½ì€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ìƒˆë¡œìš´ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•˜ê¸° ë•Œë¬¸ì—, ë¡¤ë°± ì „ëµì€ ë¬´ìƒ‰í•´ì§€ê²Œ ë˜ê³ , í…ŒìŠ¤íŠ¸ ê°„ ê²©ë¦¬ë„ ì œëŒ€ë¡œ ì´í–‰ë  ìˆ˜ê°€ ì—†ëŠ” ê²ƒì´ë‹¤.\n\n## ê·¸ë ‡ë‹¤ë©´ ê²©ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë“¤ì€ ë¬´ì—‡ì´ ìˆì„ê¹Œ?\n\nì´ë²ˆ í¬ìŠ¤íŠ¸ë¥¼ í†µí•´ì„œ ë‹¤ë¤„ë³¼ ë°©ë²•ì€ 3ê°€ì§€ì´ë‹¤.\n\në°”ë¡œ `Dirtiest Context`,  `@Sql ì–´ë…¸í…Œì´ì…˜`, `Entity Manager` ì´ë‹¤.\n\ní•˜ë‚˜ì”© ì§šì–´ë³´ë©´ì„œ ë„˜ì–´ê°€ë³´ì.\n\n### DirtiesContext\n\n```java\n@DirtiesContext(classMode = DirtiesContext.ClassMode.BEFORE_EACH_TEST_METHOD)  \n@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)\npublic class ExampleTest {\n\t...\n}\n```\n\n`DiriesContext` ëŠ” í˜„ì¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³ ì í•˜ëŠ” ì»¨í…ìŠ¤íŠ¸ì— ë¹ˆì´ ë¡œë“œë˜ì–´ ìˆìœ¼ë©´ Dirties ë¥¼ í™•ì¸í•˜ê³  Bean ë“¤ì„ Reload í•˜ê²Œ ëœë‹¤.\n\nì¦‰, í…Œì´ë¸”ë„ ë‹¤ì‹œ ë§Œë“¤ê¸° ë•Œë¬¸ì— í…ŒìŠ¤íŠ¸ ê°„ì˜ ê²©ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.\n\ní•˜ì§€ë§Œ, ë§¤ë²ˆ í…ŒìŠ¤íŠ¸í•˜ê¸° ì´ì „ì— ì»¨í…ìŠ¤íŠ¸ë¥¼ Reload í•˜ê²Œ ëœë‹¤ë©´, í…ŒìŠ¤íŠ¸ ì‹œê°„ì€ í•œì—†ì´ ê¸¸ì–´ì§€ê²Œ ë  ê²ƒì´ê¸° ë•Œë¬¸ì´ë‹¤.\n\ní…ŒìŠ¤íŠ¸ì˜ ì¥ì ì€ í”„ë¡œë•ì…˜ ì½”ë“œì˜ ì‹ ë¢°ì„±ì„ ë³´ì¥í•¨ì—ë„ ì¡´ì¬í•˜ì§€ë§Œ, ê°œë°œìê°€ ê°œë°œì„ ì§„í–‰ì¤‘ì— ì½”ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì‘ì„±ì¤‘ì¸ì§€ ë°”ë¡œ ë°”ë¡œ ì‘ë‹µë°›ê¸° ìœ„í•œ ìˆ˜ë‹¨ì´ê¸°ë„ í•˜ë‹¤.\n\në”°ë¼ì„œ, ì‘ë‹µ ì†ë„ëŠ” ê°œë°œ ì§„í–‰ ì†ë„ì™€ í¬ê²Œ ì—°ê´€ë˜ì–´ ìˆëŠ” ê²ƒì´ë‹¤.\n\ní•˜ì§€ë§Œ, ì¸ìˆ˜í…ŒìŠ¤íŠ¸ì— DirtiesContext ë¥¼ ë‚œì‚¬í•˜ê²Œ ë˜ë©´, ë§¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ë§ˆë‹¤ ì†ì´ í„°ì§€ëŠ” ê²½í—˜ì„ í•˜ê²Œ ë  ê²ƒì´ë‹¤.\n\n### @Sql ì–´ë…¸í…Œì´ì…˜\n\ní•´ë‹¹ ë°©ë²•ì€ ê½¤ë‚˜ íšê¸°ì ì¸ ë°©ë²•ì´ë‹¤.\n\nê°„ë‹¨í•œ sql êµ¬ë¬¸ë§Œìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ê°„ì˜ ê²©ë¦¬ë¥¼ ì´ë¤„ë‚¼ ìˆ˜ ìˆë‹¤. \n\nì–´ë–¤ ì´ëŠ” ì™¸ë˜í‚¤ ì œì•½ ì¡°ê±´ìœ¼ë¡œ ì¸í•´ í•œë²ˆì— ë°ì´í„°ë¥¼ ì‚­ì œí•˜ëŠ” ê²ƒì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤ê³  ìƒê°í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì•„ë˜ ì½”ë“œì™€ ê°™ì´ ì™¸ë˜í‚¤ ì œì•½ ì¡°ê±´ì„ í•´ì œí•´ì£¼ê³  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤. \n\n```sql\nSET FOREIGN_KEY_CHECKS = 0;  \nTRUNCATE TABLE í…Œì´ë¸”ì´ë¦„;  \n...\nSET FOREIGN_KEY_CHECKS = 1;\n```\n\n```java\n@DataJpaTest\n@Sql(\"/truncate.sql\")\npublic class ExampleTest {  \n\t...\n}\n```\n\ní•˜ì§€ë§Œ, í•´ë‹¹ ë°©ë²•ì—ë„ ë‹¨ì ì€ ì¡´ì¬í•œë‹¤.\n\në°”ë¡œ, í…Œì´ë¸”ì´ ì¶”ê°€ë  ë•Œë§ˆë‹¤, í•´ë‹¹ sql êµ¬ë¬¸ì„ ìˆ˜ì •í•´ì£¼ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.\n\ní° ë‹¨ì ì€ ì•„ë‹ˆì§€ë§Œ, í•­ìƒ ì‹ ê²½ì¨ì£¼ì–´ì•¼ í•œë‹¤ëŠ” ì ì—ì„œ ì¡°ê¸ˆì€ ì•„ì‰½ë‹¤ëŠ” ìƒê°ì´ ë“ ë‹¤. \n\n### Entity Manager\n\nìœ„ì—ì„œë„ ì–¸ê¸‰í•˜ì˜€ë“¯ `@Sql` ì–´ë…¸í…Œì´ì…˜ì€ ì •ë§ ê°•ë ¥í•˜ì§€ë§Œ, í…Œì´ë¸”ì´ ì¶”ê°€ë  ë•Œë§ˆë‹¤ sql êµ¬ë¬¸ì„ ë‹¤ì‹œ ìˆ˜ì •í•´ì£¼ì–´ì•¼ í•œë‹¤ëŠ” ë‹¨ì ì´ ì¡´ì¬í–ˆë‹¤.\n\nì´ ë•Œ, `@Sql` ì–´ë…¸í…Œì´ì…˜ì˜ ì¥ì ì„ ëª¨ë‘ ê°€ì ¸ê°€ë©´ì„œ, ìœ„ì—ì„œ ì–¸ê¸‰í•œ ë‹¨ì ë„ ë³´ì™„í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆë‹¤.\n\në°”ë¡œ `Entity Manager` ë¥¼ í™œìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.\n\në„ëŒ€ì²´ ì–´ë–»ê²Œ? `Entity Manager` ë¥¼ í†µí•´ì„œ Data ë¥¼ ì§€ìš´ë‹¤ëŠ” ê²ƒì¼ê¹Œ?\n\nìš°ë¦¬ëŠ” ê°œë°œìì´ë‹ˆ ì½”ë“œë¥¼ í†µí•´ ì‚´í´ë³´ì. \n\n```java\n@Componenet  \npublic class DatabaseCleanup implements InitializingBean {  \n\n\tprivate static final String UNDERSCORE = \"_\";\n  \n    @PersistenceContext  \n    private EntityManager entityManager;  \n  \n    private List<String> tableNames;  \n  \n    @Override  \n    public void afterPropertiesSet() {  \n        tableNames = entityManager.getMetamodel().getEntities().stream()  \n                .filter(entityType -> entityType.getJavaType().getAnnotation(Entity.class) != null)  \n                .map(entityType -> convertTableNameFromCamelCaseToSnakeCase(entityType.getName()))  \n                .toList();  \n    }  \n\n    private String convertTableNameFromCamelCaseToSnakeCase(String tableName) {  \n        StringBuilder tableNameSnake = new StringBuilder();  \n  \n        for (char letter : tableName.toCharArray()) {  \n            addUnderScoreForCapitalLetter(tableNameSnake, letter);  \n            tableNameSnake.append(letter);  \n        }  \n  \n        return tableNameSnake.substring(1).toLowerCase();  \n    }  \n  \n    private void addUnderScoreForCapitalLetter(StringBuilder tableNameSnake, char letter) {  \n        if (Character.isUpperCase(letter)) {  \n            tableNameSnake.append(UNDERSCORE);  \n        }  \n    }  \n  \n}\n```\n\nEntity Manager ë¥¼ í†µí•´ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ê¸° ìœ„í•´ DatabaseCleanup ì´ë¼ëŠ” ê°ì²´ë¥¼ ìƒì„±í•´ì¤¬ë‹¤.\n\n`InitializingBean` ì„ implements í•´ `afterPropertiesSet` ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ê²Œë˜ë©´, í”„ë¡œí¼í‹°ê°€ ëª¨ë‘ ì´ˆê¸°í™”ë˜ì—ˆì„ ë•Œ, BeanFactoryì— ì˜í•´ ìë™ìœ¼ë¡œ í•´ë‹¹ ë©”ì„œë“œê°€ í˜¸ì¶œë˜ê²Œ ëœë‹¤.\n\nê·¸ëŸ¬ë‹ˆ, í•´ë‹¹ ë©”ì„œë“œì˜ ë‚´ë¶€ êµ¬í˜„ìœ¼ë¡œ Entity ë“¤ì˜ ClassName ì„ ì´ìš©í•˜ì—¬ ëª¨ë“  í…Œì´ë¸”ëª…ì„ ìƒì„±í•´ë‚´ì–´ ì €ì¥í•˜ë©´ ëœë‹¤. (Entity Class ëª…ì„ Camel Case -> Snake Case ë¡œ ë³€í™˜í•´ì¤€ë‹¤. `convertTableNameFromCamelCaseToSnakeCase` ê°€ í•´ë‹¹ ë™ì‘ì„ ìˆ˜í–‰í•´ì£¼ê³  ìˆë‹¤.)\n\nìœ„ì™€ ê°™ì´ ëª¨ë“  í…Œì´ë¸”ëª…ì„ ìƒì„±í•´ë‚´ì–´ ì €ì¥í–ˆë‹¤ë©´, í•´ë‹¹ í…Œì´ë¸” ëª…ë“¤ì„ ì´ìš©í•˜ì—¬ Data ë¥¼ ëª¨ë‘ ì§€ì›Œì£¼ëŠ” execute ë¥¼ êµ¬í˜„í•´ì£¼ì.\n\n```java\n@Service  \npublic class DatabaseCleanup implements InitializingBean {  \n\n\tprivate static final String SET_REFERENTIAL_INTEGRITY_SQL_MESSAGE = \"SET REFERENTIAL_INTEGRITY %s\";  \n\tprivate static final String TRUNCATE_SQL_MESSAGE = \"TRUNCATE TABLE %s\";  \n\tprivate static final String ID_RESET_SQL_MESSAGE = \"ALTER TABLE %s ALTER COLUMN ID RESTART WITH 1\";  \n  \n    @PersistenceContext  \n    private EntityManager entityManager;  \n  \n    private List<String> tableNames;  \n\n\t...\n\n\t@Transactional  \n\tpublic void execute() {  \n\t    entityManager.flush();  \n\t    entityManager.createNativeQuery(String.format(SET_REFERENTIAL_INTEGRITY_SQL_MESSAGE, false)).executeUpdate();  \n\t  \n\t    for (String tableName : tableNames) {  \n\t        entityManager.createNativeQuery(String.format(TRUNCATE_SQL_MESSAGE, tableName)).executeUpdate();  \n\t        entityManager.createNativeQuery(String.format(ID_RESET_SQL_MESSAGE, tableName)).executeUpdate() ;  \n\t    }  \n\t  \n\t    entityManager.createNativeQuery(String.format(SET_REFERENTIAL_INTEGRITY_SQL_MESSAGE, true)).executeUpdate();  \n\t}\n\t  \n}\n```\n\nìœ„ì˜ ì½”ë“œë¥¼ ìˆœì„œëŒ€ë¡œ ê°„ë‹¨í•˜ê²Œ ì„¤ëª…í•´ë³´ìë©´\n\n1. ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´ì„ ë¹„í™œì„±í™” í•´ì¤€ë‹¤. \n2. `afterPropertiesSet` ì„ í†µí•´ ìƒì„±í•´ë†“ì€ ëª¨ë“  í…Œì´ë¸” ëª…ë“¤ì„ ì´ìš©í•˜ì—¬ Data ë“¤ì„ ëª¨ë‘ Truncate í•´ì£¼ê³ , ID ê°’ì„ ë‹¤ì‹œ ì„¸íŒ…í•´ì¤€ë‹¤.\n3. ì™¸ë˜í‚¤ ì œì•½ì¡°ê±´ì„ í™œì„±í™”í•´ì¤€ë‹¤. \n\nì´ëŸ° Flow ë¡œ í˜ëŸ¬ê°€ëŠ” execute ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ì£¼ì—ˆë‹¤ë©´\n\n```java\n@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)  \npublic class ExampleTest {  \n  \n    @LocalServerPort  \n    private int port;  \n  \n    @Autowired  \n    private DatabaseCleanup databaseCleanup;  \n  \n    @BeforeEach  \n    public void setUp() {  \n        RestAssured.port = port;  \n    }  \n  \n    @AfterEach  \n    public void tearDown() {  \n        databaseCleanup.execute();  \n    }  \n  \n}\n```\n\nìœ„ ì½”ë“œì™€ ê°™ì´ @AfterEach ë¥¼ í†µí•´ ë§¤ ì¸ìˆ˜í…ŒìŠ¤íŠ¸ ë™ì‘ ì´í›„ ì‹¤í–‰ì‹œì¼œì£¼ë©´, ëª¨ë“  í…ŒìŠ¤íŠ¸ë“¤ì„ ê²©ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.\n\n\n## ê²°ë¡ \n\nì§€ê¸ˆìœ¼ë¡œì„œëŠ” ë°ì´í„° ì‚­ì œê°€ ì‰½ê³ , í…Œì´ë¸”ì´ ì¶”ê°€ë˜ì—ˆì„ ë•Œ sql êµ¬ë¬¸ì„ ìˆ˜ì •í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” `Entity Manager` ë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸ë¥¼ ê²©ë¦¬í•˜ëŠ” ê²ƒì´ ìµœì„ ì˜ ë°©ë²•ìœ¼ë¡œ ë³´ì¸ë‹¤.\n\ní•˜ì§€ë§Œ, ì¶”í›„ì— ì´ë³´ë‹¤ ë” ì¢‹ì€ ë°©ë²•ì„ ë°œê²¬í•˜ë©´, ë©´ë°€íˆ ê²€í† í•´ë³´ê³  ë°”ê¿€ ì˜ì‚¬ê°€ ì¶©ë¶„í•˜ë‹¤ê³  ìƒê°í•œë‹¤.\n\n## ì°¸ê³ \n\nhttps://tecoble.techcourse.co.kr/post/2020-09-15-test-isolation/\n"},{"excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„ì˜ ê°€ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤. ë°°ê²½ ê´œì°®ì„ì§€ë„ ì„œë¹„ìŠ¤ëŠ” CI/CD íˆ´ë¡œ Github Actionsë¥¼ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.\n ìì„¸í•œ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ? ê´œì°®ì„ì§€ë„ CI/CD êµ¬ì¶•ê¸° ë°”ë¡œê°€ê¸° í”„ë¡œì íŠ¸ì˜ ì„¤ì • íŒŒì¼(.yml)ì€ DB ì£¼ì†Œ ë“± ë¯¼ê°í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆì—ˆê¸° ë•Œë¬¸ì—, ì´ë¥¼ ì €ì¥ì†Œì— ê·¸ëŒ€ë¡œ ì—…ë¡œë“œí•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.\nìœ„ ë¬¸ì œì ì„ í•´ê²°í•˜ê¸° ìœ„â€¦","fields":{"slug":"/trouble-shooting-actions-runner/"},"frontmatter":{"date":"July 31, 2023","title":"EC2 í™˜ê²½ ë³€ìˆ˜ ì ìš© ë° Actions Runnerì— í™˜ê²½ ë³€ìˆ˜ ì ìš©ì´ ì•ˆë˜ëŠ” ì´ìŠˆ","tags":["ì¸í”„ë¼","Actions Runner"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„ì˜ `ì¥¬ë‹ˆ`ê°€ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\n\n### ë°°ê²½\n\nê´œì°®ì„ì§€ë„ ì„œë¹„ìŠ¤ëŠ” CI/CD íˆ´ë¡œ Github Actionsë¥¼ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.\n<br> ìì„¸í•œ ë‚´ìš©ì´ ê¶ê¸ˆí•˜ë‹¤ë©´ ? [ê´œì°®ì„ì§€ë„ CI/CD êµ¬ì¶•ê¸° ë°”ë¡œê°€ê¸°](/contents/posts/github-actions-ci-cd/index.md)\n\ní”„ë¡œì íŠ¸ì˜ ì„¤ì • íŒŒì¼(.yml)ì€ DB ì£¼ì†Œ ë“± ë¯¼ê°í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆì—ˆê¸° ë•Œë¬¸ì—, ì´ë¥¼ ì €ì¥ì†Œì— ê·¸ëŒ€ë¡œ ì—…ë¡œë“œí•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.\n<br>ìœ„ ë¬¸ì œì ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ê³¼ì •ê³¼ ì‹¤ì œ ìš°ë¦¬ê°€ ì§ë©´í•œ ë¬¸ì œë¥¼ ì„¤ëª…í•´ ë“œë¦¬ê³ ì í•©ë‹ˆë‹¤.\n\n### í™˜ê²½ë³€ìˆ˜ ì ìš©\nê´œì°®ì„ì§€ë„ëŠ” í™˜ê²½ ë³€ìˆ˜ë¥¼ í™œìš©í•˜ì—¬ ë¯¼ê°í•œ ì •ë³´ë¥¼ ìˆ¨ê¸°ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.\nì´ì— ë”°ë¼, ê° ë°°í¬ í™˜ê²½(prod, dev)ì— ë§ëŠ” ì„¤ì • íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.\n```yaml\n# `application-dev`ì˜ ì¼ë¶€ \nspring:\n  datasource:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    url: ${MYSQL_DATABASE_URL} \n    username: ${MYSQL_DATABASE_USER_NAME}\n    password: ${MYSQL_DATABASE_PASSWORD}\n```\nì„¤ì • íŒŒì¼ì—ì„œ ì‚¬ìš©í•œ í™˜ê²½ ë³€ìˆ˜ëŠ” ê° EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ê´€ë¦¬í•˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.\n<br>EC2 ì¸ìŠ¤í„´ìŠ¤ì— í™˜ê²½ë³€ìˆ˜ë¥¼ ì ìš©í•˜ëŠ” ë°©ë²•ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.\n\n`1. EC2 í„°ë¯¸ë„ì— ì ‘ì†í•œë‹¤.`\n\n`2. 'sudo vim ~/.bashrc' ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•œë‹¤.`\n\n`3. .bashrc íŒŒì¼ì˜ ë§¨ ì•„ë˜ì— ì•„ë˜ì™€ ê°™ì´ í•„ìš”í•œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì…ë ¥í•œ ë’¤, ì €ì¥í•œë‹¤.`\n```shell\n# ...\n# ê¸°ì¡´ .bashrc ì½”ë“œ ìƒëµ \n#\n# Database\nexport profile='dev'\nexport MYSQL_DATABASE_URL='Database url'\nexport MYSQL_DATABASE_USER_NAME='User name'\nexport MYSQL_DATABASE_PASSWORD='Password'\n```\n\n`4. 'source ~/.bashrc' ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ í™˜ê²½ë³€ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸í•´ ì¤€ë‹¤.`\n\n`5. 'echo $profile' ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ í™˜ê²½ë³€ìˆ˜ê°€ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸í•œë‹¤.`\n\n### í™˜ê²½ ë³€ìˆ˜ê°€ Actions Runner ë™ì‘ì— ì ìš©ë˜ì§€ ì•ŠëŠ” ì´ìŠˆ\n\nìš°ë¦¬ëŠ” ìœ„ ê³¼ì •ì„ í†µí•´, í™˜ê²½ ë³€ìˆ˜ê°€ EC2ì— ì˜¬ë°”ë¥´ê²Œ ì ìš©ëœ ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.\n<br>ì‹¤ì œë¡œ, ì•„ë˜ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ê²½ìš° `profile`ë¡œ ì„¤ì •í•œ í™˜ê²½ë³€ìˆ˜ì¸ devê°€ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n```shell\n# $JAR_FILE_PATHëŠ” 'deploy.sh' íŒŒì¼ ë‚´ì— ì¡´ì¬í•˜ëŠ” jar íŒŒì¼ì˜ ê²½ë¡œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë³€ìˆ˜ì…ë‹ˆë‹¤.\nnohup sudo -E java -jar $JAR_FILE_PATH/mapbefine.jar --spring.profiles.active=$profile >> $JAR_FILE_PATH/deploy.log 2> $JAR_FILE_PATH/deploy-err.log &\n```\n![](.index_image/active-profile-dev.png)\n\ní•˜ì§€ë§Œ, Actions Runnerë¥¼ í†µí•´ CDë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²½ìš° ì•„ë˜ì™€ ê°™ì´ í™˜ê²½ ë³€ìˆ˜ê°€ ì ìš©ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n![](.index_image/active-profile-default.png)\n\n### ì›ì¸ ë° ë¬¸ì œ í•´ê²°\nìš°ë¦¬ëŠ” ìœ„ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´, ì•„ë˜ì™€ ê°™ì´ ìš°ë¦¬ì˜ ìƒí™©ì„ ì •ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.\n1. í„°ë¯¸ë„ì—ì„œ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ê²½ìš°, í™˜ê²½ ë³€ìˆ˜ê°€ ì ìš©ëœë‹¤.\n2. Actions Runnerë¥¼ í†µí•´ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ê²½ìš°, í™˜ê²½ë³€ìˆ˜ê°€ ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.\n3. CI/CDë¥¼ êµ¬ì¶•í•œ ë’¤ì— í™˜ê²½ ë³€ìˆ˜ë¥¼ ì ìš©í–ˆë‹¤.\n\nìœ„ ìƒí™©ì„ í†µí•´, ìš°ë¦¬ëŠ” í™˜ê²½ ë³€ìˆ˜ë¥¼ ì ìš©í•˜ê¸° ì „, ì´ë¯¸ ì‹¤í–‰ë˜ê³  ìˆì—ˆë˜ Actions Runnerì— í™˜ê²½ë³€ìˆ˜ê°€ ì ìš©ë˜ì§€ ì•Šì•˜ìŒì„ ì§ê°í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n<br>ì‹¤ì œë¡œ, í™˜ê²½ ë³€ìˆ˜ëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì‹œì‘ë  ë•Œ í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ì—ê²Œ ì œê³µë˜ëŠ” í™˜ê²½ ì„¤ì •ì˜ ì¼ë¶€ì´ê¸° ë•Œë¬¸ì—, ìœ„ì™€ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí•œ ê²ƒì´ì—ˆìŠµë‹ˆë‹¤.\n\nê¸°ì¡´ì— ì‹¤í–‰ë˜ê³  ìˆì—ˆë˜ Actions Runner í”„ë¡œì„¸ìŠ¤ë¥¼ ì¢…ë£Œí•œ í›„, ì¬ì‹œì‘ì„ í•˜ì˜€ê³  í™˜ê²½ ë³€ìˆ˜ê°€ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.\n"},{"excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„íŒ€ì˜ ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ë³´ë‹¤ í¸ë¦¬í•˜ê³  ì•ˆì •ì ì¸ ê°œë°œ ë° ë°°í¬ë¥¼ ìœ„í•´, ê´œì°®ì„ì§€ë„ ì„œë¹„ìŠ¤ì— CI/CDë¥¼ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤. ì´ë¥¼ ìœ„í•œ ë„êµ¬ë¡œ GitHub Actions(self hosted runner)ë¥¼ ì„ íƒí•œ ì´ìœ ì™€, íŒŒì´í”„ë¼ì¸, ì ìš© ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤. GitHub Actionsë¥¼ ì‚¬ìš©í•œ ì´ìœ  ë¨¼ì € ì €í¬ì˜ ìƒí™©ì„ ì„¤ëª…ë“œâ€¦","fields":{"slug":"/github-actions-ci-cd/"},"frontmatter":{"date":"July 29, 2023","title":"GitHub Actionsë¡œ CI/CD êµ¬ì¶•í•˜ê¸°","tags":["ì¸í”„ë¼"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„íŒ€ì˜ `ë„ì´`ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.\n\në³´ë‹¤ í¸ë¦¬í•˜ê³  ì•ˆì •ì ì¸ ê°œë°œ ë° ë°°í¬ë¥¼ ìœ„í•´, ê´œì°®ì„ì§€ë„ ì„œë¹„ìŠ¤ì— CI/CDë¥¼ ì ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.  \nì´ë¥¼ ìœ„í•œ ë„êµ¬ë¡œ GitHub Actions(self hosted runner)ë¥¼ ì„ íƒí•œ ì´ìœ ì™€, íŒŒì´í”„ë¼ì¸, ì ìš© ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.\n\n## GitHub Actionsë¥¼ ì‚¬ìš©í•œ ì´ìœ \n\në¨¼ì € ì €í¬ì˜ ìƒí™©ì„ ì„¤ëª…ë“œë¦¬ìë©´, \nì•„ë˜ì™€ ê°™ì€ ì œì•½ ì‚¬í•­ ì•ˆì—ì„œ ê°œë°œ ì„œë²„, ìš´ì˜ ì„œë²„ì˜ ë¶„ë¦¬ê°€ í•„ìš”í–ˆìŠµë‹ˆë‹¤.\n\n### ì œì•½ ì‚¬í•­\n- EC2 ìµœëŒ€ 3ê°œ\n- ìµœëŒ€ t4g.small\n- ìµœëŒ€ 20GiB\n- ë§¤ëª¨ë¦¬ 2GiB\n\nìš´ì˜ ì„œë²„ì—ì„œ ì‚¬ìš©í•˜ëŠ” DBëŠ” ì„œë²„ ë¶„ë¦¬ê°€ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨í•´, ì„¸ ëŒ€ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°ê° ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ ê°œë°œ, ìš´ì˜, ìš´ì˜ DB ì„œë²„ë¡œ ë¶„ë‹´í–ˆìŠµë‹ˆë‹¤.  \nê·¸ë¦¬ê³  ì´ ì œì•½ ì‚¬í•­ ì•ˆì—ì„œ ì•Œëœ°í•˜ê²Œ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ê³  íŠ¸ëŸ¬ë¸” ìŠˆíŒ…í•˜ëŠ” ê²ƒì„ ì €í¬ì˜ ê¸°ìˆ ì  ë„ì „ìœ¼ë¡œ ì‚¼ê³ ì í•©ë‹ˆë‹¤.\n\n### ì¸í”„ë¼ êµ¬ì¡°\n![](.index_image/infra.jpeg)\n \níŒ€ì›ë“¤ ëª¨ë‘ê°€ CI/CDì— ëŠ¥ìˆ™í•˜ì§€ ì•Šì€ ìƒí™©ì—ì„œ ìƒëŒ€ì ìœ¼ë¡œ ëŒ€ì¤‘ì ì´ê³  ê´€ë ¨ ìë£Œë¥¼ ì‰½ê²Œ ì ‘í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì„ ìƒê°í–ˆì„ ë•Œ,  \nJenkinsì™€ GitHub Actionsê°€ ê³ ë ¤ ëŒ€ìƒì´ì—ˆìŠµë‹ˆë‹¤.\n\nì•„ë˜ì™€ ê°™ì€ ì´ìœ ë¡œ, ë‘˜ ì¤‘ GitHub Actionsë¥¼ ì‚¬ìš©í•´ ìµœëŒ€í•œ ê°„ë‹¨í•˜ê²Œ CI/CDë¥¼ êµ¬ì¶•í•˜ëŠ” ê²ƒì´ ì í•©í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.  \n\n1. ë©”ëª¨ë¦¬ ë¶€ë‹´ ìµœì†Œí™”\n   - Jenkinsë¥¼ ì‚¬ìš©í•˜ë©´, EC2ì—ì„œ ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.\n   - ë°˜ë©´, GitHub ActionsëŠ” GitHub Artifactì— ì—…ë¡œë“œí•œ ë¹Œë“œ ê²°ê³¼ë¬¼ì„ EC2ì—ì„œ ë‹¤ìš´ë¡œë“œí•˜ë©´ ë©ë‹ˆë‹¤.\n   - ì‹¤ì œë¡œ í•œ íŒ€ì›ì´ EC2 t2g.microì— ì  í‚¨ìŠ¤ CI/CDë¥¼ ì ìš©í–ˆë‹¤ê°€, ë©”ëª¨ë¦¬ê°€ ë¶€ì¡±í•´ ì„œë²„ê°€ ì£½ëŠ” ê³¼ê±°ì˜ ê²½í—˜ì„ ê³µìœ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.\n   - ë•Œë¬¸ì— ì ì–´ë„ CI ë§Œí¼ì€ GitHub Actionsë¡œ ë¶„ë¦¬í•´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì„ ì™¸ë¶€ ì„œë¹„ìŠ¤ì— ìœ„ì„í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤.\n   - í•˜ì§€ë§Œ ê·¸ë ‡ë‹¤ë©´, ê°„ê²°í•œ íŒŒì´í”„ë¼ì¸ì„ ìœ„í•´ CI/CDë¥¼ ëª¨ë‘ GitHub Actionsë¡œ í†µí•©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.\n   > EC2ì—ì„œ `./gradlew build`ë¥¼ ìˆ˜í–‰í•´ ì§ì ‘ ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ë¥¼ í•  ê²½ìš° ì•„ë˜ì™€ ê°™ì´ ì´ 26.2%ì˜ ì‚¬ìš©ëŸ‰ì´ í™•ì¸ë˜ì§€ë§Œ,  \n   ![ec2-build-usage.png](.index_image/ec2-build-usage.png)\n   > ê·¸ ëŒ€ì‹  Actions Runnerê°€ ê°€ë™í•˜ëŠ” ìƒí™©ì„ í™•ì¸í•´ë³¸ ê²°ê³¼, ì „ì²´ ë©”ëª¨ë¦¬ì˜ ìµœëŒ€ 11.9%ë§Œì„ ì‚¬ìš©í•¨ì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.   \n   ![actions-runner-usage.png](.index_image/actions-runner-usage.png)\n   \n    \n2. ì‰½ê³  ë¹ ë¥¸ ì ìš© \n   - GitHub ë ˆí¬ì§€í† ë¦¬ì—ì„œ ë°”ë¡œ ì„¤ì •ì´ ê°€ëŠ¥í•´ ê¸°ì¡´ ê°œë°œ í™˜ê²½ê³¼ í†µí•©í•´ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.\n   - YAML íŒŒì¼ ì‘ì„±ë§Œìœ¼ë¡œë„ ì‰½ê³  ë¹ ë¥¸ ì ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n   - GitHubê°€ Runnerë¥¼ ê´€ë¦¬í•´ì£¼ê¸° ë•Œë¬¸ì—, ì„œë²„ ê´€ë¦¬ ë¶€ë‹´ì´ ëœí•©ë‹ˆë‹¤.\n  \n  \n## CI/CD íŒŒì´í”„ë¼ì¸\n![](.index_image/cicd-pipeline.jpeg)\nCI/CD íŒŒì´í”„ë¼ì¸ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.  \n1. Pull Requestì˜ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸, Pull Requestì— ëŒ€í•œ Mergeê°€ ë°œìƒí•©ë‹ˆë‹¤.\n2. ì´ë²¤íŠ¸ì— íŠ¸ë¦¬ê±°ëœ `GitHub Actions workflow`ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.\n3. `workflow`ì— ì‘ì„±í•œ ë‚´ìš©ì— ì˜í•´, `GitHub hosting Runner`ê°€ ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.\n   - ì´ ë•Œ, í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ PR ì½”ë©˜íŠ¸ë¡œ ë“±ë¡í•´ì¤ë‹ˆë‹¤.\n   - `Pull Requestì˜ ìƒì„± ë˜ëŠ” ì—…ë°ì´íŠ¸ì— ëŒ€í•œ workflow`ì˜ ê²½ìš° ì´ ë‹¨ê³„ê¹Œì§€ë§Œ ìˆ˜í–‰í•©ë‹ˆë‹¤.\n4. `Pull request Mergeì— ëŒ€í•œ workflow`ì˜ ê²½ìš°, ë¹Œë“œí•œ ê²°ê³¼ë¬¼ì„ GitHubì˜ ìì²´ ì €ì¥ì†Œì¸ `Artifact Storage`ì— ì—…ë¡œë“œí•©ë‹ˆë‹¤.\n5. ìš°ë¦¬ì˜ `EC2`ì— ì„¤ì¹˜ëœ `Self Hosted Runner`ê°€ 4ë²ˆì˜ ê²°ê³¼ë¬¼ì„ ë‹¤ìš´ë¡œë“œ ë°›ìŠµë‹ˆë‹¤.\n6. `Self Hosted Runner`ê°€ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê²Œ í•˜ì—¬, í•„ìš”í•œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ê³  ì •ì  íŒŒì¼ì„ ì ì ˆí•œ ìœ„ì¹˜ì— ë°°ì¹˜í•©ë‹ˆë‹¤.\n\n2ë²ˆë¶€í„° 6ë²ˆê¹Œì§€, ëª¨ë‘ í•˜ë‚˜ì˜ workflow ë‚´ì—ì„œ ë²Œì–´ì§€ëŠ” ì¼ì…ë‹ˆë‹¤.\n\n## ì ìš© ë°©ë²•\n\n### GitHub Actions workflow\n`workflow`ë€ í•˜ë‚˜ ì´ìƒì˜ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ”, ìë™í™”ëœ í”„ë¡œì„¸ìŠ¤ì…ë‹ˆë‹¤.  \në ˆí¬ì§€í† ë¦¬ì˜ `.github/workflows` ë””ë ‰í† ë¦¬ì— YAML íŒŒì¼ì„ ì €ì¥í•´ `workflow` ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\ní•˜ë‚˜ì˜ ë ˆí¬ì§€í† ë¦¬ëŠ” ì—¬ëŸ¬ ê°œì˜ `workflow`ë¥¼ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nê´œì°®ì„ì§€ë„ ì„œë¹„ìŠ¤ì—ì„œëŠ”\n1. `pull request`ì— ëŒ€í•œ ë¹Œë“œ ë° í…ŒìŠ¤íŠ¸ë§Œ ìˆ˜í–‰í•˜ëŠ” ìƒí™© vs `pull request merge` ì‹œ ë°°í¬ê¹Œì§€ ìˆ˜í–‰í•˜ëŠ” ìƒí™©\n2. ëŒ€ìƒì´ `main` ë¸Œëœì¹˜ vs `dev` ë¸Œëœì¹˜\n3. ëŒ€ìƒì´ í”„ë¡ íŠ¸ì—”ë“œ / ë°±ì—”ë“œ\n\nì„¸ ê°€ì§€ ìƒí™©ì„ ê³ ë ¤í•˜ì—¬ ì—¬ëŸ¬ ê°œì˜ `workflow`ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.  \n\n![](.index_image/workflows-dev.jpeg)\n![](.index_image/workflows-prod.jpeg)\n\n### workflow ë§Œë“¤ê¸°\n`workflow`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ ìš”ì†Œë“¤ì„ ê°€ì ¸ì•¼ í•©ë‹ˆë‹¤.\n1. `workflow`ë¥¼ ìœ ë°œì‹œí‚¬ í•˜ë‚˜ ì´ìƒì˜ ì´ë²¤íŠ¸ : `on`\n2. `workflow`ì—ì„œ ìˆ˜í–‰í•  í•˜ë‚˜ ì´ìƒì˜ ì‘ì—…: `job`\n3. `job` ë¸”ë¡ ë‚´ì— ë‹¨ê³„ ë³„ ìŠ¤í¬ë¦½íŠ¸ ë˜ëŠ” ìµìŠ¤í…ì…˜ ì‹¤í–‰ì„ ì •ì˜: `step`\n\nì—¬ê¸°ì„œ ì£¼ì˜í•  ì ì€, ì—¬ëŸ¬ê°œì˜ `job`ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë³‘ë ¬ì ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.  \nìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ê³  ì‹¶ë‹¤ë©´, `needs` ë¸”ë¡ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.  \n\n\nì•„ë˜ëŠ” í˜„ì¬ ì ìš©ëœ workflowì…ë‹ˆë‹¤. ì´í•´ë¥¼ ë•ê¸° ìœ„í•´ ì£¼ì„ì„ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.  \n### ë°±ì—”ë“œ CI workflow\n```yaml\nname: Backend CI For Test Validation\n\n# íŠ¸ë¦¬ê±° ì„¤ì •\non:\n  workflow_dispatch:\n  \n  pull_request:\n    branches: [ main, develop ]\n    paths: backend/** # í•´ë‹¹ ë””ë ‰í† ë¦¬ ë‚´ íŒŒì¼ì˜ ë³€ê²½ì´ ìˆì„ ë•Œë§Œ íŠ¸ë¦¬ê±°ë¨\n\n# í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë“±ë¡ì„ ìœ„í•œ ê¶Œí•œ ì„¤ì •\npermissions: \n  pull-requests: write\n  checks: write\n  contents: write\n  \n# ìˆ˜í–‰í•  ì‘ì—…ë“¤\njobs:\n  build-and-comment:\n    # í•´ë‹¹ jobì„ ì‹¤í–‰í•  í™˜ê²½ ì„¤ì •\n    runs-on: ubuntu-22.04\n\n    steps:\n    - uses: actions/checkout@v3\n    - name: Set up JDK 17\n      uses: actions/setup-java@v3\n      with:\n        java-version: '17'\n        distribution: 'temurin'\n        \n    - name: gradlew ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬\n      run: chmod +x gradlew\n      working-directory: backend\n\n    - name: Gradle build ì‹œì‘\n      run: ./gradlew clean build\n      working-directory: backend\n\n    - name: í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ PRì— ì½”ë©˜íŠ¸ë¡œ ë“±ë¡í•©ë‹ˆë‹¤\n      uses: EnricoMi/publish-unit-test-result-action@v1\n      if: always()\n      with:\n        files: 'backend/build/test-results/test/TEST-*.xml'\n\n    - name: í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ, ì‹¤íŒ¨í•œ ì½”ë“œ ë¼ì¸ì— Check ì½”ë©˜íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤\n      uses: mikepenz/action-junit-report@v3\n      if: always()\n      with:\n        report_paths: '**/build/test-results/test/TEST-*.xml'\n        token: ${{ github.token }}\n```\n\n### ë°±ì—”ë“œ CD workflow\n```yaml\nname: Backend develop CI/CD\n\non:\n  workflow_dispatch:\n  \n  pull_request:\n     # ë°°í¬ ì„¤ì •ì€ main, develop ë¸Œëœì¹˜ ë³„ë¡œ ë‹¤ë¥´ê²Œ íŠ¸ë¦¬ê±°\n    branches: [ develop ]\n     # ë¸Œëœì¹˜ê°€ ë‹«í ë•Œë§Œ íŠ¸ë¦¬ê±°\n    types: [closed]\n    paths: backend/**\n\npermissions:\n  contents: read\n  \njobs:\n  build-and-upload:    \n    # Pull Requestë¥¼ ê·¸ëƒ¥ ë‹«ì€ ê²Œ ì•„ë‹ˆë¼, mergeí•´ì„œ ë‹«ì•˜ì„ ë•Œë§Œ ì‹¤í–‰\n    if: github.event.pull_request.merged\n    \n    runs-on: ubuntu-22.04\n\n    steps:\n    - uses: actions/checkout@v3\n    - name: Set up JDK 17\n      uses: actions/setup-java@v3\n      with:\n        java-version: '17'\n        distribution: 'temurin'\n        \n    - name: gradlew ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬\n      run: chmod +x gradlew\n      working-directory: backend\n\n    - name: Gradle build ì‹œì‘\n      run: ./gradlew clean build\n      working-directory: backend\n        \n    - name: jar íŒŒì¼ artifactì— ì—…ë¡œë“œ\n      uses: actions/upload-artifact@v3\n      with:\n        name: BackendApplication\n        path: backend/build/libs/mapbefine.jar\n\n  deploy:\n     # Pull Requestë¥¼ ê·¸ëƒ¥ ë‹«ì€ ê²Œ ì•„ë‹ˆë¼, mergeí•´ì„œ ë‹«ì•˜ì„ ë•Œë§Œ ì‹¤í–‰\n     if: github.event.pull_request.merged\n\n     # deployëŠ” build-and-upload ì‘ì—…ê³¼ ë‹¬ë¦¬ self-hosted runnerë¥¼ ì‚¬ìš©\n     # main, develop ë¸Œëœì¹˜ë§ˆë‹¤ ê°ê° ìš´ì˜ ì„œë²„, ê°œë°œ ì„œë²„ì˜ runnerë§Œì„ ì‹¤í–‰í•˜ë„ë¡ í•´ì•¼ í•¨\n     runs-on: [ self-hosted, dev ]ë¥¼\n     # build-and-upload ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë  ê²½ìš° ì‹¤í–‰\n     needs: build-and-upload\n  \n     steps:\n      - name: êµ¬ë²„ì „ jar íŒŒì¼ ì‚­ì œ\n        run: rm -rf /home/ubuntu/backend/build/*.jar \n\n      - name: jaríŒŒì¼ artifactì—ì„œ ë‹¤ìš´ë¡œë“œ\n        uses: actions/download-artifact@v3 \n        with:\n          name: BackendApplication\n          path: /home/ubuntu/backend/build/\n\n      - name: ë°°í¬í•˜ê¸°\n        run: /home/ubuntu/backend/deploy.sh\n\n      - name: ìŠ¬ë™ ë©”ì‹œì§€ ë³´ë‚´ê¸°\n\n        uses: 8398a7/action-slack@v3\n        with:\n          mention: 'here'\n          if_mention: always\n          status: ${{ job.status }}\n          fields: workflow,job,commit,message,ref,author,took\n        env:\n          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}\n        if: always()\n```\n\n### í”„ë¡ íŠ¸ì—”ë“œ CI workflow\n```yaml\nname: Frontend CI For Test Validation\n# ì–´ë–¤ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ ì‹¤í–‰í• ì§€ ê²°ì •\non:\n  #pull request openê³¼ reopen ì‹œ ì‹¤í–‰í•œë‹¤.\n  pull_request:\n    branches: [main, develop]\n    paths: frontend/**\ndefaults:\n  run:\n    working-directory: ./frontend\njobs:\n  jest:\n    runs-on: ubuntu-22.04\n\n    steps:\n      - name: Checkout repository\n        uses: actions/checkout@v2\n\n      - name: Setup Node.js\n        uses: actions/setup-node@v2\n        with:\n          node-version: \"18\"\n\n      - name: Install node modules\n        run: npm install\n\n      - name: Run Jest test\n        run: npm run test\n```\n\n### í”„ë¡ íŠ¸ì—”ë“œ CD workflow\n```yaml\nname: Frontend develop CD\n\non:\n  workflow_dispatch:\n\n  pull_request:\n    branches: [ develop ]\n    types: [ closed ]\n    paths: frontend/**\n\npermissions:\n  contents: read\n\njobs:\n  build-and-upload:\n    if: github.event.pull_request.merged\n\n    runs-on: ubuntu-22.04\n\n    steps:\n      - uses: actions/checkout@v3\n      - name: Set up Node.js 18\n        uses: actions/setup-node@v3\n        with:\n          node-version: 18\n          cache: \"npm\"\n\n      - name: Install npm\n        run: npm install --force\n\n      - name: grant excute access\n        run: chmod +x npm\n\n      - name: Build project\n        run: npm run build\n\n      - name: upload to artifact\n        uses: actions/upload-artifact@v3\n        with:\n          name: FrontendApplication\n          path: frontend/dist\n\n  deploy:\n      runs-on: [ self-hosted, dev ]\n      needs: build-and-upload\n\n      if: github.event.pull_request.merged\n\n      steps:\n        - name: delete old js file\n          run: rm -rf /home/ubuntu/frontend/dist\n\n        - name: download js file from artifact\n          uses: actions/download-artifact@v3\n          with:\n            name: FrontendApplication\n            path: /home/ubuntu/frontend\n\n        - name: deploy\n          run: /home/ubuntu/frontend/deploy.sh\n\n        - name: send slack message\n\n          uses: 8398a7/action-slack@v3\n          with:\n            mention: 'here'\n            if_mention: always\n            status: ${{ job.status }}\n            fields: workflow,job,commit,message,ref,author,took\n          env:\n            SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}\n          if: always()\n\n```\n\n## Self-hosted Runner \nì•ì„œ ë§ì”€ë“œë¦° íŒŒì´í”„ë¼ì¸ ëŒ€ë¡œ ë°°í¬ë¥¼ í•˜ê¸° ìœ„í•´ì„œëŠ”, ë°°í¬ë¥¼ í•  ì„œë²„ì— `GitHub Actions`ì˜ `Self-hosted Runner`ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.  \n\nì•ì„œ ì„¤ëª…ë“œë¦° `workflow`ëŠ” GitHubì—ì„œ í˜¸ìŠ¤íŒ…í•˜ëŠ” Runnerê°€ ìˆ˜í–‰í•  ìˆ˜ë„ ìˆì§€ë§Œ,  \nì›í•˜ëŠ” ì„œë²„ì— ìì²´ì ìœ¼ë¡œ Runnerë¥¼ í˜¸ìŠ¤íŒ…í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.\n\nworkflowì˜ `runs-on` ë¸”ë¡ì—ì„œ ì–´ë–¤ Runnerë¥¼ í†µí•´ ì‘ì—…ì„ ìˆ˜í–‰í• ì§€ ì •ì˜í•©ë‹ˆë‹¤.\n\n\n\n### EC2ì— Self-hosted Runner ë„ìš°ê¸°\n\n#### 1. ë‹¤ìš´ë¡œë“œ  \në ˆí¬ì§€í† ë¦¬ì˜ `Settings` - `Actions` - `Runners`ì— ë“¤ì–´ê°€ë©´ `New self-hosted runner` ë²„íŠ¼ì´ ìˆìŠµë‹ˆë‹¤.  \n![create-runner.png](.index_image/create-runner.png)\në²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì•„ë˜ì™€ ê°™ì€ ì„¤ì • í˜ì´ì§€ë¡œ ì ‘ì†í•˜ëŠ”ë°, Runnerë¥¼ ë„ìš¸ ì„œë²„ í™˜ê²½ì— ë§ëŠ” ì„¤ì •ì„ ì„ íƒí•´ì¤ë‹ˆë‹¤.  \n   ![architecture-runner.png](.index_image/architecture-runner.png)\ní•´ë‹¹ í™˜ê²½ì˜ í„°ë¯¸ë„ì—ì„œ runner packageë¥¼ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤. ì„ íƒí•œ ì„¤ì •ì— ë§ê²Œ ì œê³µëœ ì»¤ë§¨ë“œë¥¼ ë³µì‚¬í•´ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.  \n   ![download-runner.png](.index_image/download-runner.png)   \n\nì•„ë˜ëŠ” Linux, ARM64 í™˜ê²½ì˜ runnerë¥¼ ë‹¤ìš´ë¡œë“œë°›ê¸° ìœ„í•œ ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.  \n  ```shell\n  # Create a folder\n  $ mkdir actions-runner && cd actions-runner\n  # Download the latest runner package\n  $ curl -o actions-runner-linux-arm64-2.307.1.tar.gz -L https://github.com/actions/runner/releases/download/v2.307.1/actions-runner-linux-arm64-2.307.1.tar.gz\n  # Optional: Validate the hash\n  $ echo \"01edc84342ef4128a8f19bc2f33709b40f2f1c40e250e2a4c5e0adf620044ab3  actions-runner-linux-arm64-2.307.1.tar.gz\" | shasum -a 256 -c\n  # Extract the installer\n  $ tar xzf ./actions-runner-linux-arm64-2.307.1.tar.gz\n  ```\n   \n#### 2. Runner ìƒì„± ë° ì„¤ì •\në§ˆì°¬ê°€ì§€ë¡œ ì œê³µëœ ìŠ¤í¬ë¦½íŠ¸ì— ë”°ë¼, runnerë¥¼ ìƒì„±í•˜ê³  ì„¤ì •í•©ë‹ˆë‹¤.  \n![configure-runner.png](.index_image/configure-runner.png)\në¨¼ì € ì•„ë˜ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•˜ë©´, ì•„ë˜ì™€ ê°™ì´ Runner í™˜ê²½ ì„¤ì •ì„ ìœ„í•´ ëª‡ ê°€ì§€ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.  \n```shell\n$ ./config.sh --url ${repository URL} --token ${runner ìƒì„± í˜ì´ì§€ì—ì„œ ì œê³µëœ í† í°}\n```\n![runner-registration.png](.index_image/runner-registration.png)\n\nìœ„ ì´ë¯¸ì§€ì²˜ëŸ¼ name, ì¶”ê°€ labelì„ ì§€ì •í•˜ê³  ì„¤ì¹˜í•œ runnerë¥¼ í™•ì¸í•˜ë©´, ë‹¤ìŒê³¼ ê°™ì´ `dev` ë¼ë²¨ì´ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n![runner-label.png](.index_image/runner-label.png)\n> âš ï¸ ê°œì¸ ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ë¡œ ë§Œë“  ì˜ˆì‹œ ì´ë¯¸ì§€ë¡œ, ì‹¤ì œ ì„œë¹„ìŠ¤ì˜ ìš´ì˜ í™˜ê²½ê³¼ëŠ” ìƒì´í•©ë‹ˆë‹¤.\n\në” ë¹ ë¥¸ ì„¤ì •ì„ ì›í•œë‹¤ë©´, ì•„ë˜ì™€ ê°™ì´ `./config.sh` ì‹¤í–‰ ì‹œ ì›í•˜ëŠ” ê°’ë“¤ì„ ë°”ë¡œ ì „ë‹¬í•´ì¤˜ë„ ë©ë‹ˆë‹¤.\n```shell\n$ ./config.sh --url ${repository URL} --token ${runner ìƒì„± í˜ì´ì§€ì—ì„œ ì œê³µëœ í† í°} --name test --labels dev\n```\n\n   > **labelì„ ì™œ ì¶”ê°€í–ˆì„ê¹Œìš”?**    \n   ê° Runnerë¥¼ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” labelì„ ì§€ì •í•´ì„œ `runs-on` ë¸”ë¡ì—ì„œ ì–´ë–¤ Runnerì—ê²Œ ì¼ì„ ì‹œí‚¬ì§€ ëª…ì‹œí•˜ê¸° ìœ„í•¨ì…ë‹ˆë‹¤.  \n   ê´œì°®ì„ì§€ë„ íŒ€ì€ í•œ ë¦¬í¬ì§€í† ë¦¬ì—ì„œ ìš´ì˜ ì„œë²„, ê°œë°œ ì„œë²„ì— ê°ê° ë„ìš¸ ë‘ ê°œì˜ Runnerë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—\n   ì´ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•œ `dev`, `prod` labelì„ ì§€ì •í•˜ì˜€ìŠµë‹ˆë‹¤.  \n   ì•„ë˜ëŠ” `dev`, `self-hosted` ë¼ë²¨ì„ ê°€ì§„ runnerë¥¼ ì§€ì •í•˜ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.\n   ```YAML\n   runs-on: [ self-hosted, dev ]\n   ```\n   > **ì´ë¯¸ ìƒì„±í•œ Runnerì— labelì„ ì¶”ê°€í•˜ë ¤ë©´?**  \n   GitHub ê³µì‹ë¬¸ì„œì— ë”°ë¥´ë©´, 2023ë…„ 2ì›”ë¶€í„° GUIë¡œ labelì„ ì¶”ê°€í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤.    \n   config.sh íŒŒì¼ì„ ìˆ˜ì •í•´ ì„¤ì •í•  ìˆ˜ë„ ì—†ìŠµë‹ˆë‹¤.    \n   ëŒ€ì‹  GitHubì—ì„œ ì œê³µí•˜ëŠ” \"Self-hosted runners\" REST APIë¥¼ ì‚¬ìš©í•´ ì¶”ê°€í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.\n\n#### 3. Runner ì‹¤í–‰\n   Runner ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆë‹¤ë©´, ì•„ë˜ ëª…ë ¹ì–´ë¡œ Runnerë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.  \n   ë ˆí¬ì§€í† ë¦¬ì˜ `Settings` - `Actions` - `Runners` í˜ì´ì§€ì—ì„œ Statusê°€ `idle`ë¡œ ë°”ë€Œì—ˆë‹¤ë©´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ëœ ê²ƒì…ë‹ˆë‹¤.\n   ```shell\n   $ ./run.sh\n   ```\n\nì°¸ê³ ë¡œ ì„œë²„ ë‚´ ì €ì¥í•œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì—…ë°ì´íŠ¸ í–ˆì„ ë•Œì—ëŠ”, Runnerë„ ì¬ì‹œì‘í•˜ê¸°ë¥¼ ìŠì§€ ë§ˆì„¸ìš”!  \nì™œì¼ê¹Œìš”? ìì„¸í•œ ë‚´ìš©ì€  \n[EC2 í™˜ê²½ ë³€ìˆ˜ ì ìš© ë° Actions Runnerì— í™˜ê²½ ë³€ìˆ˜ ì ìš©ì´ ì•ˆë˜ëŠ” ì´ìŠˆ](https://map-befine-official.github.io/trouble-shooting-actions-runner)ì—ì„œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n\n## ì°¸ê³  ìë£Œ\nhttps://docs.github.com/ko/actions/using-workflows/about-workflows  \nhttps://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/about-self-hosted-runners  \nhttps://docs.github.com/en/actions/hosting-your-own-runners/managing-self-hosted-runners/using-labels-with-self-hosted-runners  \n"},{"excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„íŒ€ì˜ ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ì²« ê¸€ì€ í¬ìŠ¤íŠ¸ ì‘ì„±ë²•ì— ëŒ€í•´ì„œ ë‹¤ë£¨ì–´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. Repository Local ë¡œ Clone í•´ì˜¤ê¸° ë³¸ì¸ì´ ì›í•˜ëŠ” Directory ë¡œ ì´ë™í•´  ìœ„ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ ìš°ë¦¬ íŒ€ì˜ Repository ë¥¼ Local ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤. ê¸€ ì‘ì„±í•˜ê¸° Repository ë¥¼ Local ë¡œ ê°€ì ¸ì˜¤ì…¨ë‹¤ë©´, â€¦","fields":{"slug":"/how-to-write-a-post/"},"frontmatter":{"date":"July 24, 2023","title":"í¬ìŠ¤íŠ¸ ì‘ì„± ë°©ë²•","tags":["ë¸”ë¡œê·¸"]},"rawMarkdownBody":"\n> ì´ ê¸€ì€ ìš°í…Œì½” ê´œì°®ì„ì§€ë„íŒ€ì˜ `ë§¤íŠœ`ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.\n\nì²« ê¸€ì€ í¬ìŠ¤íŠ¸ ì‘ì„±ë²•ì— ëŒ€í•´ì„œ ë‹¤ë£¨ì–´ë³´ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.\n\n### Repository Local ë¡œ Clone í•´ì˜¤ê¸° \n\në³¸ì¸ì´ ì›í•˜ëŠ” Directory ë¡œ ì´ë™í•´ \n\n```shell\ngit clone https://github.com/map-befine-official/map-befine-official.github.io \n``` \n\nìœ„ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ ì´ìš©í•˜ì—¬ ìš°ë¦¬ íŒ€ì˜ Repository ë¥¼ Local ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.\n\n## ê¸€ ì‘ì„±í•˜ê¸°\n\nRepository ë¥¼ Local ë¡œ ê°€ì ¸ì˜¤ì…¨ë‹¤ë©´, ì´ì œ ê¸€ì„ ì‘ì„±í•´ë´…ì‹œë‹¤!\n\n```shell\ncd map-befine-official.github.io\n```\n\nìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ map-befine-official.github.io ì— Directory ì— ë“¤ì–´ê°€ì£¼ì‹œë©´ Contents Directory ê°€ ë³´ì´ì‹¤ ê²ë‹ˆë‹¤.\n\nì—¬ê¸°ì„œ \n\n```shell\ncd contents/posts\n```\n\nìœ„ ëª…ë ¹ì–´ë¥¼ í†µí•´ contents/posts ë””ë ‰í† ë¦¬ ë‚´ë¶€ê¹Œì§€ ê°€ê³ \n\në³¸ì¸ì´ ì‘ì„±í•˜ê³ ì í•˜ëŠ” ì£¼ì œì— ê±¸ë§ëŠ” ì´ë¦„ìœ¼ë¡œ Directory ë¥¼ ìƒì„±í•œ í›„, ë§Œë“œì‹  Directoryê¹Œì§€ ë“¤ì–´ê°€ì£¼ì„¸ìš”\n\nì € ê°™ì€ ê²½ìš°ëŠ” Directory ëª…ì„ how-to-write-a-post ë¡œ ì§€ì—ˆê¸° ë•Œë¬¸ì—\n\n```shell\ncd how-to-write-a-post\n```\n\nìœ„ì™€ ê°™ì€ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì´ë™ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.\n\n![](.index_image/command.png)\n\nì—¬ê¸°ì„œë¶€í„° ì´ì œ `index.md` íŒŒì¼ì„ ë§Œë“¤ì–´ ì‘ì„±í•˜ì‹¤ ê¸€ì„ Markdown í˜•ì‹ìœ¼ë¡œ ì‘ì„± í•´ì£¼ì‹œë©´ë˜ê³ , `.index_image` ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ Directory ë§Œë“¤ì–´ í•´ë‹¹ Directory ì— ì´ë¯¸ì§€ íŒŒì¼ì„ ë„£ì–´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤.\n\nì˜ ë”°ë¼ì˜¤ì…¨ë‹¤ë©´ ìµœì¢…ì ìœ¼ë¡œ ì´ëŸ° êµ¬ì¡°ê°€ ë‚˜ì˜¬ê²ë‹ˆë‹¤!\n\n![](.index_image/directory_structure.png)\n\n## ê¸€ ì˜¬ë¦¬ê¸°!\n\nê¸€ì„ ëª¨ë‘ ì‘ì„±í•˜ì…¨ë‹¤ë©´ ì´ì œ ì˜¬ë¦¬ê¸°ë§Œ í•˜ë©´ ë  ê²ë‹ˆë‹¤.\n\nì•„ì£¼ ì‰½ìŠµë‹ˆë‹¤.\n\nê·¸ëƒ¥ main ë¸Œëœì¹˜ì— push ë¥¼ í•˜ì‹œë©´ë¼ìš”!\n\n`.github/workflows/deploy.yml` ë¡œ ì¸í•´ì„œ push ë§Œ í•˜ì…”ë„ ë°°í¬ ë ê²ë‹ˆë‹¤.\n\nì•¼ë¬¼ë”±ì§€ì£ ?\n\nìš°ë¦¬ ê¸€ë„ í•œë²ˆ ì•¼ë¬´ì§€ê²Œ ì¨ë´…ì‹œë‹¤!\n\n## ê¸€ì˜ ì œëª© ì‘ì„±í•˜ê¸°\n\nê¸€ì˜ ì„œë‘ì— \n\n```text\n---\ntitle: \"ì œëª©\"\ndescription: \"ì„¤ëª…\"\ndate: \"ì‘ì„± ë‚ ì§œ\"\nupdate: \"ìˆ˜ì • ë‚ ì§œ\"\ntags:\n  - íƒœê·¸ë“¤\n  - ...\n---\n```\n\nì´ëŸ° ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì…”ì•¼ì§€ \n\n![](.index_image/title.png)\n\nìœ„ì—ì„œ ë³´ì‹œëŠ” ë°”ì™€ ê°™ì´ í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n## ì´ë¯¸ì§€ ì‚½ì…\n\nì´ë¯¸ì§€ë¥¼ ì‚½ì…í•˜ì‹œê³  ì‹¶ìœ¼ì‹œë‹¤ë©´, \n\nì €ì˜ ê°€ì´ë“œë¥¼ ëª¨ë‘ ì˜ ë”°ë¥´ì…¨ë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ, .index_image ë‚´ë¶€ì— image íŒŒì¼ì„ ë„£ê³ \n\n```text\n![](.index_image/{ì´ë¯¸ì§€ íŒŒì¼ ëª…})\n```\n\nì´ëŸ° ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì‹œë©´ ì´ë¯¸ì§€ë„ ì •ìƒì ìœ¼ë¡œ ì‚½ì…í•˜ì‹¤  ìˆ˜ ìˆìŠµë‹ˆë‹¤!\n\n## ì£¼ì˜!\n\në‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ ì •ì„±ìŠ¤ëŸ° ê¸€ì„ ë‚ ë¦¬ì§€ ì•Šê¸° ìœ„í•´, í•­ìƒ Push ì´ì „ì— Pull í•´ì£¼ëŠ” ê±° ìŠì§€ ì•Šìœ¼ì…¨ì£ ? ã…‹ã…‹ã…‹\n\në¬¼ë¡  Warning Message ê°€ ëœ¨ê¸´ í• í…Œì§€ë§Œ, ìŠì§€ ë§ì•„ì£¼ì„¸ìš©~~~\n\n## ë ˆí¼ëŸ°ìŠ¤ \n\nhttps://pium-official.github.io/blog-starter/\n\n\n"}]}},"pageContext":{}},"staticQueryHashes":[],"slicesMap":{}}