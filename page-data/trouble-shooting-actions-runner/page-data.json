{"componentChunkName":"component---src-templates-post-jsx","path":"/trouble-shooting-actions-runner/","result":{"data":{"site":{"siteMetadata":{"title":"괜찮을지도"}},"markdownRemark":{"id":"45b7dc00-ae71-58e4-9dc2-7aff92f0ca0d","excerpt":"이 글은 우테코 괜찮을지도의 가 작성하였습니다. 배경 괜찮을지도 서비스는 CI/CD 툴로 Github Actions를 적용하였습니다.\n 자세한 내용이 궁금하다면 ? 괜찮을지도 CI/CD 구축기 바로가기 프로젝트의 설정 파일(.yml)은 DB 주소 등 민감한 정보를 담고 있었기 때문에, 이를 저장소에 그대로 업로드할 수 없었습니다.\n위 문제점을 해결하기 위…","html":"<blockquote>\n<p>이 글은 우테코 괜찮을지도의 <code class=\"language-text\">쥬니</code>가 작성하였습니다.</p>\n</blockquote>\n<h3>배경</h3>\n<p>괜찮을지도 서비스는 CI/CD 툴로 Github Actions를 적용하였습니다.\n<br> 자세한 내용이 궁금하다면 ? <a href=\"/contents/posts/github-actions-ci-cd/index.md\">괜찮을지도 CI/CD 구축기 바로가기</a></p>\n<p>프로젝트의 설정 파일(.yml)은 DB 주소 등 민감한 정보를 담고 있었기 때문에, 이를 저장소에 그대로 업로드할 수 없었습니다.\n<br>위 문제점을 해결하기 위한 과정과 실제 우리가 직면한 문제를 설명해 드리고자 합니다.</p>\n<h3>환경변수 적용</h3>\n<p>괜찮을지도는 환경 변수를 활용하여 민감한 정보를 숨기기로 했습니다.\n이에 따라, 각 배포 환경(prod, dev)에 맞는 설정 파일을 아래와 같이 작성하였습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token comment\"># `application-dev`의 일부 </span>\n<span class=\"token key atrule\">spring</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">datasource</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">driver-class-name</span><span class=\"token punctuation\">:</span> com.mysql.cj.jdbc.Driver\n    <span class=\"token key atrule\">url</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>MYSQL_DATABASE_URL<span class=\"token punctuation\">}</span> \n    <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>MYSQL_DATABASE_USER_NAME<span class=\"token punctuation\">}</span>\n    <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span>MYSQL_DATABASE_PASSWORD<span class=\"token punctuation\">}</span></code></pre></div>\n<p>설정 파일에서 사용한 환경 변수는 각 EC2 인스턴스에서 관리하도록 하였습니다.\n<br>EC2 인스턴스에 환경변수를 적용하는 방법은 아래와 같습니다.</p>\n<p><code class=\"language-text\">1. EC2 터미널에 접속한다.</code></p>\n<p><code class=\"language-text\">2. 'sudo vim ~/.bashrc' 명령어를 입력한다.</code></p>\n<p><code class=\"language-text\">3. .bashrc 파일의 맨 아래에 아래와 같이 필요한 환경변수를 입력한 뒤, 저장한다.</code></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># ...</span>\n<span class=\"token comment\"># 기존 .bashrc 코드 생략 </span>\n<span class=\"token comment\">#</span>\n<span class=\"token comment\"># Database</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">profile</span><span class=\"token operator\">=</span><span class=\"token string\">'dev'</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">MYSQL_DATABASE_URL</span><span class=\"token operator\">=</span><span class=\"token string\">'Database url'</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">MYSQL_DATABASE_USER_NAME</span><span class=\"token operator\">=</span><span class=\"token string\">'User name'</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">MYSQL_DATABASE_PASSWORD</span><span class=\"token operator\">=</span><span class=\"token string\">'Password'</span></code></pre></div>\n<p><code class=\"language-text\">4. 'source ~/.bashrc' 명령어를 입력하여 환경변수를 업데이트해 준다.</code></p>\n<p><code class=\"language-text\">5. 'echo $profile' 명령어를 입력하여 환경변수가 적용되었는지 확인한다.</code></p>\n<h3>환경 변수가 Actions Runner 동작에 적용되지 않는 이슈</h3>\n<p>우리는 위 과정을 통해, 환경 변수가 EC2에 올바르게 적용된 것을 확인했습니다.\n<br>실제로, 아래와 같은 명령어를 통해 어플리케이션을 실행할 경우 <code class=\"language-text\">profile</code>로 설정한 환경변수인 dev가 올바르게 적용되는 것을 확인할 수 있었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># $JAR_FILE_PATH는 'deploy.sh' 파일 내에 존재하는 jar 파일의 경로를 나타내는 변수입니다.</span>\n<span class=\"token function\">nohup</span> <span class=\"token function\">sudo</span> <span class=\"token parameter variable\">-E</span> <span class=\"token function\">java</span> <span class=\"token parameter variable\">-jar</span> <span class=\"token variable\">$JAR_FILE_PATH</span>/mapbefine.jar <span class=\"token parameter variable\">--spring.profiles.active</span><span class=\"token operator\">=</span><span class=\"token variable\">$profile</span> <span class=\"token operator\">>></span> <span class=\"token variable\">$JAR_FILE_PATH</span>/deploy.log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span> <span class=\"token variable\">$JAR_FILE_PATH</span>/deploy-err.log <span class=\"token operator\">&amp;</span></code></pre></div>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/aeefe9b57b1e8d4ae02a373d8e985894/d50f3/active-profile-dev.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 16.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAlklEQVR42nVO0Q6DIBDzRQHRRFQIczFOUED///+6gyW+7aFpr9f0rpq1gRonjASlxsJd34Mx9hdtKyG7DlJK0i2EEOCcF1TL8sa+O1j7gqbyPA/DgLquKcBKiDH+cNM0j5+LhOC/Q6VQoEop4bouxJgQQiR9QxuDaZ7hnIPzDsdx4DxPbJ+N/AnruhbPe18yeRdioKcsvv8eSSlotqJIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='active profile dev' title='' src='/static/aeefe9b57b1e8d4ae02a373d8e985894/ca1dc/active-profile-dev.png' srcset='/static/aeefe9b57b1e8d4ae02a373d8e985894/e7570/active-profile-dev.png 170w,\n/static/aeefe9b57b1e8d4ae02a373d8e985894/f46e7/active-profile-dev.png 340w,\n/static/aeefe9b57b1e8d4ae02a373d8e985894/ca1dc/active-profile-dev.png 680w,\n/static/aeefe9b57b1e8d4ae02a373d8e985894/02d09/active-profile-dev.png 1020w,\n/static/aeefe9b57b1e8d4ae02a373d8e985894/9d567/active-profile-dev.png 1360w,\n/static/aeefe9b57b1e8d4ae02a373d8e985894/d50f3/active-profile-dev.png 2788w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>하지만, Actions Runner를 통해 CD를 수행하는 경우 아래와 같이 환경 변수가 적용되지 않았습니다.\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/203870e569e82274f809e7b13f7f26cc/346de/active-profile-default.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 14.117647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAnElEQVR42lWO2w6CMBBEeXF7E6NCUWhDxRrbB2iC//9vY0FM9OFkTiaZ7Ba6uUI3F1Rao9YNysMRxBhYhhjlpNW/EBE45xmx8e+F9w+0bYe61mg7g9O5wm4ZMf4z2Jx9XEoJpRSEEGtKmT13y8EipYRxHDMTFjfG5k81niEgxIApTZhfM+7eY1+WMLaDuzk459D3/cowDLDWIsaIN/1/SWo3y4voAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='active profile default' title='' src='/static/203870e569e82274f809e7b13f7f26cc/ca1dc/active-profile-default.png' srcset='/static/203870e569e82274f809e7b13f7f26cc/e7570/active-profile-default.png 170w,\n/static/203870e569e82274f809e7b13f7f26cc/f46e7/active-profile-default.png 340w,\n/static/203870e569e82274f809e7b13f7f26cc/ca1dc/active-profile-default.png 680w,\n/static/203870e569e82274f809e7b13f7f26cc/02d09/active-profile-default.png 1020w,\n/static/203870e569e82274f809e7b13f7f26cc/9d567/active-profile-default.png 1360w,\n/static/203870e569e82274f809e7b13f7f26cc/346de/active-profile-default.png 2770w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h3>원인 및 문제 해결</h3>\n<p>우리는 위 문제를 해결하기 위해, 아래와 같이 우리의 상황을 정리하였습니다.</p>\n<ol>\n<li>터미널에서 쉘 스크립트를 실행할 경우, 환경 변수가 적용된다.</li>\n<li>Actions Runner를 통해 쉘 스크립트를 실행할 경우, 환경변수가 적용되지 않는다.</li>\n<li>CI/CD를 구축한 뒤에 환경 변수를 적용했다.</li>\n</ol>\n<p>위 상황을 통해, 우리는 환경 변수를 적용하기 전, 이미 실행되고 있었던 Actions Runner에 환경변수가 적용되지 않았음을 직감할 수 있었습니다.\n<br>실제로, 환경 변수는 프로세스가 시작될 때 해당 프로세스에게 제공되는 환경 설정의 일부이기 때문에, 위와 같은 문제가 발생한 것이었습니다.</p>\n<p>기존에 실행되고 있었던 Actions Runner 프로세스를 종료한 후, 재시작을 하였고 환경 변수가 올바르게 적용되는 것을 확인할 수 있었습니다.</p>","frontmatter":{"title":"EC2 환경 변수 적용 및 Actions Runner에 환경 변수 적용이 안되는 이슈","date":"July 31, 2023","update":"July 31, 2023","tags":["인프라","Actions Runner"],"series":null},"fields":{"slug":"/trouble-shooting-actions-runner/","readingTime":{"minutes":4.405}}},"seriesList":{"edges":[{"node":{"id":"9e6463d2-18de-5fdf-b4e6-8707709710e1","fields":{"slug":"/how-to-write-a-post/"},"frontmatter":{"title":"포스트 작성 방법"}}},{"node":{"id":"b802f2fe-d332-504c-be84-fd7aa170c622","fields":{"slug":"/github-actions-ci-cd/"},"frontmatter":{"title":"GitHub Actions로 CI/CD 구축하기"}}},{"node":{"id":"45b7dc00-ae71-58e4-9dc2-7aff92f0ca0d","fields":{"slug":"/trouble-shooting-actions-runner/"},"frontmatter":{"title":"EC2 환경 변수 적용 및 Actions Runner에 환경 변수 적용이 안되는 이슈"}}},{"node":{"id":"cb221d09-1977-59c9-9bc3-cd607a15d292","fields":{"slug":"/how-to-isolating-test/"},"frontmatter":{"title":"인수테스트에서 테스트 격리하기!"}}},{"node":{"id":"fa602b8b-64fa-59b0-b377-089612f91d9f","fields":{"slug":"/how-to-use-nginx/"},"frontmatter":{"title":"괜찮을지도의 Nginx 활용법"}}},{"node":{"id":"89dc33ed-1ad0-5d79-8148-b1a16f417a71","fields":{"slug":"/trouble-shooting-modifying-annotation/"},"frontmatter":{"title":"@Modifying 어노테이션의 옵션이 정상 동작하지 않는 문제"}}},{"node":{"id":"db91695e-5bf6-554c-bafd-e161d686fadf","fields":{"slug":"/trouble-shooting-fetch-type/"},"frontmatter":{"title":"FetchType.EAGER, FetchType.LAZY 에 대해서 알아보자!"}}},{"node":{"id":"2b3c31ce-d59e-50a0-92b2-7dc228aacf29","fields":{"slug":"/jpa-multibag-fetch-exception/"},"frontmatter":{"title":"Fetch join 사용 시 MultipleBagFetchException의 발생 이유와 해결 방법"}}},{"node":{"id":"253d110b-e241-549e-923a-f26782aab2dc","fields":{"slug":"/how-to-hikariCP/"},"frontmatter":{"title":"HikariCP 적용기"}}}]},"previous":{"fields":{"slug":"/github-actions-ci-cd/"},"frontmatter":{"title":"GitHub Actions로 CI/CD 구축하기"}},"next":{"fields":{"slug":"/how-to-isolating-test/"},"frontmatter":{"title":"인수테스트에서 테스트 격리하기!"}}},"pageContext":{"id":"45b7dc00-ae71-58e4-9dc2-7aff92f0ca0d","series":null,"previousPostId":"b802f2fe-d332-504c-be84-fd7aa170c622","nextPostId":"cb221d09-1977-59c9-9bc3-cd607a15d292"}},"staticQueryHashes":[],"slicesMap":{}}